(function(g){var window=this;'use strict';var aWx=function(k){var y=new g.uA("und",new g.$p("Default","und",!0));y.captionTracks=k.captionTracks;return y},xWG=function(k){return new g.my(function(y,q){var N=k.length,D=[];
if(N)for(var n=function(K,A){N--;D[K]=A;N==0&&y(D)},T=function(K){q(K)},I,H=0;H<k.length;H++)I=k[H],g.icT(I,g.W6(n,H),T);
else y(D)})},Hi=function(k){this.Z=k},KL=function(){Hi.apply(this,arguments)},j7E=function(){KL.apply(this,arguments)},XwB=function(){KL.apply(this,arguments)},$WT=function(){KL.apply(this,arguments)},zYe=function(){KL.apply(this,arguments)},pwL=function(){KL.apply(this,arguments)},rcN=function(){Hi.apply(this,arguments)},mWE=function(){KL.apply(this,arguments)},i6q=function(){KL.apply(this,arguments)},fW$=function(){KL.apply(this,arguments)},O6O=function(){KL.apply(this,arguments)},PME=function(){KL.apply(this,
arguments)},vCw=function(){KL.apply(this,arguments)},CMO=function(){KL.apply(this,arguments)},ECO=function(){KL.apply(this,arguments)},b6g=function(){KL.apply(this,arguments)},VPB=function(){KL.apply(this,arguments)},BuE=function(){KL.apply(this,arguments)},UWq=function(){KL.apply(this,arguments)},Q7N=function(){Hi.apply(this,arguments)},MPb=function(){KL.apply(this,arguments)},Fdg=function(){KL.apply(this,arguments)},Ytx=function(){KL.apply(this,arguments)},St$=function(){KL.apply(this,arguments)},
Gug=function(){KL.apply(this,arguments)},LdO=function(){KL.apply(this,arguments)},dW$=function(){KL.apply(this,arguments)},gCe=function(){KL.apply(this,arguments)},oCN=function(){KL.apply(this,arguments)},hYg=function(){Hi.apply(this,arguments)},RYb=function(){Hi.apply(this,arguments)},eYG=function(){Hi.apply(this,arguments)},Wde=function(){KL.apply(this,arguments)},Z6E=function(){KL.apply(this,arguments)},lW1=function(){KL.apply(this,arguments)},s7x=function(){KL.apply(this,arguments)},JcF=function(){KL.apply(this,
arguments)},tPB=function(){KL.apply(this,arguments)},ksG=function(){KL.apply(this,arguments)},yUF=function(){KL.apply(this,arguments)},qJN=function(){KL.apply(this,arguments)},NEx=function(){KL.apply(this,arguments)},DQ$=function(){KL.apply(this,arguments)},ngq=function(){KL.apply(this,arguments)},TEN=function(){KL.apply(this,arguments)},wIT=function(){KL.apply(this,arguments)},IdN=function(){KL.apply(this,arguments)},HtB=function(){KL.apply(this,arguments)},KxB=function(){KL.apply(this,arguments)},
AUN=function(){KL.apply(this,arguments)},cUF=function(){KL.apply(this,arguments)},uEb=function(){KL.apply(this,arguments)},adT=function(){KL.apply(this,arguments)},xQb=function(){KL.apply(this,arguments)},jzg=function(){KL.apply(this,arguments)},XIg=function(){KL.apply(this,arguments)},$QO=function(){KL.apply(this,arguments)},zGg=function(){Hi.apply(this,arguments)},pIN=function(){KL.apply(this,arguments)},rUO=function(){KL.apply(this,arguments)},mQw=function(){KL.apply(this,arguments)},itO=function(){KL.apply(this,
arguments)},fdF=function(){KL.apply(this,arguments)},OtG=function(){KL.apply(this,arguments)},PTO=function(){KL.apply(this,arguments)},vgb=function(){KL.apply(this,arguments)},CTb=function(){KL.apply(this,arguments)},EgF=function(){KL.apply(this,arguments)},btw=function(){KL.apply(this,arguments)},VTL=function(){KL.apply(this,arguments)},BEF=function(){KL.apply(this,arguments)},UQG=function(){KL.apply(this,arguments)},QzT=function(){KL.apply(this,arguments)},MTO=function(){KL.apply(this,arguments)},
FxT=function(){KL.apply(this,arguments)},YJF=function(){KL.apply(this,arguments)},SJg=function(){KL.apply(this,arguments)},GsB=function(){KL.apply(this,arguments)},LxG=function(){KL.apply(this,arguments)},dQg=function(){KL.apply(this,arguments)},ggT=function(){KL.apply(this,arguments)},ogN=function(){KL.apply(this,arguments)},hGb=function(){KL.apply(this,arguments)},RGB=function(){KL.apply(this,arguments)},eGO=function(){KL.apply(this,arguments)},Wxq=function(){KL.apply(this,arguments)},Ztg=function(){KL.apply(this,
arguments)},ldF=function(k){k=k.key||k.id;
if(!k)throw Error("Entity key is missing");return k},szw=function(){if(AN)return AN();
var k={};AN=g.jJ("PersistentEntityStoreDb",{Bj:(k.EntityStore={xb:1},k.EntityAssociationStore={xb:2},k),shared:!1,upgrade:function(y,q){q(1)&&g.J1(g.Rm(y,"EntityStore",{keyPath:"key"}),"entityType","entityType");q(2)&&(y=g.Rm(y,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.J1(y,"byParentEntityKey","parentEntityKey"),g.J1(y,"byChildEntityKey","childEntityKey"))},
version:3});return AN()},JU$=function(k){return g.Tq(szw(),k)},tTb=function(k){return g.Tq((0,g.iww)(),k)},ci=function(k){this.token=k},uH=function(k,y){y=y===void 0?{}:y;
g.HN.call(this,g.fZF[k],Object.assign({},{name:"PESEncoderError",type:k},y));this.type=k;this.level="WARNING";Object.setPrototypeOf(this,uH.prototype)},khw=function(k){return new uH("WRONG_DATA_TYPE",{u7:k})},y91=function(k){return k instanceof Error?new uH("UNKNOWN_ENCODE_ERROR",{l9:k.message}):new uH("UNKNOWN_ENCODE_ERROR")},qvL=function(k){return k instanceof Error?new uH("UNKNOWN_DECODE_ERROR",{l9:k.message}):new uH("UNKNOWN_DECODE_ERROR")},Nj1=function(k,y){k=k instanceof uH?k:y(k);
g.sR(k);throw k;},DgL=function(){},nDE=function(k,y,q){try{return k.C(y,q)}catch(N){Nj1(N,y91)}},TjL=function(k){k=(new TextEncoder).encode(k).subarray(0,16);
var y=new Uint8Array(16);y.set(k);return y},aC=function(k){this.Z=k},IuL=function(k){var y=w3G[k];
if(y)return y;g.JR(new g.HN("Entity model not found.",{entityType:k}))},HDq=function(k,y){this.Z=k;
this.N=y;this.C={}},A9w=function(k,y){a:{k=KWB(k.N,y.version);
try{var q=k.N(y.data,y.key);break a}catch(N){Nj1(N,qvL)}q=void 0}return q},xw=function(k,y,q){return k.Z.objectStore("EntityStore").get(y).then(function(N){if(N){if(q&&N.entityType!==q)throw Error("Incorrect entity type");
return A9w(k,N)}})},jH=function(k,y,q){return q?(q=q.map(function(N){return xw(k,N,y)}),g.Gv.all(q)):k.Z.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(y)).then(function(N){return N.map(function(D){return A9w(k,D)})})},$w=function(k,y,q){var N=ldF(y),D=KWB(k.N,1),n=Object.assign({},y);
return k.Z.objectStore("EntityStore").get(N).then(function(T){if(T){if(T.entityType!==q)throw Error("Incorrect entity type");n.entityMetadata||(T=A9w(k,T),n.entityMetadata=T.entityMetadata)}}).then(function(){var T={key:N,
entityType:q,data:nDE(D,n,N),version:1};return g.Gv.all([g.Zc(k.Z.objectStore("EntityStore"),T),c9$(k,n,q)])}).then(function(){XD(k,N,q);
return N})},uWx=function(k,y,q){y=y.map(function(N){return $w(k,N,q)});
return g.Gv.all(y)},zn=function(k,y,q){if(q==null?0:q.Oc){var N=new Set;
return auB(k,y,N).then(function(){for(var n=[],T=g.p(N),I=T.next();!I.done;I=T.next())n.push(zn(k,I.value));return g.Gv.all(n).then(function(){})})}var D=g.fs(y).entityType;
return g.Gv.all([k.Z.objectStore("EntityStore").delete(y),xgg(k,y)]).then(function(){XD(k,y,D)})},jeO=function(k,y){return g.qJ(k.Z.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(y)},function(q){return g.Gv.all([q.delete(),
xgg(k,q.cursor.primaryKey)]).then(function(){XD(k,q.cursor.primaryKey,y);return g.k6(q)})})},X3w=function(k,y,q,N){var D=KWB(k.N,1);
return xw(k,y,N).then(function(n){if(n){n=g.ol(n,q);var T={key:y,entityType:N,data:nDE(D,n,y),version:1};return g.Gv.all([g.Zc(k.Z.objectStore("EntityStore"),T),c9$(k,n,N)])}}).then(function(){XD(k,y,N);
return y})},XD=function(k,y,q){var N=k.C[q];
N||(N=new Set,k.C[q]=N);N.add(y)},$gL=function(k,y,q){var N=ldF(y);
q=IuL(q);if(!q)return g.Gv.resolve([]);q=new q(y);k=k.Z.objectStore("EntityAssociationStore");y=[];q=g.p(q.N());for(var D=q.next();!D.done;D=q.next())y.push(g.Zc(k,{parentEntityKey:N,childEntityKey:D.value}));return g.Gv.all(y).then(function(n){return n.map(function(T){return T[1]})})},xgg=function(k,y){return k.Z.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(y))},c9$=function(k,y,q){var N=ldF(y);
return xgg(k,N).then(function(){return $gL(k,y,q)})},auB=function(k,y,q){if(q.has(y))return g.Gv.resolve(void 0);
q.add(y);return zRN(k,y).then(function(N){return k.Z.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(y)).then(function(){return N})}).then(function(N){var D=g.Gv.resolve(void 0);
N=g.p(N);for(var n=N.next(),T={};!n.done;T={pG:void 0},n=N.next())T.pG=n.value,D=D.then(function(I){return function(){return auB(k,I.pG,q)}}(T));
return D}).then(function(){})},zRN=function(k,y){var q=k.Z.objectStore("EntityAssociationStore");
return q.index("byParentEntityKey").getAll(IDBKeyRange.only(y)).then(function(N){var D=[];N=g.p(N);for(var n=N.next();!n.done;n=N.next())n=n.value,D.push(q.index("byChildEntityKey").getAll(n.childEntityKey));return g.Gv.all(D)}).then(function(N){var D=[];
N=g.p(N);for(var n=N.next();!n.done;n=N.next())n=n.value,n.length===1&&D.push(n[0].childEntityKey);return D})},pL=function(){},p3$=function(){this.Z={};
this.Z[0]=new pL;if(!g.M5("aes_pes_encoder_killswitch")){var k=this.Z;try{var y=g.KS();var q=TjL(y);var N=new aC(new g.Ls(q),new g.GQ(q))}catch(D){throw k=D instanceof Error?new uH("KEY_CREATION_FAILED",{l9:D.message}):new uH("KEY_CREATION_FAILED"),g.sR(k),k;}k[1]=N}},KWB=function(k,y){y=y===void 0?0:y;
k=k.Z[y];if(!k)throw y=new uH("INVALID_ENCODER_VERSION",{u7:y}),g.sR(y),y;return k},rv=function(k,y){g.S.call(this);
this.token=k;this.Z=y;this.observers=[];k=new g.FZ.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.KS());k.onmessage=this.N.bind(this);this.channel=k},mo=function(k,y,q){var N,D,n,T;
return g.B(function(I){if(I.Z==1)return g.b(I,JU$(k.token),2);if(I.Z!=3)return N=I.N,g.b(I,g.WN(N,["EntityStore","EntityAssociationStore"],y,function(H){D=new HDq(H,k.Z);return q(D)}),3);
n=I.N;D&&(T=D.C,Object.keys(T).length>0&&(k.channel.postMessage(T),r9w(k,T)));return I.return(n)})},iH=function(k,y,q){return mo(k,{mode:"readwrite",
Qi:!0},function(N){return $w(N,y,q)})},mgq=function(k,y){return mo(k,{mode:"readwrite",
Qi:!0},function(q){return uWx(q,y,"offlineOrchestrationActionWrapperEntity")})},iDw=function(k,y){return mo(k,{mode:"readwrite",
Qi:!0},function(q){return zn(q,y)})},fuN=function(k){return mo(k,{mode:"readwrite",
Qi:!0},function(y){return jeO(y,"videoPlaybackPositionEntity")})},fL=function(k,y,q){return mo(k,{mode:"readonly",
Qi:!0},function(N){return xw(N,y,q)})},Oy=function(k,y,q){return mo(k,{mode:"readonly",
Qi:!0},function(N){return jH(N,y,q)})},r9w=function(k,y){k=g.p(k.observers);
for(var q=k.next();!q.done;q=k.next())q=q.value,q(y)},ODO=function(){var k,y,q;
return g.B(function(N){if(N.Z==1)return g.zM(N,2),g.b(N,g.aw(),4);if(N.Z!=2){k=N.N;if(!k||!g.A1()||typeof g.FZ.BroadcastChannel==="undefined")return N.return();y=new p3$;return N.return(new rv(k,y))}q=g.rT(N);q instanceof Error&&g.sR(q);return N.return()})},Pi=function(){Pe$||(Pe$=ODO());
return Pe$},vDT=function(k){var y;
k=(y=k.options)==null?void 0:y.persistenceOption;return k==="ENTITY_PERSISTENCE_OPTION_PERSIST"||k==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},CeB=function(k){var y;
return g.B(function(q){return q.Z==1?g.b(q,Pi(),2):(y=q.N)?g.b(q,mo(y,"readwrite",function(N){for(var D={},n=g.p(k),T=n.next(),I={};!T.done;I={jr:void 0,o8:void 0},T=n.next())I.jr=T.value,I.jr.entityKey&&vDT(I.jr)&&(I.o8=g.Cd(I.jr.payload),T=void 0,I.jr.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(T=function(H){return function(){return $w(N,H.jr.payload[H.o8],H.o8)}}(I)),I.jr.type==="ENTITY_MUTATION_TYPE_DELETE"&&(T=function(H){return function(){return zn(N,H.jr.entityKey)}}(I)),I.jr.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(T=function(H){return function(){return X3w(N,H.jr.entityKey,H.jr.payload[H.o8],H.o8)}}(I)),T&&(D[I.jr.entityKey]=D[I.jr.entityKey]?D[I.jr.entityKey].then(T):T()));
return g.Gv.all(Object.values(D))}),0):q.return()})},EDE=function(k){var y;
return g.B(function(q){if(q.Z==1){y=k.mutations;if(!y||y.length<=0)return q.return();if(g.Xs){var N={type:"ENTITY_LOADED"};y!==void 0&&(N.payload=y);g.Xs.dispatch(N)}return g.b(q,CeB(y),2)}y.length=0;g.XZ(q)})},bDL=function(k){return k!==void 0},VEN=function(k){var y=g.Yu();
y=Object.assign({},y);k=Object.assign({},k);for(var q in y)k[q]?(y[q]!==4&&(y[q]=k[q]),delete k[q]):y[q]!==2&&(y[q]=4);Object.assign(y,k);g.cIT(y);JSON.stringify(y);return y},BjB=function(k){var y,q;
return g.B(function(N){if(N.Z==1)return g.b(N,g.aw(),2);if(N.Z!=3)return(y=N.N)?g.b(N,g.Lg(y),3):N.return();q=N.N;return N.return(g.WN(q,["index","media","captions"],{mode:"readwrite",Qi:!0},function(D){var n=IDBKeyRange.bound(k+"|",k+"~");D=[D.objectStore("index").delete(n),D.objectStore("media").delete(n),D.objectStore("captions").delete(n)];return g.Gv.all(D).then(function(){})}))})},UgN=function(){var k,y;
return g.B(function(q){if(q.Z==1)return g.b(q,g.aw(),2);if(q.Z!=3){k=q.N;if(!k)throw g.YS("rvdfd");return g.b(q,g.Lg(k),3)}y=q.N;return q.return(g.WN(y,["index","media"],{mode:"readwrite",Qi:!0},function(N){var D={};return g.t1(N.objectStore("index"),{},function(n){var T=n.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),I=g.Gv.resolve(void 0);if(T){var H=T[1];T=T[2];D[H]=D[H]||{};var K;D[H][T]=g.XzZ((K=n.getValue())==null?void 0:K.fmts)}else I=n.delete().then(function(){});
return g.Gv.all([g.k6(n),I]).then(function(A){return g.p(A).next().value})}).then(function(){for(var n={},T=g.p(Object.keys(D)),I=T.next();!I.done;I=T.next()){I=I.value;
var H=D[I].v;n[I]=D[I].a&&H?1:2}var K=VEN(n);return g.ldM(N.objectStore("media"),{},function(A){var c=A.cursor.key.match(g.rI7);c&&n[c[1]]||N.objectStore("media").delete(A.cursor.key);return g.LxD(A)}).then(function(){return K})})}))})},QeG=function(k,y){var q,N;
return g.B(function(D){if(D.Z==1)return g.b(D,g.aw(),2);if(D.Z!=3){q=D.N;if(!q)throw g.YS("wct");return g.b(D,g.Lg(q),3)}N=D.N;return g.b(D,g.WN(N,["captions"],{mode:"readwrite",Qi:!0},function(n){var T=[];n=n.objectStore("captions");for(var I=0;I<y.length;I++){var H=g.Zc(n,y[I],k+"|"+y[I].metadata.vss_id);T.push(H)}return g.Gv.all(T)}),0)})},MEb=function(k){var y,q,N;
return g.B(function(D){if(D.Z==1)return y=IDBKeyRange.bound(k+"|",k+"~"),g.b(D,g.aw(),2);if(D.Z!=3){q=D.N;if(!q)throw g.YS("gactfv");return g.b(D,g.Lg(q),3)}N=D.N;return D.return(N.getAll("captions",y))})},FWg=function(k){return g.B(function(y){g.GR(k,0);
return y.return(BjB(k))})},Yv1=function(k){return{context:g.jR(),
videoIds:k}},Svg=function(k){return{context:g.jR(),
playlistIds:k}},GhG=function(k){return{context:g.jR(),
offlinePlaylistSyncChecks:k}},LWN=function(){this.Z=new Map},gDO=function(){dgb||(dgb=new LWN);
return dgb},oDF=function(k,y){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:k},metadata:y,statusCode:void 0,csn:void 0,can:void 0}},hRE=function(k,y,q){if(!q){var N=N===void 0?!1:N;
q=k.Z.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!q||N)q=g.Si(16),k.Z.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",q)}k={flowNonce:q,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:y.eventType};y.metadata&&(k.flowMetadata=y.metadata);y.statusCode!==void 0&&(k.flowEventStatus=y.statusCode);y.csn&&(k.csn=y.csn);y.can&&(k.can=y.can);g.OH("flowEvent",k,void 0)},RRx=function(k){var y,q,N,D,n,T,I,H,K,A,c,u,a,x,r,f,P,C,V,Q,Y,l,h,qD,Ku,Z,d,J,X,W,s0,zF,Ae,Cu,qG,xN,JG,O,v,E;
return g.B(function(U){if(U.Z==1)return g.b(U,mo(k,{mode:"readonly",Qi:!0},function(F){return jH(F,"playbackData").then(function(kU){var TM=kU.map(function($U){return $U.transfer}).filter(function($U){return!!$U}),D7=kU.map(function($U){return $U.offlineVideoPolicy}).filter(function($U){return!!$U}),M=kU.filter(function($U){return!!$U.key}).map(function($U){return g.OV(g.fs($U.key).entityId,"downloadStatusEntity")});
TM=jH(F,"transfer",TM);D7=jH(F,"offlineVideoPolicy",D7);M=jH(F,"downloadStatusEntity",M);var AG=TM.then(function($U){$U=$U.reduce(function(wT,MD){(MD==null?0:MD.offlineVideoStreams)&&wT.push.apply(wT,g.m(MD.offlineVideoStreams));return wT},[]).filter(function(wT){return!!wT});
return jH(F,"offlineVideoStreams",$U)});
return g.Gv.all([TM,D7,AG,M]).then(function($U){var wT=g.p($U);$U=wT.next().value;var MD=wT.next().value;var wx=wT.next().value;wT=wT.next().value;return[kU,$U,MD,wx,wT]})})}),2);
if(U.Z!=3)return y=U.N,g.b(U,mo(k,{mode:"readonly",Qi:!0},function(F){return jH(F,"mainDownloadsListEntity").then(function(kU){var TM,D7;return(D7=(TM=kU[0])==null?void 0:TM.downloads)!=null?D7:[]})}),3);
q=U.N;N=g.p(y);D=N.next().value;n=N.next().value;T=N.next().value;I=N.next().value;H=N.next().value;K=D;A=n;c=T;u=I;a=H;x={};r={};f={};P={};C={};V=[];Q=g.p(A);for(Y=Q.next();!Y.done;Y=Q.next())(l=Y.value)&&(x[l.key]=l);h=g.p(c);for(qD=h.next();!qD.done;qD=h.next())(Ku=qD.value)&&(r[Ku.key]=Ku);Z=g.p(a);for(d=Z.next();!d.done;d=Z.next())(J=d.value)&&(f[J.key]=J);X=g.p(u);for(W=X.next();!W.done;W=X.next())(s0=W.value)&&(P[s0.key]=s0);zF=g.p(q);for(Ae=zF.next();!Ae.done;Ae=zF.next())Cu=Ae.value,qG=void 0,
C[(qG=Cu.videoItem)!=null?qG:""]=!0,Cu.videoItem&&(JG=xN=void 0,O=(JG=(xN=g.fs(Cu.videoItem))==null?void 0:xN.entityId)!=null?JG:"",V.push({externalVideoId:O}));v=K.filter(function(F){if(!F||!F.key||!F.offlineVideoPolicy)return!1;F=g.fs(F.key).entityId;F=g.OV(F,"downloadStatusEntity");var kU;return!(F&&((kU=f[F])==null?void 0:kU.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
E=v.map(function(F){var kU=x[F.transfer],TM=[];if(kU==null?0:kU.offlineVideoStreams)for(var D7=g.p(kU.offlineVideoStreams),M=D7.next();!M.done;M=D7.next())(M=P[M.value])&&TM.push(M);D7=r[F.offlineVideoPolicy];M=C;var AG=F==null?void 0:F.playerResponseTimestamp,$U=g.fs(D7.key).entityId;F=g.OV($U,"mainVideoEntity");if(D7.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var wT="OFFLINE_VIDEO_STATE_DISABLED";D7.expirationTimestamp&&Number(D7.expirationTimestamp)<Date.now()/1E3&&(wT="OFFLINE_VIDEO_STATE_EXPIRED")}else if(D7.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")wT="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(kU==null?void 0:kU.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":wT="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":wT="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":wT="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":wT="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":wT="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":wT="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:wT="OFFLINE_VIDEO_STATE_UNKNOWN"}if(wT==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(kU==null?void 0:kU.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":wT="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":wT="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":wT=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}$U={id:$U,videoState:wT};if(kU==null?0:kU.cotn)$U.cotn=kU.cotn;if(kU==null?0:kU.maximumDownloadQuality)$U.selectedVideoQuality=kU==null?void 0:kU.maximumDownloadQuality;if(kU==null?0:kU.lastProgressTimeMs)$U.lastProgressTimeMs=kU.lastProgressTimeMs;AG&&($U.playerResponseSavedTimeMs=String(Number(AG)*1E3));kU=String;AG=0;TM=g.p(TM);for(wT=TM.next();!wT.done;wT=TM.next())if(wT=wT.value,wT.streamsProgress){wT=g.p(wT.streamsProgress);for(var MD=wT.next();!MD.done;MD=
wT.next()){var wx=void 0;AG+=Number((wx=MD.value.numBytesDownloaded)!=null?wx:0)}}$U.downloadedBytes=kU(AG);$U.selectedOfflineMode=M[F]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";D7.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&($U.offlinePlaybackDisabledReason=D7.offlinePlaybackDisabledReason);return $U});
return U.return({offlineVideos:E,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:V}}})})},eRg=function(){this.locks=navigator.locks},WWx=function(){try{var k=g.S6("ytglobal.locks_");
if(k)return k;var y;if(y=navigator){var q=navigator;y="locks"in q&&!!q.locks}if(y)return g.FZ.localStorage&&g.FZ.localStorage.getItem("noop"),k=new eRg,g.YU("ytglobal.locks_",k),k}catch(N){}},vi=function(){},ZD$=function(){},luT=function(k){if(k.includes(":"))throw Error("Invalid user cache name: "+k);
return k+":"+g.KS("CacheStorage get")},seT=function(){return g.B(function(k){if(CL!==void 0)return k.return(CL);
CL=new Promise(function(y){var q;return g.B(function(N){switch(N.Z){case 1:return g.zM(N,2),g.b(N,Ey.open("test-only"),4);case 4:return g.b(N,Ey.delete("test-only"),5);case 5:g.pu(N,3);break;case 2:if(q=g.rT(N),q instanceof Error&&q.name==="SecurityError")return y(!1),N.return();case 3:y("caches"in window),g.XZ(N)}})});
return k.return(CL)})},tEO=function(){return g.B(function(k){if(k.Z==1)return g.b(k,seT(),2);
if(!k.N)return k.return(void 0);J9F||(J9F=new ZD$);return k.return(J9F)})},bH=function(k,y,q){g.JR(new g.HN("Woffle: "+k,q?{cotn:q}:""));
y instanceof Error&&g.JR(y)},kdB=function(k){var y;
return g.B(function(q){if(q.Z==1)return g.b(q,RRx(k),2);y=q.N;g.OH("offlineStateSnapshot",y);g.XZ(q)})},VU=function(k){g.S.call(this);
var y=this;this.api=k;this.je={ItD:function(){return y.Z},
Pbb:function(){return y.N}};
typeof g.FZ.BroadcastChannel!=="undefined"&&(this.Z=new g.FZ.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.KS()),this.Z.onmessage=this.C.bind(this),this.N=new g.FZ.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.KS()),this.N.onmessage=this.V.bind(this))},Bi=function(k,y){k.api.Sb("onOfflineOperationFailure",y);
var q;(q=k.Z)==null||q.postMessage(y)},y3x=function(k,y,q,N){var D=this;
this.J=k;this.U=y;this.visibility=q;this.W=N;this.j=this.B=this.Y=this.C=this.Z=!1;this.V=new g.c3(function(){D.xp()});
this.je={PE:function(){return D.N},
xp:function(){D.xp()},
Kgw:function(){return D.V}};
this.visibility.subscribe("visibilitystatechange",function(){D.sG()})},qiO=function(k){if(!k.C&&!k.Z){var y=WWx();
if(y){k.C=!0;var q=g.KS("OfflineLockManager");y.request("woffle_orchestration_leader:"+q,{},function(){var N,D,n,T;return g.B(function(I){switch(I.Z){case 1:return g.zM(I,2),k.N=new g.mI,k.Z=!0,k.C=!1,g.b(I,k.J(),4);case 4:return g.b(I,k.N.promise,5);case 5:g.pu(I,0);break;case 2:N=g.rT(I),((n=(D=k).W)==null?0:n.call(D,"wo_relinquish_leadership_on_lock_request_error"))||k.xp(),N instanceof Error&&(T=N,T.args=[{name:"WoLockManagerError",IS:N.name}],g.sR(T)),g.XZ(I)}})})}}},N5L=function(k){k.Z&&(k.j=
!0,Uy(k))},DtL=function(k,y){k.Z&&(k.Y=y,Uy(k))},nLe=function(k,y){k.Z&&(k.B=y,Uy(k))},Uy=function(k){k.B&&k.Y&&k.j&&k.visibility.isBackground()?g.ue(k.V,6E4):k.V.stop()},QU=function(k){var y;
k.offlineDeleteReason=(y=k.offlineDeleteReason)!=null?y:"OFFLINE_DELETE_REASON_UNKNOWN";var q;k.offlineModeType=(q=k.offlineModeType)!=null?q:"OFFLINE_NOW";g.OH("offlineDeleteEvent",k)},MV=function(k,y){var q=y.videoId;
var N=y.G3;y=y.offlineModeType;k.encryptedVideoId=q;k.cotn=N==null?void 0:N.cotn;k.offlineabilityFormatType=N==null?void 0:N.maximumDownloadQuality;var D;k.isRefresh=(D=N==null?void 0:N.isRefresh)!=null?D:!1;var n;k.softErrorCount=(n=N==null?void 0:N.transferRetryCount)!=null?n:0;k.offlineModeType=y!=null?y:"OFFLINE_NOW";(k.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&k.statusType==="UNKNOWN_STATUS_TYPE"||!k.transferStatusType&&!k.statusType)&&g.JR(Error("Woffle unknown transfer status"));
g.OH("offlineTransferStatusChanged",k)},T5E=function(k,y,q,N){N={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!N};y&&q&&(y=Math.floor(y/1024).toFixed(),q=Math.floor(q/1024).toFixed(),N.alreadyDownloadedKbytes=y,N.totalFetchedKbytes=y,N.totalContentKbytes=q);MV(N,k)},wvq=function(k){MV({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},k)},Ieb=function(k){switch(k){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
FD=function(k){var y,q,N;
return((N=(y=k.actionMetadata)==null?void 0:(q=y.retryScheduleIntervalsInSeconds)==null?void 0:q.length)!=null?N:0)>0},Yw=function(k){return k.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!k.entityKey},SH=function(k){return k.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!k.entityKey},Gn=function(k){return k.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!k.entityKey},HeB=function(k){return k.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!k.entityKey},
LL=function(k,y,q,N,D){D=D===void 0?!1:D;
var n,T,I,H,K,A;return g.B(function(c){if(c.Z==1)return n=g.OV(k,y),T=g.OV(k,"downloadStatusEntity"),g.b(c,mo(q,{mode:"readonly",Qi:!0},function(u){return g.Gv.all([xw(u,n,y),xw(u,T,"downloadStatusEntity")])}),2);
I=c.N;H=I.length?I[0]:void 0;if(!H)return c.Hl(0);K=KHw;if(A=I.length>1?I[1]:void 0){if(A.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!D)return c.return();A.downloadState=N}else A={key:T,downloadState:N};g.NM(H,K,A);return g.b(c,mo(q,{mode:"readwrite",Qi:!0},function(u){return g.Gv.all([$w(u,H,y),$w(u,A,"downloadStatusEntity")])}),0)})},dv=function(k,y){return k.actionType===y.actionType&&k.entityKey===y.entityKey},gv=function(k,y){if(k&&k.transferState!=="TRANSFER_STATE_COMPLETE"&&k.transferState!==
"TRANSFER_STATE_FAILED"){var q=g.fs(k.key).entityId;
MV({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:q,G3:k,offlineModeType:y})}},oC=function(k){if(!k||!k.thumbnails)return[];
var y=[];k=g.p(k.thumbnails);for(var q=k.next();!q.done;q=k.next())q=q.value,q.url&&y.push(q.url);return y},A3E=function(k,y,q){q=q===void 0?[]:q;
var N,D,n,T,I,H,K,A,c,u,a,x,r;return g.B(function(f){if(f.Z==1)return q.length?g.b(f,Oy(k,y),2):f.return([]);N=f.N;D=new Set;n=g.p(N);for(T=n.next();!T.done;T=n.next())if(I=T.value,H=I.id||I.key)K=g.fs(H).entityId,D.add(K);A=[];c=g.p(q);for(u=c.next();!u.done;u=c.next())a=u.value,x=a.offlineVideoData,r=void 0,((r=x)==null?0:r.videoId)&&!D.has(x.videoId)&&A.push(a);return f.return(A)})},c3q=function(k,y,q){return new g.tH(k,{cotn:y,
raw_player_response:q,download_media:!0,start:Infinity,disable_watch_next:!0})},uFN=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},hN=function(k,y,q,N,D,n,T,I,H,K,A){this.entityType=k;
this.actionId=y;this.action=q;this.parentActionId=N;this.rootActionId=D===void 0?y:D;this.childActionIds=n;this.prereqActionId=T;this.postreqActionIds=I;this.hasChildActionFailed=K;this.retryScheduleIndex=0;this.Z=A||Date.now();this.retryScheduleIndex=H||0},RC=function(k){if(!k.key)throw Error("Entity key is required.");
if(!k.actionProto)throw Error("OfflineOrchestrationAction is required.");var y=g.fs(k.key),q=g.fs(k.actionProto.entityKey);return new hN(q.entityType,y.entityId,k.actionProto,k.parentActionId,k.rootActionId,k.childActionIds,k.prereqActionId,k.postreqActionIds,k.retryScheduleIndex,k.hasChildActionFailed,Number(k.enqueueTimeSec)*1E3)},eH=function(k){return{key:g.OV(k.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:k.action,parentActionId:k.parentActionId,rootActionId:k.rootActionId,childActionIds:k.childActionIds,prereqActionId:k.prereqActionId,postreqActionIds:k.postreqActionIds,retryScheduleIndex:k.retryScheduleIndex,hasChildActionFailed:k.hasChildActionFailed,enqueueTimeSec:(k.Z/1E3).toFixed()}},aeq=function(){var k;
return g.B(function(y){return y.Z==1?g.b(y,tEO(),2):(k=y.N)?y.return(k.delete("yt-player-local-img")):y.return(!0)})},Wi=function(k){var y,q;
return g.B(function(N){if(N.Z==1)return g.b(N,tEO(),2);if(N.Z!=3){y=N.N;if(!y)throw Error("Cache API not supported");return k.length?g.b(N,y.open("yt-player-local-img"),3):N.return()}q=N.N;return g.b(N,Promise.all(k.map(function(D){return q.delete(D)})),0)})},ZE=function(k){var y,q;
return g.B(function(N){if(N.Z==1)return g.b(N,tEO(),2);if(N.Z!=3){y=N.N;if(!y)throw Error("Cache API not supported");return k.length?g.b(N,y.open("yt-player-local-img"),3):N.return()}q=N.N;return g.b(N,q.addAll(k),0)})},lH=function(k,y,q,N,D){var n,T,I,H,K,A,c,u,a,x,r,f,P,C,V,Q,Y,l,h,qD,Ku,Z,d,J,X,W,s0,zF,Ae,Cu,qG;
return g.B(function(xN){switch(xN.Z){case 1:return n=g.OV(k,"mainVideoEntity"),T=g.OV(k,"ytMainChannelEntity"),I=g.OV(k,"transfer"),H=g.OV(k,"videoDownloadContextEntity"),g.b(xN,mo(y,{mode:"readonly",Qi:!0},function(JG){return g.Gv.all([xw(JG,n,"mainVideoEntity"),xw(JG,T,"ytMainChannelEntity"),xw(JG,I,"transfer"),xw(JG,H,"videoDownloadContextEntity"),jH(JG,"ytMainChannelEntity"),jH(JG,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:K=xN.N;A=g.p(K);c=A.next().value;u=A.next().value;a=A.next().value;x=A.next().value;r=A.next().value;f=A.next().value;P=c;C=u;V=a;Q=x;Y=r;l=f;if(!P&&!C){xN.Hl(3);break}h=P?oC(P.thumbnail):[];if(!C){qD=[];xN.Hl(4);break}return g.b(xN,xt$(C,Y),5);case 5:qD=xN.N;case 4:return Ku=qD,g.b(xN,Wi(h.concat(Ku)),3);case 3:Z=[];d=g.OV(k,"downloadStatusEntity");J=g.p(l);for(X=J.next();!X.done;X=J.next())W=X.value,s0=g.fs(W.key).entityId,zF=RC(W),Ae=g.fs(zF.action.entityKey).entityId,s0!==k&&Ae!==k||dv(q,
W.actionProto)||Z.push(W.key);return g.b(xN,mo(y,{mode:"readwrite",Qi:!0},function(JG){var O=Z.map(function(v){return zn(JG,v)});
O.push(zn(JG,n,{Oc:!0}));O.push(zn(JG,d,{Oc:!0}));return g.Gv.all(O)}),7);
case 7:qG=(Cu=Q)==null?void 0:Cu.offlineModeType,D&&(QU(D),D.offlineModeType&&(qG=D.offlineModeType)),gv(V,qG),Bi(N,{entityKey:n,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.XZ(xN)}})},$t$=function(k,y,q,N){var D,n,T,I,H,K,A,c,u,a,x,r,f,P,C,V,Q,Y,l,h,qD,Ku,Z,d,J,X,W,s0,zF,Ae,Cu,qG,xN,JG,O,v,E,U,F,kU,TM,D7,M,AG,$U,wT,MD,wx,GF,cY;
return g.B(function(e6){switch(e6.Z){case 1:return D=g.OV(k,"mainPlaylistEntity"),n=g.OV(k,"ytMainChannelEntity"),g.b(e6,mo(y,{mode:"readonly",Qi:!0},function(MK){return g.Gv.all([xw(MK,D,"mainPlaylistEntity"),xw(MK,n,"ytMainChannelEntity"),jH(MK,"mainPlaylistEntity"),jH(MK,"mainDownloadsListEntity"),jH(MK,"ytMainChannelEntity"),jH(MK,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:T=e6.N;I=g.p(T);H=I.next().value;K=I.next().value;A=I.next().value;c=I.next().value;u=I.next().value;a=I.next().value;x=H;r=K;f=A;P=c;C=u;V=a;if(!x&&!r){e6.Hl(3);break}Q=x?jF$(x):[];if(!r){Y=[];e6.Hl(4);break}return g.b(e6,xt$(r,C),5);case 5:Y=e6.N;case 4:return l=Y,g.b(e6,Wi(Q.concat(l)),3);case 3:h=[];qD=new Map;if(!x){e6.Hl(7);break}return g.b(e6,Xv$(x,f,P),8);case 8:h=e6.N;Ku=g.p(h);for(Z=Ku.next();!Z.done;Z=Ku.next())d=Z.value,qD.set(d,{videoId:d,playlistId:k,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.b(e6,mo(y,{mode:"readonly",Qi:!0},function(MK){return g.Gv.all([jH(MK,"transfer"),jH(MK,"videoDownloadContextEntity")])}),9);
case 9:J=e6.N;X=g.p(J);W=X.next().value;s0=X.next().value;zF=W;Ae=s0;Cu=g.p(zF);for(qG=Cu.next();!qG.done;qG=Cu.next())xN=qG.value,JG=g.fs(xN.key).entityId,(O=qD.get(JG))&&xN&&(O.cotn=xN.cotn);v=g.p(Ae);for(E=v.next();!E.done;E=v.next())U=E.value,F=g.fs(U.key).entityId,(kU=qD.get(F))&&U&&(kU.offlineModeType=U.offlineModeType);case 7:TM=[];D7=g.p(V);for(M=D7.next();!M.done;M=D7.next())AG=M.value,$U=g.fs(AG.key).entityId,wT=RC(AG),$U!==k&&wT.rootActionId!==k||dv(q,AG.actionProto)||TM.push(AG.key);MD=
g.OV(k,"mainPlaylistEntity");return g.b(e6,mo(y,{mode:"readwrite",Qi:!0},function(MK){var c9=TM.map(function(Lw){return zn(MK,Lw)});
c9.push(zn(MK,MD,{Oc:!0}));return g.Gv.all(c9)}),10);
case 10:if(!x){e6.Hl(0);break}h.reverse();if(!h){e6.Hl(0);break}wx=g.p(h);GF=wx.next();case 13:if(GF.done){e6.Hl(0);break}cY=GF.value;return g.b(e6,lH(cY,y,q,N,qD.get(cY)),14);case 14:GF=wx.next(),e6.Hl(13)}})},pvG=function(k,y,q,N){var D,n,T,I,H,K,A,c,u;
return g.B(function(a){if(a.Z==1)return D=g.OV("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),n=new Map,g.b(a,mo(k,{mode:"readwrite",Qi:!0},function(x){var r=jH(x,"transfer"),f=jH(x,"offlineOrchestrationActionWrapperEntity"),P=jH(x,"videoDownloadContextEntity"),C=xw(x,D,"mainDownloadsListEntity");return g.Gv.all([r,f,P,C]).then(function(V){V=g.p(V);var Q=V.next().value;var Y=V.next().value;var l=V.next().value;var h=V.next().value;V=zIG.map(function(Ku){return jeO(x,Ku)});
Y=g.p(Y);for(var qD=Y.next();!qD.done;qD=Y.next())qD=qD.value,dv(y,qD.actionProto)||V.push(zn(x,qD.key,{Oc:!0}));h&&(h.downloads=[],V.push($w(x,h,"mainDownloadsListEntity")));if(l)for(l=g.p(l),h=l.next();!h.done;h=l.next())h=h.value,Y=g.fs(h.key).entityId,Y=g.OV(Y,"transfer"),n.set(Y,h.offlineModeType);return g.Gv.all(V).then(function(){return Q})})}),2);
T=a.N;I=g.p(T);for(H=I.next();!H.done;H=I.next())K=H.value,gv(K,n.get(K.key)),A=g.fs(K.key).entityId,c={videoId:A,offlineDeleteReason:N,cotn:K.cotn,offlineModeType:n.get(K.key)},QU(c),u=g.OV(A,"mainVideoEntity"),Bi(q,{entityKey:u,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.b(a,aeq(),0)})},jF$=function(k,y){var q=[];
if(k.thumbnailStyleData){k=g.p(k.thumbnailStyleData);for(var N=k.next();!N.done;N=k.next()){var D=void 0,n=void 0,T=void 0;q=q.concat(oC((D=N.value)==null?void 0:(n=D.value)==null?void 0:(T=n.collageThumbnail)==null?void 0:T.coverThumbnail))}}y=oC(y);return q.concat(y)},Xv$=function(k,y,q){var N,D,n,T,I,H,K,A,c,u,a,x,r,f,P,C,V,Q,Y,l,h,qD,Ku;
return g.B(function(Z){N=[];D=new Set;if(q.length)for(n=g.p(q),T=n.next();!T.done;T=n.next())if(I=T.value,H=void 0,(H=I.downloads)==null?0:H.length)for(K=g.p(I.downloads),A=K.next();!A.done;A=K.next())c=A.value,c.videoItem&&(u=g.fs(c.videoItem).entityId,D.add(u));if(k.videos){a=g.p(k.videos);for(x=a.next();!x.done;x=a.next())r=x.value,f=JSON.parse(g.fs(r).entityId),f.videoId&&!D.has(f.videoId)&&N.push(f.videoId);P=g.p(y);for(C=P.next();!C.done;C=P.next())if(V=C.value,V.key!==k.key&&(Q=V.videos))for(Y=
g.p(Q),l=Y.next();!l.done;l=Y.next())h=l.value,qD=JSON.parse(g.fs(h).entityId),qD.videoId&&(Ku=N.indexOf(qD.videoId),Ku!==-1&&N.splice(Ku,1))}return Z.return(N)})},xt$=function(k,y){var q,N,D,n,T,I,H,K;
return g.B(function(A){q=oC(k.avatar);N=g.p(y);for(D=N.next();!D.done;D=N.next())if(n=D.value,n.id!==k.id)for(T=g.p(oC(n.avatar)),I=T.next();!I.done;I=T.next())H=I.value,K=q.indexOf(H),K!==-1&&q.splice(K,1);return A.return(q)})},r3g=function(k){var y;
return g.B(function(q){y=g.L(k.frameworkUpdates,sy);return k.frameworkUpdates&&y?g.b(q,EDE(y),0):q.return()})},ieG=function(k){var y;
if((y=k.onResponseReceivedActions)!=null&&y.length){var q;k=(q=g.L(g.L(k.onResponseReceivedActions[0],mtO),g.fCb))==null?void 0:q.actions;if(k!=null&&k.length)return k}},feF=function(k){var y,q,N;
return g.B(function(D){if(D.Z==1)return k?g.b(D,fL(k,g.xR,"mainDownloadsListEntity"),2):D.return([]);y=D.N;return((q=y)==null?0:(N=q.downloads)==null?0:N.length)?D.return(y.downloads.map(function(n){var T;return(T=n.videoItem)!=null?T:""})):D.return([])})},PyL=function(k,y){var q;
return g.B(function(N){return N.Z==1?g.b(N,OeG(k,y),2):(q=N.N)?g.b(N,mo(k,{mode:"readwrite",Qi:!0},function(D){var n=[$w(D,q.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];q.mainDownloadsListEntity&&n.push($w(D,q.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.Gv.all(n)}),0):N.Hl(0)})},OeG=function(k,y){var q,N,D,n,T,I,H,K,A,c,u,a,x,r,f,P,C,V;
return g.B(function(Q){if(Q.Z==1)return q=g.OV("main_downloads_library_id","mainDownloadsLibraryEntity"),N=g.OV("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.b(Q,mo(k,{mode:"readonly",Qi:!0},function(Y){return g.Gv.all([xw(Y,q,"mainDownloadsLibraryEntity"),xw(Y,N,"mainDownloadsListEntity")])}),2);
D=Q.N;n=g.p(D);T=n.next().value;I=n.next().value;H=T;K=I;H||(H={id:q});A=g.p(y);for(c=A.next();!c.done;c=A.next())if(u=c.value,u===g.xR){if(H.smartDownloadsList)return Q.return();H.smartDownloadsList=u}else if(a=g.fs(u).entityType,x={},a==="mainPlaylistEntity"?x.playlistItem=u:a==="mainVideoEntity"&&(x.videoItem=u),!g.QR(x)){r=void 0;if((r=K)==null?0:r.downloads){f=!1;P=g.p(K.downloads);for(C=P.next();!C.done;C=P.next())if(V=C.value,V.playlistItem===u||V.videoItem===u){f=!0;break}f||K.downloads.push(x)}else K=
{id:N,downloads:[x]};H.downloadsList=N}return Q.return({mainDownloadsLibraryEntity:H,mainDownloadsListEntity:K})})},vLw=function(k,y){var q,N,D,n,T,I,H,K,A,c,u,a,x,r,f;
return g.B(function(P){if(P.Z==1)return q=g.OV("main_downloads_library_id","mainDownloadsLibraryEntity"),N=g.OV("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.b(P,mo(k,{mode:"readonly",Qi:!0},function(C){return g.Gv.all([xw(C,q,"mainDownloadsLibraryEntity"),xw(C,N,"mainDownloadsListEntity"),xw(C,g.xR,"mainDownloadsListEntity")])}),2);
D=P.N;n=g.p(D);T=n.next().value;I=n.next().value;H=n.next().value;K=T;A=I;c=H;if(!K)return P.Hl(0);if(y===g.xR&&((u=c)==null?0:u.downloads))c.downloads=[];else if((a=A)==null?0:a.downloads)for(x=g.fs(y).entityType,r=0;r<A.downloads.length;r++)if(f=A.downloads[r],x==="mainVideoEntity"&&f.videoItem===y){A.downloads.splice(r,1);break}else if(x==="mainPlaylistEntity"&&f.playlistItem===y){A.downloads.splice(r,1);break}return g.b(P,mo(k,{mode:"readwrite",Qi:!0},function(C){var V=[$w(C,K,"mainDownloadsLibraryEntity")];
A&&V.push($w(C,A,"mainDownloadsListEntity"));c&&V.push($w(C,c,"mainDownloadsListEntity"));return g.Gv.all(V)}),0)})},JN=function(k,y){var q,N,D,n,T,I,H,K,A,c,u;
return g.B(function(a){if(a.Z==1)return q=g.OV(y,"transfer"),N=g.OV(y,"videoDownloadContextEntity"),g.b(a,mo(k,{mode:"readonly",Qi:!0},function(x){return g.Gv.all([xw(x,q,"transfer"),xw(x,N,"videoDownloadContextEntity")])}),2);
D=a.N;n=g.p(D);T=n.next().value;I=n.next().value;H=T;K=I;u={videoId:y,cotn:(A=H)==null?void 0:A.cotn,offlineModeType:(c=K)==null?void 0:c.offlineModeType};return a.return(u)})},tN=function(k,y,q,N,D){var n,T,I,H,K,A,c,u,a,x,r,f,P,C,V,Q,Y,l,h,qD;
return g.B(function(Ku){switch(Ku.Z){case 1:return n=g.OV(k,"musicTrack"),T=g.OV(k,"transfer"),g.b(Ku,mo(y,{mode:"readonly",Qi:!0},function(Z){return g.Gv.all([xw(Z,n,"musicTrack"),xw(Z,T,"transfer"),jH(Z,"musicTrack"),jH(Z,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:I=Ku.N;H=g.p(I);K=H.next().value;A=H.next().value;c=H.next().value;u=H.next().value;a=K;x=A;r=c;f=u;if(!a){Ku.Hl(3);break}return g.b(Ku,Cyg(a,r),4);case 4:return P=Ku.N,g.b(Ku,Wi(P),3);case 3:C=[];V=g.p(f);for(Q=V.next();!Q.done;Q=V.next())Y=Q.value,l=g.fs(Y.key).entityId,h=RC(Y),qD=g.fs(h.action.entityKey).entityId,l!==k&&qD!==k||dv(q,Y.actionProto)||C.push(Y.key);return g.b(Ku,mo(y,{mode:"readwrite",Qi:!0},function(Z){var d=C.map(function(J){return zn(Z,J)});
d.push(zn(Z,n,{Oc:!0}));return g.Gv.all(d)}),6);
case 6:gv(x),D&&QU(D),Bi(N,{entityKey:n,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.XZ(Ku)}})},k8=function(k,y,q,N,D){var n,T,I,H,K,A,c,u,a,x,r,f,P,C,V,Q,Y,l,h,qD,Ku,Z,d,J,X,W,s0,zF,Ae,Cu,qG,xN,JG,O,v,E;
return g.B(function(U){switch(U.Z){case 1:return n=g.OV(k,y),T=g.OV("music_downloads_library_id","musicDownloadsLibraryEntity"),g.b(U,mo(q,{mode:"readonly",Qi:!0},function(F){return g.Gv.all([xw(F,n,y),xw(F,T,"musicDownloadsLibraryEntity"),jH(F,y),jH(F,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:I=U.N;H=g.p(I);K=H.next().value;A=H.next().value;c=H.next().value;u=H.next().value;a=K;x=A;r=c;f=u;if(!a){U.Hl(3);break}return g.b(U,Cyg(a,r),4);case 4:return P=U.N,g.b(U,Wi(P),3);case 3:C=[];V=new Map;if(!a){U.Hl(6);break}return g.b(U,ELq(a,r,x),7);case 7:C=U.N;Q=g.p(C);for(Y=Q.next();!Y.done;Y=Q.next())l=Y.value,h=g.fs(l).entityId,V.set(h,{videoId:h,playlistId:k,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.b(U,Oy(q,"transfer"),8);case 8:for(qD=U.N,Ku=g.p(qD),
Z=Ku.next();!Z.done;Z=Ku.next())d=Z.value,J=g.fs(d.key).entityId,(X=V.get(J))&&d&&(X.cotn=d.cotn);case 6:W=[];s0=g.p(f);for(zF=s0.next();!zF.done;zF=s0.next())Ae=zF.value,Cu=g.fs(Ae.key).entityId,qG=RC(Ae),Cu!==k&&qG.rootActionId!==k||dv(N,Ae.actionProto)||W.push(Ae.key);xN=g.OV(k,y);return g.b(U,mo(q,{mode:"readwrite",Qi:!0},function(F){var kU=W.map(function(TM){return zn(F,TM)});
kU.push(zn(F,xN,{Oc:!0}));return g.Gv.all(kU)}),9);
case 9:if(!a){U.Hl(0);break}C.reverse();if(!C.length){U.Hl(0);break}JG=g.p(C);O=JG.next();case 12:if(O.done){U.Hl(0);break}v=O.value;E=g.fs(v).entityId;if(!E){U.Hl(13);break}return g.b(U,tN(E,q,N,D,V.get(E)),13);case 13:O=JG.next(),U.Hl(12)}})},yg=function(k,y,q){var N,D,n,T,I,H,K;
return g.B(function(A){if(A.Z==1)return g.b(A,mo(k,{mode:"readwrite",Qi:!0},function(c){var u=jH(c,"transfer"),a=jH(c,"offlineOrchestrationActionWrapperEntity");return g.Gv.all([u,a]).then(function(x){x=g.p(x);var r=x.next().value;var f=x.next().value;x=bex.map(function(Q){return jeO(c,Q)});
f=g.p(f);for(var P=f.next();!P.done;P=f.next()){P=P.value;var C=g.fs(P.actionProto.entityKey).entityType==="musicTrack",V=P.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";dv(y,P.actionProto)||C&&(!C||V)||x.push(zn(c,P.key,{Oc:!0}))}return g.Gv.all(x).then(function(){return r})})}),2);
N=A.N;D=g.p(N);for(n=D.next();!n.done;n=D.next())T=n.value,gv(T),I=g.fs(T.key).entityId,H={videoId:I,offlineDeleteReason:void 0,cotn:T.cotn},QU(H),K=g.OV(I,"musicTrack"),Bi(q,{entityKey:K,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.b(A,aeq(),0)})},Vkb=function(k){for(var y,q=g.p(k.additionalMetadatas),N=q.next();!N.done;N=q.next())N=N.value,N.offlineMusicVideoData&&(y=N.offlineMusicVideoData);
var D,n,T,I,H;return{id:g.OV(k.videoId,"musicTrack"),videoId:k.videoId,title:k.title,thumbnailDetails:k.thumbnail,lengthMs:String(Number(k.lengthSeconds)*1E3),albumTitle:(D=y)==null?void 0:D.releaseTitle,musicVideoType:(n=y)==null?void 0:n.musicVideoType,contentRating:{explicitType:(T=y)==null?void 0:T.explicitType},artistNames:((I=y)==null?void 0:I.byline)||((H=y)==null?void 0:H.channelName),downloadMetadata:g.OV(k.videoId,"musicTrackDownloadMetadataEntity")}},ELq=function(k,y,q){var N,D,n,T,I,H,
K,A,c,u,a,x,r,f,P,C,V,Q;
return g.B(function(Y){N=[];D=new Set;if((n=q)==null?0:(T=n.downloadedTracks)==null?0:T.length)for(I=g.p(q.downloadedTracks),H=I.next();!H.done;H=I.next())K=H.value,D.add(K);if(k.tracks){A=g.p(k.tracks);for(c=A.next();!c.done;c=A.next())u=c.value,D.has(u)||N.push(u);a=g.p(y);for(x=a.next();!x.done;x=a.next())if(r=x.value,r.id!==k.id&&(f=r.tracks))for(P=g.p(f),C=P.next();!C.done;C=P.next())V=C.value,Q=N.indexOf(V),Q!==-1&&N.splice(Q,1)}return Y.return(N)})},Cyg=function(k,y){var q,N,D,n,T,I,H,K;
return g.B(function(A){q=oC(k.thumbnailDetails);N=g.p(y);for(D=N.next();!D.done;D=N.next())if(n=D.value,n.id!==k.id)for(T=g.p(oC(n.thumbnailDetails)),I=T.next();!I.done;I=T.next())H=I.value,K=q.indexOf(H),K!==-1&&q.splice(K,1);return A.return(q)})},B5w=function(k,y){var q,N,D,n,T,I,H,K,A;
return g.B(function(c){if(c.Z==1)return q=g.OV("music_downloads_library_id","musicDownloadsLibraryEntity"),g.b(c,fL(k,q,"musicDownloadsLibraryEntity"),2);(N=c.N)||(N={id:q});D=g.fs(y).entityType;D==="musicTrack"?(n=N.downloadedTracks)!=null&&n.includes(y)||(N.downloadedTracks=((T=N.downloadedTracks)!=null?T:[]).concat(y)):D==="musicPlaylist"?(I=N.downloadedPlaylists)!=null&&I.includes(y)||(N.downloadedPlaylists=((H=N.downloadedPlaylists)!=null?H:[]).concat(y)):D!=="musicAlbumRelease"||(K=N.downloadedAlbumReleases)!=
null&&K.includes(y)||(N.downloadedAlbumReleases=((A=N.downloadedAlbumReleases)!=null?A:[]).concat(y));return g.b(c,iH(k,N,"musicDownloadsLibraryEntity"),0)})},Ut$=function(k,y){var q,N,D,n,T,I,H;
return g.B(function(K){if(K.Z==1)return q=g.OV("music_downloads_library_id","musicDownloadsLibraryEntity"),g.b(K,fL(k,q,"musicDownloadsLibraryEntity"),2);N=K.N;if(!N)return K.Hl(0);D=g.fs(y).entityType;D==="musicTrack"?n=N.downloadedTracks:D==="musicPlaylist"&&(n=N.downloadedPlaylists);if((T=n)==null?0:T.length)for(I=0;I<n.length;I++)if(H=n[I],H===y){n.splice(I,1);break}return g.b(K,iH(k,N,"musicDownloadsLibraryEntity"),0)})},QFb=function(k){var y=k.videos;
k=[];var q=[];if(y){y=g.p(y);for(var N=y.next();!N.done;N=y.next()){var D=N.value.offlineVideoData.videoId;N=g.OV(D,"musicTrack");D=g.OV(D,"musicTrackDownloadMetadataEntity");k.push(N);q.push(D)}}return{lE:k,Zw:q}},q4=function(k,y,q){y={track:Vkb(y)};
q&&(y.playlistId=q);if(k=g.L(k.actionMetadata,Mk$))y.maximumDownloadQuality=k.maximumDownloadQuality;return{musicTrackEntityActionMetadata:y}},YiE=function(k){var y,q,N,D,n,T,I,H;
return g.B(function(K){switch(K.Z){case 1:return y=g.BZ(),q=Yv1(k),N=g.zS(FHb),g.zM(K,2),n={CN:!0},g.b(K,g.r4(y,q,N,void 0,n),4);case 4:D=K.N;g.pu(K,3);break;case 2:T=g.rT(K);if(T instanceof g.Eh)throw I="GetOffline network manager error: "+T.message,bH(I,T),Error(I);bH("GetOffline fetch request error",T);throw Error("GetOffline fetch request error");case 3:H=N4(D);if(!D)throw bH("Network request failed"),Error("Network request failed");if(H!==void 0)DO(H);else if(!D.videos||!D.videos.length)throw bH("No data"),
Error("No data");return K.return(D.videos.map(function(A){return A.offlineVideoData}))}})},Siq=function(k){var y,q,N,D,n,T,I,H;
return g.B(function(K){switch(K.Z){case 1:return y=g.BZ(),q=Svg(k),N=g.zS(FHb),g.zM(K,2),n={CN:!0},g.b(K,g.r4(y,q,N,void 0,n),4);case 4:D=K.N;g.pu(K,3);break;case 2:T=g.rT(K);if(T instanceof g.Eh)throw I="GetOffline network manager error for playlist: "+T.message,bH(I,T),Error(I);bH("GetOffline fetch request error for playlist",T);throw Error("GetOffline fetch request error for playlist");case 3:H=N4(D);if(!D)throw bH("Network request failed for playlist"),Error("Network request failed for playlist");
if(H!==void 0)DO(H,"playlist");else if(!D.playlists||!D.playlists.length)throw bH("No data for playlist"),Error("No data for playlist");return K.return(D.playlists.map(function(A){return A.offlinePlaylistData}))}})},LHx=function(k,y,q,N){var D,n,T,I,H,K,A,c,u,a,x,r,f,P,C,V,Q,Y,l,h,qD,Ku,Z,d,J,X,W,s0,zF,Ae;
return g.B(function(Cu){switch(Cu.Z){case 1:return g.b(Cu,Pi(),2);case 2:D=Cu.N;if(!D)return Cu.return([]);n=[];if((T=N)==null?0:T.length){n=N;Cu.Hl(3);break}return g.b(Cu,Oy(D,"mainPlaylistEntity"),4);case 4:n=Cu.N;case 3:if(!n.length)return Cu.return([]);I=[];H=Date.now()/1E3;K=g.p(n);A=K.next();case 5:if(A.done)return I.length?g.b(Cu,Gdg(I),10):Cu.return([]);c=A.value;if(!c.downloadState){u=void 0;Cu.Hl(8);break}return g.b(Cu,fL(D,c.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:u=
Cu.N;case 8:a=u;x=void 0;f=(r=(x=c)==null?void 0:x.entityMetadata)&&r.nextAutoRefreshIntervalSeconds?Number(r.nextAutoRefreshIntervalSeconds):NaN;P=Number.isNaN(f)?k:f;V=C=void 0;Q=((C=a)==null?0:C.lastSyncedTimestampMillis)?Number((V=a)==null?void 0:V.lastSyncedTimestampMillis)/1E3:0;l=Y=void 0;h=((Y=a)==null?0:Y.addedTimestampMillis)?Number((l=a)==null?void 0:l.addedTimestampMillis)/1E3:0;if(q||!r||Q+P<=H){qD=[];Ku=void 0;if((Ku=c.videos)==null?0:Ku.length)for(Z=g.p(c.videos),d=Z.next();!d.done;d=
Z.next())J=d.value,X=JSON.parse(g.fs(J).entityId),X.videoId&&qD.push(X.videoId);W="0";r&&(s0=void 0,W=String(Number((s0=r.offlineLastModifiedTimestampSeconds)!=null?s0:0).toFixed()));zF={playlistId:c.playlistId,videoIds:qD,offlineLastModifiedTimestamp:W,autoSync:y,offlineDateAddedTimestamp:String(h.toFixed())};I.push(zF)}A=K.next();Cu.Hl(5);break;case 10:return Ae=Cu.N,Cu.return(Ae)}})},dtT=function(){var k,y,q,N,D;
return g.B(function(n){if(n.Z==1)return g.b(n,Pi(),2);if(n.Z!=3)return(k=n.N)?g.b(n,Oy(k,"refresh"),3):n.return(!1);y=n.N;if((q=y[0])==null||!q.refreshTime)return n.return(!1);N=Number(y[0].refreshTime);D=Date.now()/1E3;return n.return(isFinite(N)&&D>=N)})},oLL=function(k,y){var q,N,D;
return g.B(function(n){switch(n.Z){case 1:return g.zM(n,2),g.b(n,gLg(k,y),4);case 4:return N=n.N,g.b(n,r3g(N),5);case 5:q=ieG(N);g.pu(n,3);break;case 2:D=g.rT(n),bH("getAndProcessSmartDownloadsResponse request or processing error",D);case 3:return n.return(q)}})},hIO=function(k,y,q,N){var D,n,T,I,H,K,A,c,u,a,x,r,f,P,C,V,Q,Y,l,h,qD,Ku,Z,d,J,X,W,s0,zF,Ae;
return g.B(function(Cu){switch(Cu.Z){case 1:return g.b(Cu,Pi(),2);case 2:D=Cu.N;if(!D)return Cu.return([]);n=[];if((T=N)==null?0:T.length){n=N;Cu.Hl(3);break}return g.b(Cu,Oy(D,"musicPlaylist"),4);case 4:n=Cu.N;case 3:if(!n.length)return Cu.return([]);I=[];H=Date.now()/1E3;K=g.p(n);A=K.next();case 5:if(A.done)return I.length?g.b(Cu,Gdg(I),10):Cu.return([]);c=A.value;u=void 0;x=(a=(u=c)==null?void 0:u.entityMetadata)&&a.nextAutoRefreshIntervalSeconds?Number(a.nextAutoRefreshIntervalSeconds):NaN;r=
Number.isNaN(x)?k:x;P=f=0;C="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!c.downloadMetadata){Cu.Hl(8);break}return g.b(Cu,fL(D,c.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:V=Cu.N,Y=Q=void 0,f=Number((Y=(Q=V)==null?void 0:Q.addedTimestampMillis)!=null?Y:"0")/1E3,h=l=void 0,P=Number((h=(l=V)==null?void 0:l.lastModifiedTimestampMillis)!=null?h:"0")/1E3,Ku=qD=void 0,C=(Ku=(qD=V)==null?void 0:qD.syncState)!=null?Ku:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:Z=void 0;if(q||C!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!a||Number((Z=a.lastSyncedTimestampSeconds)!=null?Z:0)+r<=H){d=[];J=void 0;if((J=c.tracks)==null?0:J.length)for(X=g.p(c.tracks),W=X.next();!W.done;W=X.next())s0=W.value,d.push(g.fs(s0).entityId);zF={playlistId:c.playlistId,videoIds:d,offlineLastModifiedTimestamp:String(P.toFixed()),autoSync:y,offlineDateAddedTimestamp:String(f.toFixed())};I.push(zF)}A=K.next();Cu.Hl(5);break;case 10:return Ae=Cu.N,Cu.return(Ae)}})},gLg=function(k,y){var q,N,D,n,T,I,H,K,A,c;
return g.B(function(u){switch(u.Z){case 1:return q=g.BZ(),g.b(u,Pi(),2);case 2:N=u.N;if(!N){u.Hl(3);break}return g.b(u,RRx(N),4);case 4:D=u.N;case 3:var a=D;n={context:g.jR(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:k},offlineClientState:a,clientStateRequestData:{preferredFormatType:y}}}};T=g.zS(RI$);g.zM(u,5);H={CN:!0};return g.b(u,g.r4(q,n,T,void 0,H),7);case 7:I=u.N;g.pu(u,6);break;case 5:K=g.rT(u);if(K instanceof g.Eh)throw A=
"DPS network manager error for smart downloads: "+K.message,bH(A,K),Error(A);bH("DPS fetch request error for smart downloads",K);throw Error("DPS fetch request error for smart downloads");case 6:c=N4(I);if(I)c!==void 0&&DO(c,"smart downloads");else throw bH("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return u.return(I)}})},WHw=function(k,y){var q,N,D,n,T,I,H,K;
return g.B(function(A){switch(A.Z){case 1:return q=g.BZ(),N={context:g.jR(),videoPlaybackPositionEntities:k,lastSyncTimestampUsec:y},D=g.zS(eI1),g.zM(A,2),T={CN:!0},g.b(A,g.r4(q,N,D,void 0,T),4);case 4:n=A.N;g.pu(A,3);break;case 2:I=g.rT(A);if(I instanceof g.Eh)throw H="VPPS network manager error: "+I.message,bH(H,I),Error(H);bH("VPPS fetch request error",I);throw Error("VPPS fetch request error");case 3:K=N4(n);if(n)K!==void 0&&DO(K,"position sync");else throw bH("Network request failed for position sync"),
Error("Network request failed for position sync");return A.return(n)}})},lew=function(k,y,q){var N,D,n,T,I,H,K,A;
return g.B(function(c){switch(c.Z){case 1:N=g.BZ();var u=q.refreshData,a=q.isEnqueuedForExpiredStreamUrlRefetch,x=q.iE,r=q.offlineSourceData,f=q.mediaCapabilities,P={entityKey:k};u&&(P.refreshData=u);a&&(P.isExpiredStreamUrlRefetch=a);x&&(P.downloadParameters=x);r&&(P.offlineSourceData=r);u={context:g.JyD(y),signatureTimestamp:20068,videos:[P]};f&&(u.mediaCapabilities=f);D=u;n=g.zS(Zeb);g.zM(c,2);I={CN:!0};return g.b(c,g.r4(N,D,n,void 0,I),4);case 4:T=c.N;g.pu(c,3);break;case 2:H=g.rT(c);if(H instanceof
g.Eh)throw K="GetPDE network manager error: "+H.message,bH(K,H),Error(K);bH("GetPDE fetch request error",H);throw Error("GetPDE fetch request error");case 3:A=N4(T);if(T)A!==void 0&&DO(A,"PDE");else throw bH("Network request failed for PDE"),Error("Network request failed for PDE");return c.return(T)}})},N4=function(k){var y;
return(y=k.errorMetadata)==null?void 0:y.status},DO=function(k,y){y=y?" for "+y:"";
if(k===0)throw k="Empty response body"+y,bH(k),Error(k);k="Response with error"+y;bH(k);throw Error(k);},Gdg=function(k){var y,q,N,D,n,T,I,H;
return g.B(function(K){switch(K.Z){case 1:return y=g.BZ(),q=GhG(k),N=g.zS(sF$),g.zM(K,2),n={CN:!0},g.b(K,g.r4(y,q,N,void 0,n),4);case 4:D=K.N;g.pu(K,3);break;case 2:T=g.rT(K);if(T instanceof g.Eh)throw I="offlinePlaylistSyncCheck network manager error: "+T.message,bH(I,T),Error(I);bH("offlinePlaylistSyncCheck fetch request error",T);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:H=N4(D);if(!D)throw bH("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(H!==void 0)DO(H,"playlist sync");else if(!D.offlinePlaylistSyncCheckDatas||!D.offlinePlaylistSyncCheckDatas.length)throw bH("No data for playlist sync"),Error("No data for playlist sync");return K.return(D.offlinePlaylistSyncCheckDatas.map(function(A){return A.offlinePlaylistSyncCheckData}))}})},n7=function(k){this.Z=k},J3e=function(k,y){var q,N,D,n,T,I;
return g.B(function(H){switch(H.Z){case 1:q=new Map,N=g.p(y),D=N.next();case 2:if(D.done){H.Hl(4);break}n=D.value;T=q;I=T.set;return g.b(H,k.N(n),5);case 5:I.call(T,n,H.N);D=N.next();H.Hl(2);break;case 4:return H.return(q)}})},TX=function(k,y,q,N,D,n){y=g.OV(y,q);
N=Object.assign({},n,{priority:N,retryScheduleIntervalsInSeconds:D});return{actionType:k,entityKey:y,actionMetadata:N}},ww=function(k,y,q,N,D,n){this.status=k;
this.Z=y;this.V=q;this.N=N;this.C=D;this.downloadState=n},tkT=function(k,y,q){this.Z=k;
this.uw=y;this.C=q},qPG=function(k,y){var q,N,D,n,T,I,H,K,A;
return g.B(function(c){switch(c.Z){case 1:return q=y.entityKey,D=(N=g.L(y.actionMetadata,I1))==null?void 0:N.isEnqueuedForExpiredStreamUrlRefetch,g.zM(c,2),n=void 0,g.b(c,kfb(k,y),4);case 4:n=c.N;g.zM(c,5);var u=(u=g.L(y.actionMetadata,I1))?{maximumDownloadQuality:u.maximumDownloadQuality}:void 0;return g.b(c,lew(q,k.uw,{isEnqueuedForExpiredStreamUrlRefetch:D,iE:u,offlineSourceData:n}),7);case 7:T=c.N;g.pu(c,6,2);break;case 5:return g.rT(c,2),I=FD(y)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",bH("PDE handleAdd error"),c.return(H0(y,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",I,"DOWNLOAD_STATE_FAILED"));case 6:return g.b(c,yww(k,T,y),8);case 8:return c.return(H0(y,!0,T.orchestrationActions));case 2:return H=g.rT(c),K="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",A="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",H instanceof g.BN&&H.type==="QUOTA_EXCEEDED"&&(K="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
A="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),bH("PDE handleAdd error"),c.return(H0(y,!1,void 0,K,A,"DOWNLOAD_STATE_FAILED"))}})},nTb=function(k,y){var q,N,D,n,T,I,H,K,A,c,u,a,x,r,f,P,C,V,Q,Y,l,h,qD,Ku;
return g.B(function(Z){switch(Z.Z){case 1:return q=y.entityKey,N=g.fs(q).entityId,g.b(Z,mo(k.Z,{mode:"readonly",Qi:!0},function(d){var J=xw(d,q,"playbackData"),X=xw(d,g.OV(N,"offlineVideoPolicy"),"offlineVideoPolicy");d=xw(d,g.OV(N,"transfer"),"transfer");return g.Gv.all([J,X,d])}),2);
case 2:D=Z.N;n=g.p(D);T=n.next().value;I=n.next().value;H=n.next().value;K=T;A=I;c=H;if(!K||!A)return Z.return(H0(y,!0));u=[];r=((x=K)==null?0:x.playerResponseJson)?JSON.parse(K.playerResponseJson):null;if(!(c&&r&&k.uw.W("html5_refresh_deprecated_downloads"))){Z.Hl(3);break}a=NeN(k,r,c);return g.b(Z,D5B(k,c),4);case 4:u=Z.N;case 3:f={lastPlayerResponseTimestampSeconds:K.playerResponseTimestamp,offlineToken:A.offlineToken,formatIds:u};P={};if((C=c)==null?0:C.maximumDownloadQuality)P.maximumDownloadQuality=
c.maximumDownloadQuality;g.zM(Z,5);V=void 0;return g.b(Z,kfb(k,y),7);case 7:return V=Z.N,g.zM(Z,8),g.b(Z,lew(q,k.uw,{refreshData:f,iE:P,offlineSourceData:V,mediaCapabilities:a}),10);case 10:Q=Z.N;g.pu(Z,9,5);break;case 8:return g.rT(Z,5),Y=FD(y)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",bH("PDE handleRefresh error"),Z.return(H0(y,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",Y,"DOWNLOAD_STATE_FAILED"));
case 9:return g.b(Z,yww(k,Q,y),11);case 11:return Z.return(H0(y,!0,Q.orchestrationActions));case 5:return l=g.rT(Z),h="PDE handleRefresh error",l instanceof Error&&(h="PDE handleRefresh error: "+l.message),qD="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Ku="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",l instanceof g.BN&&l.type==="QUOTA_EXCEEDED"&&(qD="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Ku="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),bH(h),Z.return(H0(y,
!1,void 0,qD,Ku,"DOWNLOAD_STATE_FAILED"))}})},kfb=function(k,y){var q,N,D,n;
return g.B(function(T){if(T.Z==1)return q=g.fs(y.entityKey).entityId,N=g.OV(q,"videoDownloadContextEntity"),g.b(T,fL(k.Z,N,"videoDownloadContextEntity"),2);D=T.N;return(n=D)!=null&&n.offlineModeType?T.return({offlineModeType:D.offlineModeType}):T.return(void 0)})},yww=function(k,y,q){var N,D,n,T,I;
return g.B(function(H){if(H.Z==1){if(!y.frameworkUpdates||!g.L(y.frameworkUpdates,sy))return H.return();if(!(g.L(y.frameworkUpdates,sy).mutations&&g.L(y.frameworkUpdates,sy).mutations.length>0&&g.L(y.frameworkUpdates,sy).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return H.Hl(2);N=g.fs(g.L(y.frameworkUpdates,sy).mutations[0].entityKey).entityId;return g.b(H,JN(k.Z,N),3)}if(H.Z!=2){D=H.N;n=g.L(q.actionMetadata,I1);if(I=(T=n)==null?void 0:T.playlistId)D.playlistId=I;D.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.ng(k.uw)?g.b(H,lH(N,k.Z,q,k.C,D),2):g.NF(k.uw)?g.b(H,tN(N,k.Z,q,k.C),2):H.Hl(2)}return g.b(H,EDE(g.L(y.frameworkUpdates,sy)),0)})},H0=function(k,y,q,N,D,n){return new ww(y?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",FD(k),q,N,D,n)},NeN=function(k,y,q){y=c3q(k.uw,q.cotn,y);
q=g.pJ(y);return g.lgM(y,q,k.uw)},D5B=function(k,y){var q,N,D,n,T,I,H,K,A,c,u;
return g.B(function(a){if(a.Z==1)return q=[],g.b(a,mo(k.Z,{mode:"readonly",Qi:!0},function(x){var r=[],f=y.offlineVideoStreams;if(f){f=g.p(f);for(var P=f.next();!P.done;P=f.next())r.push(xw(x,P.value,"offlineVideoStreams"))}return g.Gv.all(r)}),2);
if(N=a.N)for(D=g.p(N),n=D.next();!n.done;n=D.next())if(T=n.value,I=void 0,(I=T)==null?0:I.streamsProgress)for(H=T.streamsProgress,K=0;K<H.length;K++)A=H[K],c=JSON.parse(A.formatStreamBytes),u={itag:c.itag,lmt:c.lastModified,xtags:c.xtags},q.push(u);return a.return(q)})},TeF=function(k,y){this.Z=k;
this.uw=y},w1w=function(k,y){var q,N,D,n,T,I,H,K,A,c,u,a;
return g.B(function(x){switch(x.Z){case 1:return q=FD(y),g.b(x,Oy(k.Z,"videoPlaybackPositionEntity"),2);case 2:N=x.N;if(N.length===0)return x.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q));g.zM(x,3);return g.b(x,ci.getInstance(),5);case 5:D=x.N;if(!D)throw Error("prefStorage is undefined");return g.b(x,D.get("psi"),6);case 6:return n=x.N,H=(I=(T=n)==null?void 0:T.XJ)!=null?I:"0",g.b(x,WHw(N,H),7);case 7:return K=x.N,A={isPaused:K.watchHistoryPaused,XJ:K.syncTimestampUsec},g.b(x,D.set("psi",
A),8);case 8:if(A.isPaused){x.Hl(9);break}c=g.L(K.frameworkUpdates,sy);if(!K.frameworkUpdates||!c){x.Hl(9);break}return g.b(x,EDE(c),9);case 9:g.pu(x,4);break;case 3:return u=g.rT(x),a="PPE handleRefresh error: "+(u instanceof Error?u.message:"unknown error"),bH(a),x.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return x.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
q))}})},HVO=function(k,y){var q,N,D,n,T,I,H,K;
return g.B(function(A){switch(A.Z){case 1:return q=FD(y),N=g.fs(y.entityKey).entityId,g.zM(A,2),g.b(A,ci.getInstance(),4);case 4:D=A.N;if(!D)throw Error("prefStorage is undefined");return g.b(A,D.get("psi"),5);case 5:n=A.N;T=g.L(y.actionMetadata,IIF);if(((I=n)==null?void 0:I.isPaused)!==!1||(H=T)==null||!H.lastPlaybackPositionSeconds){A.Hl(6);break}K={key:g.OV(N,"videoPlaybackPositionEntity"),videoId:N,lastPlaybackPositionSeconds:T.lastPlaybackPositionSeconds};return g.b(A,iH(k.Z,K,"videoPlaybackPositionEntity"),
6);case 6:g.pu(A,3);break;case 2:return g.rT(A),A.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return A.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q))}})},K$E=function(k,y){var q,N,D;
return g.B(function(n){switch(n.Z){case 1:q=FD(y);g.zM(n,2);N=g.fs(y.entityKey).entityId;if(N==="!*$_ALL_ENTITIES_!*$")return g.b(n,fuN(k.Z),5);D=g.OV(N,"videoPlaybackPositionEntity");return g.b(n,iDw(k.Z,D),5);case 5:g.pu(n,3);break;case 2:return g.rT(n),n.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return n.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
q))}})},AwB=function(k,y){this.api=k;
this.Z=y;this.logger=new g.og("woffle");this.N=!1;this.je={LV:this.LV};this.logger.debug("Initialized OfflineMediaManager")},cwg=function(k){return g.B(function(y){return y.return(FWg(k))})},uVx=function(k){var y;
return g.B(function(q){if(q.Z==1)return g.b(q,g.$dU(k),2);y=q.N;return q.return(y.filter(function(N){return!!N.url}).map(function(N){return N.url}))})},K7=function(k,y){var q=g.So(y);
if(q===1||q===0)return Promise.resolve();(q=aIg(k,y))&&q.stopVideo();k.C=0;return cwg(y)},A_=function(k,y,q,N){q=q===void 0?!1:q;
N=N===void 0?!0:N;var D=typeof y==="string"?y:y.videoDetails.videoId;g.So(D)===2&&((y=aIg(k,D))?y.stopVideo():k.logger.info(function(){return"Corresponding player for "+D+" not found. Pausing anyway"}),g.GR(D,2),k.C=2,q?x5x(k.Z):N&&j6O(k.Z))},aIg=function(k,y){var q;
return((q=k.player)==null?void 0:q.getVideoData().videoId)===y?k.player:null},X1G=function(k,y,q){y.getPlayerResponse();
g.GR(y.videoId,2);k.C=2;k.N=!1;var N;(N=k.player)==null||N.dispose();k.player=k.api.Ky(9,y);y={};g.Oo(k.player,(y.localmediachange=k.EH,y.signatureexpired=k.YK,y.statechange=k.qXS,y),k);var D=k.LV(q);g.ReZ(k.player,g.XL(D,D,!0,"m"),!1);k.logger.debug(function(){return"Starting headless playback with quality: "+D});
g.wc(k.player,!1)},$5x=function(k,y){this.Z=k;
this.uw=y},p1G=function(k,y){var q,N;
return g.B(function(D){switch(D.Z){case 1:return q=FD(y),g.b(D,fL(k.Z,y.entityKey,"transfer"),2);case 2:if(N=D.N)return D.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q));g.zM(D,3);return g.b(D,zDg(k,y),5);case 5:g.pu(D,4);break;case 3:return g.rT(D),D.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return D.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
q))}})},rwL=function(k,y){var q,N;
return g.B(function(D){switch(D.Z){case 1:return q=FD(y),g.b(D,fL(k.Z,y.entityKey,"transfer"),2);case 2:N=D.N;if(!N||N.transferState!=="TRANSFER_STATE_COMPLETE")return D.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q));g.zM(D,3);return g.b(D,zDg(k,y,!0),5);case 5:g.pu(D,4);break;case 3:return g.rT(D),D.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return D.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q))}})},m5E=function(k,y){var q,N,D,n,T,I,H,K,A,c;
return g.B(function(u){switch(u.Z){case 1:return q=FD(y),N=g.fs(y.entityKey).entityId,g.b(u,mo(k.Z,{mode:"readonly",Qi:!0},function(a){var x=xw(a,y.entityKey,"transfer");a=xw(a,g.OV(N,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Gv.all([x,a])}),2);
case 2:D=u.N;n=g.p(D);T=n.next().value;I=n.next().value;H=T;K=I;if(!H||H.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return u.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q));g.zM(u,3);H.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.b(u,iH(k.Z,H,"transfer"),5);case 5:A=g.fs(H.key).entityId;MV({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},{videoId:A,G3:H,offlineModeType:(c=K)==null?void 0:c.offlineModeType});g.pu(u,
4);break;case 3:return g.rT(u),u.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return u.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q))}})},zDg=function(k,y,q){q=q===void 0?!1:q;
var N,D,n,T,I,H,K,A,c,u,a,x,r,f,P;return g.B(function(C){switch(C.Z){case 1:return N=g.L(y.actionMetadata,iVN),D=g.fs(y.entityKey).entityId,n=g.OV(D,"downloadStatusEntity"),g.b(C,mo(k.Z,{mode:"readonly",Qi:!0},function(V){var Q=xw(V,n,"downloadStatusEntity");V=xw(V,g.OV(D,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Gv.all([Q,V])}),2);
case 2:return T=C.N,I=g.p(T),H=I.next().value,K=I.next().value,A=H,c=K,u="TRANSFER_STATE_TRANSFER_IN_QUEUE",((a=A)==null?void 0:a.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(u="TRANSFER_STATE_PAUSED_BY_USER"),f={key:y.entityKey,transferState:u,cotn:g.Si(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(x=N)==null?void 0:x.maximumDownloadQuality,preferredAudioTrack:(r=N)==null?void 0:r.preferredAudioTrack,transferRetryCount:0,isRefresh:q,hasLoggedFirstStarted:!1},g.b(C,mo(k.Z,
{mode:"readwrite",Qi:!0},function(V){var Q=[];q&&Q.push(zn(V,g.OV(D,"offlineVideoStreams")));Q.push($w(V,f,"transfer"));return g.Gv.all(Q)}),3);
case 3:if(!q){C.Hl(4);break}return g.b(C,cwg(D),4);case 4:MV({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",statusType:"ADDED_TO_QUEUE"},{videoId:D,G3:f,offlineModeType:(P=c)==null?void 0:P.offlineModeType}),g.XZ(C)}})},OVO=function(k,y,q,N){if(!k.action.entityKey)throw Error("entityKey is missing.");
var D=g.fs(k.action.entityKey);D={entityType:D.gI,entityId:D.entityId,offlineOrchestrationActionType:k.action.actionType,orchestrationAction:{orchestrationActionId:k.actionId}};y&&(D.offlineOrchestrationActionResult=y.status,D.isRetryable=q?!1:y.Z,y.C&&(D.offlineOrchestrationFailureReason=fI1(y.C,D.isRetryable)));var n,T;if((n=k.action.actionMetadata)==null?0:(T=n.offlineLoggingData)==null?0:T.offlineModeType)D.offlineModeType=k.action.actionMetadata.offlineLoggingData.offlineModeType;N&&(D.additionalOrchestrationActions=
N.map(function(I){return{orchestrationActionId:I.actionId}}));
return D},fI1=function(k,y){return k!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||y?k==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&y?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":k:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},PWT=function(k,y){var q={offlineOrchestrationContext:OVO(k)};
y=oDF(y,q);hRE(gDO(),y,k.rootActionId)},vTg=function(k,y,q,N){N=N===void 0?[]:N;
y={offlineOrchestrationContext:OVO(k,y,q,N)};y=oDF(3,y);hRE(gDO(),y,k.rootActionId)},CWe=function(){this.actions=[]},ETE=function(k,y){y=g.p(y);
for(var q=y.next();!q.done;q=y.next())q=q.value,PWT(q,1),k.actions.push(q);k.actions.sort(k.Z)},bVG=function(k,y){if(y)for(var q=0;q<k.actions.length;q++)if(y==="!*$_ALL_ENTITIES_!*$"&&k.actions[q].actionId!==y||y!=="!*$_ALL_ENTITIES_!*$"&&k.actions[q].rootActionId===y&&k.actions[q].actionId!==y)k.actions.splice(q,1),q--},VZe=function(k,y){k=g.p(k.actions);
for(var q=k.next();!q.done;q=k.next())if(q.value.actionId===y)return!0;return!1},c0=function(k,y,q,N,D){g.S.call(this);
var n=this;this.N=k;this.AV=y;this.sT=q;this.B=N;this.uw=D;this.Z=new CWe;this.Y=new g.a8;this.C=new g.c3(function(){n.retry()});
this.J=NaN;this.j=!1;this.je={Jex:function(){return n.Z},
S7:function(){return n.Y},
U$b:function(){return n.C},
retry:function(){return n.retry()}};
g.G(this,this.C);this.U=this.N.observe(this.ND.bind(this))},Q6w=function(k,y,q,N,D){var n;
return g.B(function(T){if(T.Z==1)return n=new c0(k,y,q,N,D),g.b(T,Bew(n),2);U5g(n);return T.return(n)})},U5g=function(k){var y=k.Z.actions[0];
return k.V?((y==null?void 0:y.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&k.V[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(k.j=!0),Promise.resolve()):MZT(k)},MZT=function(k){var y,q,N,D,n,T,I,H,K,A,c,u,a,x,r,f,P;
return g.B(function(C){switch(C.Z){case 1:if(k.V)throw Error("Already processing an action");if(k.VM())return C.return();y=k.Z.actions.shift();DtL(k.sT,!y);if(y===void 0)return C.return();y.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&y.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&bVG(k.Z,y.actionId);q="";y.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&y.rootActionId===y.actionId&&(q=y.actionId);N=[y];k.V=N;if(D=k.AV[y.entityType]){C.Hl(2);break}k.V=
void 0;return g.b(C,MZT(k),3);case 3:return C.return();case 2:n=g.p(N);for(T=n.next();!T.done;T=n.next())I=T.value,PWT(I,2);g.zM(C,4,5);return g.b(C,J3e(D,N.map(function(V){return V.action})),7);
case 7:H=C.N,K=g.p(N),A=K.next();case 8:if(A.done){C.Hl(10);break}c=A.value;u=H.get(c.action);return g.b(C,F$O(k,c,u),9);case 9:A=K.next();C.Hl(8);break;case 10:bVG(k.Z,q);case 5:g.m7(C);k.V=void 0;g.iZ(C,6);break;case 4:return a=g.rT(C),bH("Orchestration error",a),g.zM(C,12),g.b(C,YP$(k,N),14);case 14:g.pu(C,5);break;case 12:x=g.rT(C);bH("Orchestration retry error",x);r=g.p(N);for(f=r.next();!f.done;f=r.next())P=f.value,P.retryScheduleIndex<3&&ETE(k.Z,[P]);C.Hl(5);break;case 6:return g.b(C,MZT(k),
0)}})},F$O=function(k,y,q){var N,D,n,T,I,H,K,A,c,u,a,x;
return g.B(function(r){switch(r.Z){case 1:N=y.retryScheduleIndex+2===3;if(q.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){r.Hl(2);break}if(q.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){r.Hl(0);break}vTg(y,q,N);if(q.Z&&y.retryScheduleIndex+1<3)return g.b(r,YP$(k,[y]),0);n=((D=q)==null?0:D.N)?q.N:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";T={entityKey:y.action.entityKey,failureReason:n};I=void 0;g.ng(k.uw)?I="mainVideoDownloadStateEntity":g.NF(k.uw)&&(I="musicTrackDownloadMetadataEntity");
if(!I||!q.downloadState){r.Hl(7);break}H=g.fs(y.action.entityKey).entityId;return g.b(r,LL(H,I,k.N,q.downloadState),7);case 7:Bi(k.B,T);if(q.downloadState==="DOWNLOAD_STATE_FAILED"&&k.uw.W("html5_auto_retry_failed_pde_actions")){r.Hl(0);break}bH("Orchestration result is not retryable, deleting action");return g.b(r,iDw(k.N,eH(y).key),0);case 2:K=void 0;try{K=(A=q.V)==null?void 0:A.map(function(f){return k.createAction(f,y)})}catch(f){return vTg(y,q,N),c={entityKey:y.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},Bi(k.B,c),bH("Orchestration subactions creation error",f),r.return()}vTg(y,q,N,K);if(!K){r.Hl(12);break}u=K.map(function(f){return eH(f)});
a=0;case 13:if(!(a<K.length)||k.j){r.Hl(15);break}return g.b(r,mo(k.N,{mode:"readwrite",Qi:!0},function(f){var P=[];P.push(uWx(f,u.slice(a,a+10),"offlineOrchestrationActionWrapperEntity"));return g.Gv.all(P)}),16);
case 16:a+=10;r.Hl(13);break;case 15:if(k.j)return k.j=!1,r.return();case 12:return x=eH(y),g.b(r,iDw(k.N,x.key),17);case 17:PWT(y,4),g.XZ(r)}})},d5b=function(k,y){var q,N,D,n,T,I,H,K,A,c,u,a;
return g.B(function(x){q=[];N=Infinity;D=4E3;n=g.p(y);for(T=n.next();!T.done;T=n.next())I=T.value,H=Number(I.enqueueTimeSec),K=SP$(H),A=I.retryScheduleIndex,c=A!=null&&A>0,K>0&&c?(N=Math.min(N,H),D=Math.min(K,D)):q.push(I);isFinite(N)&&(!k.C.isActive()||N<k.J)&&(k.J=N,k.C.start(D));k.Y.tL()||(u=q.length,q=q.filter(function(r){var f;r=((f=r.actionProto)==null?void 0:f.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!GfB.includes(r)}),a=q.length<u,!k.C.isActive()&&a&&k.C.start(1));
q.length>0&&L$N(k,q);return g.b(x,U5g(k),0)})},oTE=function(k){var y,q,N,D,n,T,I;
return g.B(function(H){if(H.Z==1)return g.b(H,gTL(k),2);y=H.N;q=[];N=g.p(y);for(D=N.next();!D.done;D=N.next())n=D.value,T=g.fs(n.key),I=T.entityId,VZe(k.Z,I)||q.push(n);return g.b(H,d5b(k,q),0)})},SP$=function(k){k=k*1E3-Date.now();
return k>4E3?4E3:k},YP$=function(k,y){var q,N,D;
return g.B(function(n){q=g.p(y);for(N=q.next();!N.done;N=q.next()){D=N.value;var T=void 0,I=void 0,H=((I=D.action)==null?void 0:(T=I.actionMetadata)==null?void 0:T.retryScheduleIntervalsInSeconds)||[1,2,4];T=1;D.retryScheduleIndex<H.length&&(T=H[D.retryScheduleIndex]);D.Z=T*1E3+Date.now();D.retryScheduleIndex++}return g.b(n,hDT(k,y),0)})},Bew=function(k){var y;
return g.B(function(q){if(q.Z==1)return g.b(q,Oy(k.N,"offlineOrchestrationActionWrapperEntity"),2);y=q.N;return g.b(q,d5b(k,y),0)})},L$N=function(k,y){y.length!==0&&y.forEach(function(q){q=RC(q);
q.retryScheduleIndex<3&&ETE(k.Z,[q])})},gTL=function(k,y){var q;
return g.B(function(N){if(N.Z==1)return g.b(N,Oy(k.N,"offlineOrchestrationActionWrapperEntity",y),2);q=N.N;return N.return(q.filter(bDL))})},hDT=function(k,y){if(y.length===0)return Promise.resolve([]);
y=y.map(function(q){return eH(q)});
return mgq(k.N,y)},RDE=function(k){this.Yj=k;
this.Z=void 0},W$E=function(k,y){var q,N,D,n;
return g.B(function(T){q=y.videoId;N=!0;if(y.captionTracks.length)D=aWx(y),k.Z=new g.iv(k.Yj,y,D);else if(y.qP)n=g.sA7(y),k.Z=new g.fi(k.Yj,y.qP,q,n,y.RR,y.eventId),N=y.RR;else return T.return();return T.return(new Promise(function(I){var H;(H=k.Z)==null||H.EK(function(){return g.B(function(K){if(K.Z==1)return g.b(K,eDF(k,q,N),2);I();g.XZ(K)})})}))})},eDF=function(k,y,q){q=q===void 0?!0:q;
var N,D,n,T,I,H,K,A;return g.B(function(c){switch(c.Z){case 1:if(!k.Z)return c.return();N=[];D=g.I3(k.Z.Z,q);n=[];for(T={TN:0};T.TN<D.length;T={TN:T.TN},T.TN++)I=D[T.TN],H=k.Z.Ne(I,"json3"),K=g.R6(H,{withCredentials:!0,format:"RAW"},3,500).then(function(u){return function(a){a={metadata:g.fg(D[u.TN]),trackData:a.xhr.responseText};n.push(a)}}(T)).Oj(function(u){bH("Caption fetch error",u)}),N.push(K);
return g.b(c,xWG(N),2);case 2:return g.zM(c,3),g.b(c,QeG(y,n),5);case 5:g.pu(c,0);break;case 3:A=g.rT(c),bH("Caption DB transaction error",A),g.XZ(c)}})},ZVe=function(k){var y;
return g.B(function(q){if(q.Z==1)return g.b(q,MEb(k),2);y=q.N;return q.return(!!y&&y.length>0)})},u9=function(k){g.S.call(this);
this.Z=k;this.N=this.Z.observe(this.C.bind(this))},lIF=function(k,y){var q,N,D,n,T,I,H;
return g.B(function(K){switch(K.Z){case 1:if(y.length===0)return K.return([]);q=y.map(function(A){return g.OV(A,"transfer")});
return g.b(K,Oy(k.Z,"transfer",q),2);case 2:N=K.N;D=N.filter(bDL).map(function(A){return g.fs(A.key).entityId});
n=y.filter(function(A){return D.indexOf(A)===-1});
if(n.length===0)return K.return([]);T=g.p(n);I=T.next();case 3:if(I.done){K.Hl(5);break}H=I.value;return g.b(K,cwg(H),4);case 4:I=T.next();K.Hl(3);break;case 5:return K.return(n)}})},tZ$=function(k,y,q,N,D,n){var T,I,H;
return g.B(function(K){T="STREAM_TYPE_UNKNOWN";q.video&&q.audio?(T="STREAM_TYPE_AUDIO_AND_VIDEO",bH("unexpected stream type")):q.video&&!q.audio?T="STREAM_TYPE_VIDEO":!q.video&&q.audio&&(T="STREAM_TYPE_AUDIO");I=g.OV(y,"offlineVideoStreams");H={numBytesDownloaded:D.toFixed(),numTotalBytes:n.toFixed(),streamType:T,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(N),itag:T==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(q.itag):void 0};return g.b(K,mo(k,{mode:"readwrite",Qi:!0},
function(A){var c=xw(A,I,"offlineVideoStreams"),u=xw(A,g.OV(y,"transfer"),"transfer");return g.Gv.all([c,u]).then(function(a){a=g.p(a);var x=a.next().value;a=a.next().value;if(!a)return zn(A,I).then(function(){});
var r=s6N(x);x=JwG(x,N,H,I);var f=$w(A,x,"offlineVideoStreams");s6N(x)>r&&(a.lastProgressTimeMs=Date.now().toString());r=[f];a.offlineVideoStreams||(a.offlineVideoStreams=[]);a.offlineVideoStreams.indexOf(I)===-1&&(a.offlineVideoStreams.push(I),r.push($w(A,a,"transfer")));return g.Gv.all(r)})}),0)})},kI1=function(k,y){var q,N,D,n,T;
return g.B(function(I){if(I.Z==1)return q=g.OV(y,"offlineVideoStreams"),g.b(I,fL(k,q,"offlineVideoStreams"),2);N=I.N;if(!N||!N.streamsProgress)return I.return();D=g.p(N.streamsProgress);for(n=D.next();!n.done;n=D.next())T=n.value,T.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",T.numTotalBytes!==T.numBytesDownloaded&&(T.numBytesDownloaded=T.numTotalBytes);return g.b(I,iH(k,N,"offlineVideoStreams"),0)})},JwG=function(k,y,q,N){if(k&&k.streamsProgress){N=k;
a:{y=y.itag+";"+y.xtags;for(var D=k.streamsProgress,n=0;n<D.length;n++){var T=JSON.parse(D[n].formatStreamBytes);if(T.itag+";"+T.xtags===y){D[n]=q;q=D;break a}}D.push(q);q=D}N.streamsProgress=q}else k={key:N,streamsProgress:[q]};return k},s6N=function(k){if(k==null?0:k.streamsProgress){var y=0;
k=k.streamsProgress;for(var q=0;q<k.length;q++){var N=k[q];isNaN(Number(N.numBytesDownloaded))?bH("stream progress bytes number invalid"):y+=Number(N.numBytesDownloaded)}return y}return 0},yFg=function(k,y,q,N){g.S.call(this);
var D=this;this.N=k;this.api=y;this.fS=q;this.ND=N;this.Y=new g.a8;this.V=new g.c3(function(){D.Z&&D.Z.transferState==="TRANSFER_STATE_TRANSFERRING"&&D.Y.tL()&&((D.Z.transferRetryCount||0)<3?A_(D.B,D.j,!1,!1):K7(D.B,D.j.videoDetails.videoId),D.cC("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.sT=this.eb=0;this.U=this.J=!1;this.hV=g.bD(this.api.S().experiments,"html5_transfer_processing_logs_interval");this.Wl=new g.to(this);this.je={skT:function(){return D.V},
D$F:function(){return D.ND},
S7:function(){return D.Y}};
this.AV=this.N.observe(this.EF.bind(this));this.B=new AwB(y,this);this.Dx=new RDE(y);this.pS=new u9(this.N);this.wF=this.Y.listen("publicytnetworkstatus-online",this.pE.bind(this));this.QM=this.Y.listen("publicytnetworkstatus-offline",this.m5M.bind(this));this.U=this.api.S().W("html5_less_transfer_processing_logs");g.G(this,this.Wl);this.Wl.T(y,"offlinetransferpause",this.R_v);g.ng(this.api.S())?this.C="mainVideoDownloadStateEntity":g.NF(this.api.S())&&(this.C="musicTrackDownloadMetadataEntity")},
qqg=function(k){return g.B(function(y){if(y.Z==1)y=g.b(y,UgN(),2);
else{var q=k.pS;var N=g.Yu();N=Object.keys(N);q=lIF(q,N);y=g.b(y,q,0)}return y})},x8=function(k,y){y=y===void 0?!1:y;
var q;return g.B(function(N){if(N.Z==1){if(k.Z)throw Error("Already downloading a video");k.sT=0;k.J=!1;return g.b(N,NhT(k),2)}return N.Z!=4?(q=N.N,nLe(k.fS,!q),q&&k.Y.tL()?y?g.b(N,new Promise(function(D){g.bW(D,1E3)}),4):N.Hl(4):(!q&&k.Z&&a1(k),N.Hl(0))):g.b(N,DjN(k,q),0)})},n7w=function(k){return g.B(function(y){if(y.Z==1)return k.j?g.b(y,K7(k.B,k.j.videoDetails.videoId),3):y.Hl(0);
a1(k);g.XZ(y)})},The=function(k,y){var q,N,D;
return g.B(function(n){switch(n.Z){case 1:return g.zM(n,2),(q=!!y.captionTracks.length||!!y.qP)?g.b(n,ZVe(y.videoId),4):n.return();case 4:return(N=n.N)?n.return():g.b(n,W$E(k.Dx,y),5);case 5:g.pu(n,0);break;case 2:D=g.rT(n),bH("Caption downloading error",D,y.cotn),g.XZ(n)}})},DjN=function(k,y){var q,N,D,n,T,I;
return g.B(function(H){switch(H.Z){case 1:if(k.J)return H.return();k.J=!0;k.Z=y;q=g.fs(k.Z.key);N=q.entityId;D=void 0;if(k.Z.transferState==="TRANSFER_STATE_TRANSFERRING")return g.b(H,j_(k,N),7);if(k.Z.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||k.Z.transferRetryCount||k.Z.hasLoggedFirstStarted){H.Hl(3);break}return g.b(H,j_(k,N),5);case 5:return D=H.N,k.Z.hasLoggedFirstStarted=!0,g.b(H,w2N(k),6);case 6:T5E({videoId:N,G3:k.Z,offlineModeType:D},void 0,void 0,!0);H.Hl(3);break;case 7:D=H.N,
MV({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:N,G3:k.Z,offlineModeType:D});case 3:return g.b(H,Iyb(k),8);case 8:return n=null,g.zM(H,9),g.b(H,Hje(k,y),11);case 11:n=H.N;k.j=n;g.pu(H,10);break;case 9:return T=g.rT(H),bH("error getting player response",T,y.cotn),g.b(H,k.cC("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return H.return();case 10:return I=c3q(k.api.S(),y.cotn,n),g.b(H,The(k,I),13);case 13:return g.b(H,uVx(I.videoId),
14);case 14:I.B2=H.N,X1G(k.B,I,y.maximumDownloadQuality),k.V.start(108E5),g.XZ(H)}})},NhT=function(k){var y,q;
return g.B(function(N){if(N.Z==1)return g.b(N,Oy(k.N,"transfer"),2);y=N.N;q=y.filter(KRL).sort(AFg);return q.length===0?N.return():N.return(q[0])})},Iyb=function(k){var y,q,N;
return g.B(function(D){if(D.Z==1){if(!k.Z)return Xo(k,"onTransferStart"),D.return();k.V.start(108E5);return g.b(D,$8(k,"TRANSFER_STATE_TRANSFERRING"),2)}y=k.Z;return(N=((q=y)==null?0:q.key)?g.fs(y.key).entityId:"")&&k.C?g.b(D,LL(N,k.C,k.N,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):D.Hl(0)})},x5x=function(k){var y,q,N,D;
g.B(function(n){switch(n.Z){case 1:if(!k.Z){Xo(k,"onTransferPausedByUser");n.Hl(2);break}y=k.Z;k.V.stop();return g.b(n,$8(k,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:N=((q=y)==null?0:q.key)?g.fs(y.key).entityId:"";if(!N||!k.C){n.Hl(4);break}return g.b(n,LL(N,k.C,k.N,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.b(n,j_(k,N),6);case 6:D=n.N,wvq({videoId:N,G3:y,offlineModeType:D});case 2:a1(k),x8(k),g.XZ(n)}})},j6O=function(k){var y,q,N;
g.B(function(D){if(D.Z==1){if(!k.Z)return Xo(k,"onTransferPausedByNetwork"),D.return();k.V.stop();return g.b(D,$8(k,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(D.Z!=3)return y=k.Z,(N=((q=y)==null?0:q.key)?g.fs(y.key).entityId:"")&&k.C?g.b(D,LL(N,k.C,k.N,"DOWNLOAD_STATE_PAUSED"),3):D.Hl(3);a1(k);g.XZ(D)})},cFg=function(k){var y,q,N,D,n;
g.B(function(T){switch(T.Z){case 1:if(!k.Z)return Xo(k,"onTransferComplete"),T.return();y=k.Z;k.V.stop();if(!y||!k.j){T.Hl(2);break}q=c3q(k.api.S(),y.cotn,k.j);return g.b(T,The(k,q),2);case 2:return g.b(T,$8(k,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:D=((N=y)==null?0:N.key)?g.fs(y.key).entityId:"";if(!D||!k.C){T.Hl(5);break}return g.b(T,LL(D,k.C,k.N,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.b(T,kI1(k.N,D),7);case 7:return g.b(T,j_(k,D),8);case 8:n=T.N,MV({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:D,G3:y,offlineModeType:n}),a1(k),x8(k),g.XZ(T)}})},u_1=function(k,y,q){var N,D;
g.B(function(n){switch(n.Z){case 1:if(!k.Z)return Xo(k,"onTransferProgress: "+y),n.return();if(k.Z.transferState==="TRANSFER_STATE_TRANSFERRING"){n.Hl(2);break}return g.b(n,Iyb(k),2);case 2:N=Date.now();if(!(N-k.eb>1E3)){n.Hl(4);break}k.eb=N;return g.b(n,tZ$(k.N,q.videoId,q.N,q.OB,q.bytesDownloaded,q.Z),5);case 5:if(k.U&&!(k.U&&N-k.sT>k.hV)){n.Hl(4);break}k.sT=N;return g.b(n,j_(k,y),7);case 7:D=n.N,T5E({videoId:y,G3:k.Z,offlineModeType:D},q.bytesDownloaded,q.Z);case 4:k.V.start(108E5),g.XZ(n)}})},
ayg=function(k){var y=(k.Z.transferRetryCount||0)<3;
y&&(k=k.Z,k.transferRetryCount=(k.transferRetryCount||0)+1);return y},xjE=function(k,y){y=y===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":y;
var q,N,D,n;return g.B(function(T){if(T.Z==1)return k.Z||Xo(k,"setTransferToFailed: "+y),q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",y==="TRANSFER_FAILURE_REASON_NETWORK"?q="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":y==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.b(T,$8(k,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",y),2);if(T.Z!=3)return Bi(k.ND,{entityKey:(N=k.Z)==null?void 0:N.key,failureReason:q}),
D=k.Z?g.fs(k.Z.key).entityId:"",g.b(T,j_(k,D),3);n=T.N;var I={videoId:D,G3:k.Z,offlineModeType:n},H=y,K={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};H&&(K.transferFailureReason=H,K.failureReason=Ieb(H));MV(K,I);g.XZ(T)})},$8=function(k,y,q,N){var D;
return g.B(function(n){if(n.Z==1){if(!k.Z)return Xo(k,"saveTransferState: "+y),n.return();k.Z.transferState=y;k.Z.failureReason=N;g.zM(n,2);return g.b(n,w2N(k,function(T){return q?jH(T,"offlineVideoStreams",k.Z.offlineVideoStreams).then(function(I){for(var H=g.p(I),K=H.next();!K.done;K=H.next())if((K=K.value)&&K.streamsProgress){K=g.p(K.streamsProgress);for(var A=K.next();!A.done;A=K.next())A.value.streamState=q}return uWx(T,I.filter(function(c){return!!c}),"offlineVideoStreams")}):g.Gv.resolve(void 0)}),
4)}if(n.Z!=2)return g.pu(n,0);
D=g.rT(n);return D instanceof g.BN&&D.type==="QUOTA_EXCEEDED"?g.b(n,k.cC("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):n.Hl(0)})},w2N=function(k,y){var q;
return g.B(function(N){if(!k.Z)return N.return();q=k.Z;return g.b(N,mo(k.N,{mode:"readwrite",Qi:!0},function(D){var n=[$w(D,q,"transfer")];y&&n.push(y(D));return g.Gv.all(n)}),0)})},a1=function(k){k.Z=void 0;
k.j=void 0;k.V.stop()},Hje=function(k,y){var q,N,D,n,T;
return g.B(function(I){if(I.Z==1)return q=g.fs(y.key),N=q.entityId,D=g.OV(N,"playbackData"),g.b(I,fL(k.N,D,"playbackData"),2);n=I.N;if((T=n)==null?0:T.playerResponseJson)return I.return(JSON.parse(n.playerResponseJson));throw Error("No PlayerResponse found");})},Xo=function(k,y){k.api.lw("woffle",{mcte:y});
bH("missing current transfer entity.")},j_=function(k,y){var q,N,D;
return g.B(function(n){if(n.Z==1)return g.b(n,fL(k.N,g.OV(y,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);q=n.N;return n.return((D=(N=q)==null?void 0:N.offlineModeType)!=null?D:void 0)})},KRL=function(k){return j0O[k.transferState]!==void 0},AFg=function(k,y){var q=j0O[k.transferState],N=j0O[y.transferState];
return q!==N?q-N:Number(k.enqueuedTimestampMs)-Number(y.enqueuedTimestampMs)},zX=function(k,y){var q=this;
this.uw=k;this.api=y;this.Y=new g.a8;this.j=new g.mI;this.je={PE:function(){return q.C.je.PE()},
S7:function(){return q.Y},
m$S:function(){return q.C},
gy:function(){return q.gy()},
Bh:function(){return q.Bh()},
RJ:function(){return q.RJ()},
Ll:function(){return q.Ll()},
SV:function(){return q.SV()},
Wv:function(N){return q.Wv(N)}};
this.C=new y3x(function(){return X2x(q)},function(){q.RJ()},this.api.rT(),this.api.W.bind(this.api));
this.Z=new VU(this.api);qiO(this.C)},X2x=function(k){return g.B(function(y){k.api.Sb("onOrchestrationBecameLeader");
return g.b(y,k.Bh(),0)})},zHe=function(k){var y,q;
return g.B(function(N){if(N.Z==1)return g.b(N,Pi(),2);if(N.Z!=3){y=N.N;if(!y)return bH("PES is undefined"),N.return();k.N=new yFg(y,k.api,k.C,k.Z);q=k.JH(y);return g.b(N,Q6w(y,q,k.C,k.Z,k.uw),3)}k.B=N.N;return g.b(N,$jg(k),0)})},$jg=function(k){var y;
return g.B(function(q){switch(q.Z){case 1:if(!k.N)return bH("transferManager is undefined"),q.return();if(k.N.Z){q.Hl(2);break}return g.b(q,x8(k.N),2);case 2:if(!k.uw.W("woffle_enable_main_downloads_library")){q.Hl(4);break}return g.b(q,k.Ea(),4);case 4:if(!k.uw.W("html5_offline_playback_position_sync")){q.Hl(6);break}return g.b(q,k.CT(),7);case 7:return g.b(q,k.Wv(864E5),6);case 6:return g.b(q,k.refreshAllStaleEntities(43200,!0),9);case 9:return g.b(q,k.m$(),10);case 10:if(!k.uw.W("html5_retry_downloads_for_expiration")){q.Hl(11);
break}return g.b(q,k.SV(),11);case 11:return k.J=g.Vu(function(){k.refreshAllStaleEntities(43200,!0);k.m$()},9E5),g.am(g.jm(),function(){return k.Ll()}),g.b(q,Pi(),13);
case 13:return y=q.N,g.b(q,kdB(y),14);case 14:N5L(k.C),g.XZ(q)}})},p2E=function(){var k,y,q,N,D,n;
return g.B(function(T){switch(T.Z){case 1:return g.b(T,Pi(),2);case 2:k=T.N;if(!k)return T.return([]);y=Date.now()/1E3;return g.b(T,Oy(k,"offlineVideoPolicy"),3);case 3:q=T.N,N=g.p(q),D=N.next();case 4:if(D.done){T.Hl(6);break}n=D.value;if(!(n.expirationTimestamp&&Number(n.expirationTimestamp)<y)){T.Hl(5);break}n.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";n.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.b(T,iH(k,n,"offlineVideoPolicy"),5);
case 5:D=N.next();T.Hl(4);break;case 6:return T.return(q.map(function(I){return I.key}))}})},p7=function(k,y,q,N,D){var n,T,I;
return g.B(function(H){if(H.Z==1)return g.b(H,Pi(),2);n=H.N;if(!n)return H.return([]);T=y.map(function(K){var A=g.OV(K,q);A={actionType:N,entityKey:A,actionMetadata:Object.assign({},uFN(),D)};N!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(A.actionMetadata.priority=0);K=new hN(q,K,A);return eH(K)});
I=mgq(n,T);qiO(k.C);return H.return(I)})},rF1=function(k,y,q,N){var D,n,T,I,H,K,A,c;
return g.B(function(u){switch(u.Z){case 1:D=[],n=g.p(y),T=n.next();case 2:if(T.done){u.Hl(4);break}I=T.value;if(I.upToDate||q&&!I.shouldAutoSyncMetadata||!I.playlistId){u.Hl(3);break}H={};switch(N){case "mainPlaylistEntity":K={nextAutoRefreshIntervalSeconds:I.checkInSeconds,autoSync:q};H={mainPlaylistEntityActionMetadata:K};break;case "musicPlaylist":A={autoSync:q},H={musicPlaylistEntityActionMetadata:A}}return g.b(u,p7(k,[I.playlistId],N,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",H),6);case 6:(c=
u.N)&&D.push.apply(D,g.m(c));case 3:T=n.next();u.Hl(2);break;case 4:return u.return(D)}})},mj1=function(k,y){var q;
return g.B(function(N){return y.length?(q=uFN(),g.NM(q,I1,{isEnqueuedForExpiredStreamUrlRefetch:!0}),k.api.lw("qrd",{v:y.length}),N.return(p7(k,y,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",q))):N.return([])})},ijL=function(k,y,q){this.Z=k;
this.uw=y;this.C=q},P01=function(k,y){var q,N,D,n,T,I,H,K,A,c,u,a,x,r,f,P,C;
return g.B(function(V){switch(V.Z){case 1:return q=FD(y),N=g.fs(y.entityKey),D=N.entityId,n=[],g.zM(V,2),g.b(V,fyB(k,D),4);case 4:n=V.N;if(!(k.uw.W("woffle_enable_main_downloads_library")&&((T=n)==null?0:T.length))){V.Hl(5);break}return g.b(V,PyL(k.Z,[y.entityKey]),5);case 5:g.pu(V,3);break;case 2:return I=g.rT(V),H="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",K="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",I instanceof g.BN&&I.type==="QUOTA_EXCEEDED"?(H="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
K="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):bH("Playlist add error"),V.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,H,K));case 3:A=[];if(!k.uw.W("html5_offline_prevent_redownload_downloaded_video")){V.Hl(7);break}return g.b(V,A3E(k.Z,"mainVideoEntity",n),8);case 8:n=V.N;case 7:if((c=n)==null?0:c.length)for(u=g.p(n),a=u.next();!a.done;a=u.next())if(x=a.value,r=x.offlineVideoData,f=void 0,(f=r)==null?0:f.videoId)P=void 0,C=Number(((P=y.actionMetadata)==null?void 0:P.priority)||
0)+1,A.push(TX("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",r.videoId,"mainVideoEntity",C,rw,Oje(y,r,D)));return V.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q,A))}})},C0O=function(k,y){var q,N,D,n,T,I,H,K,A,c,u,a,x,r,f,P,C,V,Q,Y,l,h,qD,Ku,Z,d,J,X,W,s0,zF,Ae,Cu,qG,xN,JG,O,v,E,U,F,kU,TM,D7,M,AG,$U,wT,MD,wx,GF,cY,e6,MK,c9,Lw,d8,Rd,fk,gY,sL,eQ,jQ,Yx,FK,uX,SN,gy,Yo,n0,OL,DR,Yg,t3;
return g.B(function(uj){switch(uj.Z){case 1:return q=FD(y),N=y.entityKey,D=g.fs(N).entityId,n=[],T=!1,D==="!*$_ALL_ENTITIES_!*$"?(T=!0,g.b(uj,Oy(k.Z,"mainPlaylistEntity"),5)):g.b(uj,fL(k.Z,N,"mainPlaylistEntity"),4);case 4:(I=uj.N)&&n.push(I);uj.Hl(3);break;case 5:n=uj.N;case 3:if((H=n)==null||!H.length)return uj.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q));K=g.L(y.actionMetadata,v7B);c=(A=K)==null?void 0:A.nextAutoRefreshIntervalSeconds;a=(u=K)==null?void 0:u.autoSync;x=[];f=r=
!0;P=!1;if(!T&&a===!1){uj.Hl(6);break}g.zM(uj,7);return g.b(uj,LHx(0,!!a,!0,n),9);case 9:x=uj.N;g.pu(uj,8);break;case 7:C=g.rT(uj);if(!(C instanceof Error&&C.message==="No data")){C instanceof Error&&C.message==="Empty response body"&&bH(C.message);uj.Hl(8);break}return D==="!*$_ALL_ENTITIES_!*$"?g.b(uj,pvG(k.Z,y,k.C,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.b(uj,$t$(D,k.Z,y,k.C),8);case 8:if(!x.length||!T&&x[0].playlistId!==D)return uj.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
q));case 6:if(T){V=[];Q=g.p(x);for(Y=Q.next();!Y.done;Y=Q.next())l=Y.value,l.upToDate||a&&!l.shouldAutoSyncMetadata||!l.playlistId||(h={nextAutoRefreshIntervalSeconds:l.checkInSeconds,autoSync:a},V.push(TX("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",l.playlistId,"mainPlaylistEntity",0,rw,{mainPlaylistEntityActionMetadata:h})));return uj.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q,V))}x.length&&(qD=x[0],P=!!qD.upToDate,a&&(r=(Ku=qD.shouldAutoSyncMetadata)!=null?Ku:!0,f=(Z=qD.shouldAutoSyncVideos)!=
null?Z:!0,qD.checkInSeconds&&(c=qD.checkInSeconds)));if(P||!r)return uj.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q));d=[];J=n[0];if(!J.downloadState){X=void 0;uj.Hl(15);break}return g.b(uj,fL(k.Z,J.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:X=uj.N;case 15:return W=X,zF=((s0=W)==null?0:s0.addedTimestampMillis)?String(W.addedTimestampMillis):void 0,g.zM(uj,17),g.b(uj,fyB(k,D,zF,c),19);case 19:d=uj.N;g.pu(uj,18);break;case 17:Ae=g.rT(uj);if(!(Ae instanceof Error&&
Ae.message==="No data for playlist")){if(Ae instanceof Error&&Ae.message==="Empty response body for playlist")bH(Ae.message);else return Cu="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",qG="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Ae instanceof g.BN&&Ae.type==="QUOTA_EXCEEDED"&&(Cu="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",qG="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),uj.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,Cu,qG));uj.Hl(18);
break}return g.b(uj,$t$(D,k.Z,y,k.C),18);case 18:if(!f)return uj.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q));xN=[];JG=new Map;if((O=d)==null?0:O.length)for(v=g.p(d),E=v.next();!E.done;E=v.next())U=E.value,F=U.offlineVideoData,kU=void 0,((kU=F)==null?0:kU.videoId)&&JG.set(F.videoId,F);TM=new Map;D7=[];if((M=J)==null?0:(AG=M.videos)==null?0:AG.length)for($U=g.p(J.videos),wT=$U.next();!wT.done;wT=$U.next())if(MD=wT.value,wx=JSON.parse(g.fs(MD).entityId),GF=wx.videoId)JG.has(GF)?(TM.set(GF,
JG.get(GF)),JG.delete(GF)):D7.push(GF);e6=Number(((cY=y.actionMetadata)==null?void 0:cY.priority)||0)+1;MK=g.p(JG.entries());for(c9=MK.next();!c9.done;c9=MK.next())Lw=c9.value,d8=g.p(Lw),Rd=d8.next().value,fk=d8.next().value,gY=Rd,sL=fk,xN.push(TX("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",gY,"mainVideoEntity",e6,rw,Oje(y,sL,D)));eQ=g.p(TM.entries());for(jQ=eQ.next();!jQ.done;jQ=eQ.next())Yx=jQ.value,FK=g.p(Yx),uX=FK.next().value,SN=FK.next().value,gy=uX,Yo=SN,xN.push(TX("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
gy,"mainVideoEntity",e6,rw,Oje(y,Yo,D)));n0=g.p(D7);for(OL=n0.next();!OL.done;OL=n0.next())DR=OL.value,Yg={playlistId:D},t3={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:Yg},xN.push(TX("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",DR,"mainVideoEntity",0,rw,t3));return uj.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q,xN))}})},E7L=function(k,y){var q,N,D,n;
return g.B(function(T){switch(T.Z){case 1:return q=FD(y),g.zM(T,2),N=g.fs(y.entityKey).entityId,N==="!*$_ALL_ENTITIES_!*$"?g.b(T,pvG(k.Z,y,k.C,(D=y.actionMetadata)==null?void 0:(n=D.offlineLoggingData)==null?void 0:n.offlineDeleteReason),5):g.b(T,$t$(N,k.Z,y,k.C),6);case 6:if(!k.uw.W("woffle_enable_main_downloads_library")){T.Hl(5);break}return g.b(T,vLw(k.Z,y.entityKey),5);case 5:g.pu(T,3);break;case 2:return g.rT(T),T.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return T.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q))}})},fyB=function(k,y,q,N){var D,n,T,I,H,K,A;
return g.B(function(c){switch(c.Z){case 1:return g.b(c,Siq([y]),2);case 2:return D=c.N,g.b(c,bjx(k,D[0],q,N),3);case 3:return n=c.N,T=n.mainPlaylistEntity,I=n.Ktw,K=jF$(T,(H=I)==null?void 0:H.avatar),g.zM(c,4),g.b(c,ZE(K),6);case 6:g.pu(c,5);break;case 4:A=g.rT(c),A instanceof Error&&A.message==="Failed to fetch"&&bH(A.message);case 5:return c.return(D[0].videos)}})},bjx=function(k,y,q,N){var D,n,T,I,H,K,A,c,u,a,x,r,f,P,C,V,Q;
return g.B(function(Y){switch(Y.Z){case 1:D=Date.now().toString();q||(q=D);n=y.videos;T=y.playlistId;I=[];H=[];if(n)for(K=g.p(n),A=K.next();!A.done;A=K.next()){c=A.value;u=c.offlineVideoData;if(!u||!u.videoId)throw bH("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");a=u.videoId;x={videoId:a,playlistId:T};r={id:g.OV(JSON.stringify(x),"mainPlaylistVideoEntity"),video:g.OV(a,"mainVideoEntity")};I.push(r);H.push(r.id)}P={key:g.OV(T,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:q,lastSyncedTimestampMillis:D};C={key:g.OV(T,"mainPlaylistEntity"),playlistId:T,videos:H,title:y.title,thumbnailStyleData:VlB(y),visibility:Bhq(y),downloadState:P.key};y.channel&&(V=y.channel.offlineChannelData,f=Ujb(g.OV(T,"ytMainChannelEntity"),V),C.channelOwner=f.id);((Q=C)==null?0:Q.entityMetadata)?(C.entityMetadata.offlineLastModifiedTimestampSeconds=y.lastModifiedTimestamp,N&&(C.entityMetadata.nextAutoRefreshIntervalSeconds=String(N))):C&&(C.entityMetadata={nextAutoRefreshIntervalSeconds:N?
String(N):void 0,offlineLastModifiedTimestampSeconds:y.lastModifiedTimestamp});g.zM(Y,2);return g.b(Y,mo(k.Z,{mode:"readwrite",Qi:!0},function(l){var h=$w(l,C,"mainPlaylistEntity"),qD=$w(l,P,"mainPlaylistDownloadStateEntity");h=[h,qD];qD=g.p(I);for(var Ku=qD.next();!Ku.done;Ku=qD.next())h.push($w(l,Ku.value,"mainPlaylistVideoEntity"));f&&h.push($w(l,f,"ytMainChannelEntity"));return g.Gv.all(h)}),4);
case 4:g.pu(Y,3);break;case 2:throw g.rT(Y),bH("PES failure for playlist"),Error("PES failure for playlist");case 3:return Y.return({mainPlaylistEntity:C,Ktw:f,uKV:I})}})},Ujb=function(k,y){return{id:k,
channelId:y.channelId,title:y.title,avatar:y.thumbnail}},VlB=function(k){var y=[],q=k.videos;
q&&q.length>0&&y.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:q[0].offlineVideoData.thumbnail}}});if((k=k.additionalMetadadatas)&&k.length>0)for(k=g.p(k),q=k.next();!q.done;q=k.next()){var N=q.value.offlineBundleItemPlaylistData,D=void 0;q=(D=N)==null?void 0:D.style;D=void 0;N={collageThumbnail:{coverThumbnail:(D=N)==null?void 0:D.coverThumbnail}};switch(q){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":y.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:N});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":y.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:N});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":y.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:N});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":y.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:N})}}return y},Bhq=function(k){switch(k.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},Oje=function(k,y,q){y={offlineVideoData:y,
playlistId:q};if(k=g.L(k.actionMetadata,v7B))y.maximumDownloadQuality=k.maximumDownloadQuality;return{mainVideoEntityActionMetadata:y}},Q0w=function(k,y,q){this.Z=k;
this.uw=y;this.C=q},YqE=function(k,y){var q,N,D,n,T,I,H,K,A,c,u,a,x;
return g.B(function(r){switch(r.Z){case 1:return q=FD(y),N=g.fs(y.entityKey),D=N.entityId,n=g.L(y.actionMetadata,mS),I=!((T=n)==null?0:T.playlistId),g.zM(r,2),g.b(r,Mlq(k,D,void 0,(H=n)==null?void 0:H.offlineVideoData,I),4);case 4:g.pu(r,3);break;case 2:return K=g.rT(r),A="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",c="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",K instanceof g.BN&&K.type==="QUOTA_EXCEEDED"&&(A="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",c="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
r.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,A,c));case 3:u=1;u=Number(((a=y.actionMetadata)==null?void 0:a.priority)||0)+1;var f=(f=g.L(y.actionMetadata,mS))?{playbackDataActionMetadata:{maximumDownloadQuality:f.maximumDownloadQuality}}:void 0;x=TX("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",D,"playbackData",u,FRG,f);return r.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q,[x]))}})},Sq$=function(k,y){var q,N,D,n,T,I,H,K,A,c,u,a,x,r,f,P,C;
return g.B(function(V){switch(V.Z){case 1:return q=FD(y),N=g.fs(y.entityKey),D=N.entityId,g.b(V,fL(k.Z,y.entityKey,"mainVideoEntity"),2);case 2:n=V.N;if(!n){T=void 0;V.Hl(3);break}return g.b(V,fL(k.Z,n.downloadState,"mainVideoDownloadStateEntity"),4);case 4:T=V.N;case 3:I=T;if(!n||!I)return V.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q));g.zM(V,5);return g.b(V,Mlq(k,D,I.addedTimestampMillis,(K=g.L(y.actionMetadata,mS))==null?void 0:K.offlineVideoData),7);case 7:A=1;A=Number(((c=
y.actionMetadata)==null?void 0:c.priority)||0)+1;H=TX("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",D,"playbackData",A,FRG);g.pu(V,6);break;case 5:u=g.rT(V);if(!(u instanceof Error&&u.message==="No data")){if(u instanceof Error&&u.message==="Empty response body")bH(u.message);else return a="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",x="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",u instanceof g.BN&&u.type==="QUOTA_EXCEEDED"&&(a="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
x="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),V.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,a,x));V.Hl(6);break}return g.b(V,JN(k.Z,D),9);case 9:r=V.N;f=g.L(y.actionMetadata,mS);if(C=(P=f)==null?void 0:P.playlistId)r.playlistId=C;r.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.b(V,lH(D,k.Z,y,k.C,r),6);case 6:return V.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q,H?[H]:void 0))}})},GIL=function(k,y){var q,N,D,n,T,I,H,K,A,c;
return g.B(function(u){switch(u.Z){case 1:return q=FD(y),g.zM(u,2),N=g.fs(y.entityKey).entityId,N==="!*$_ALL_ENTITIES_!*$"?g.b(u,pvG(k.Z,y,k.C,(A=y.actionMetadata)==null?void 0:(c=A.offlineLoggingData)==null?void 0:c.offlineDeleteReason),5):g.b(u,JN(k.Z,N),6);case 6:D=u.N;n=g.L(y.actionMetadata,mS);if(I=(T=n)==null?void 0:T.playlistId)D.playlistId=I;D.offlineDeleteReason=(H=y.actionMetadata)==null?void 0:(K=H.offlineLoggingData)==null?void 0:K.offlineDeleteReason;return g.b(u,lH(N,k.Z,y,k.C,D),7);
case 7:if(!k.uw.W("woffle_enable_main_downloads_library")){u.Hl(5);break}return g.b(u,vLw(k.Z,y.entityKey),5);case 5:g.pu(u,3);break;case 2:return g.rT(u),u.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return u.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q))}})},Mlq=function(k,y,q,N,D){var n,T,I,H,K,A;
return g.B(function(c){switch(c.Z){case 1:if(n=N){c.Hl(2);break}return g.b(c,YiE([y]),3);case 3:T=c.N,n=T[0];case 2:return g.b(c,LRN(k,n,q,D),4);case 4:I=c.N;H=I.mainVideoEntity;K=I.channelEntity;g.zM(c,5);var u=oC(H.thumbnail),a=oC(K.avatar);return g.b(c,ZE(u.concat(a)),7);case 7:g.pu(c,0);break;case 5:A=g.rT(c),A instanceof Error&&A.message==="Failed to fetch"&&bH(A.message),g.XZ(c)}})},LRN=function(k,y,q,N){var D,n,T,I,H,K,A,c,u,a,x,r,f;
return g.B(function(P){switch(P.Z){case 1:q||(q=Date.now().toString());n=(D=y.channel)==null?void 0:D.offlineChannelData;T={id:g.OV(y.videoId,"ytMainChannelEntity"),channelId:n.channelId,title:n.title,avatar:n.thumbnail};I={key:g.OV(y.videoId,"mainVideoDownloadStateEntity"),playbackData:g.OV(y.videoId,"playbackData"),addedTimestampMillis:q,videoDownloadContextEntity:g.OV(y.videoId,"videoDownloadContextEntity")};H={key:g.OV(y.videoId,"videoPlaybackPositionEntity"),videoId:y.videoId,lastPlaybackPositionSeconds:"0"};
k.uw.W("html5_offline_playback_position_sync")&&(K={playbackPosition:H.key});A=g.OV(y.videoId,"mainVideoEntity");c={key:A,videoId:y.videoId,title:y.title,thumbnail:y.thumbnail,localizedStrings:{viewCount:y.shortViewCountText},userState:K,lengthSeconds:y.lengthSeconds?Number(y.lengthSeconds):void 0,publishedTimestampMillis:y.publishedTimestamp?(Number(y.publishedTimestamp)*1E3).toString():void 0,formattedDescription:y.description,owner:T.id,downloadState:I.key};if(!k.uw.W("woffle_enable_main_downloads_library")||
!N){P.Hl(2);break}return g.b(P,OeG(k.Z,[A]),3);case 3:if(x=P.N)u=x.mainDownloadsLibraryEntity,a=x.mainDownloadsListEntity;case 2:return f=KHw,r={key:g.OV(y.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.NM(I,f,r),g.b(P,mo(k.Z,{mode:"readwrite",Qi:!0},function(C){var V=$w(C,T,"ytMainChannelEntity"),Q=$w(C,I,"mainVideoDownloadStateEntity"),Y=$w(C,c,"mainVideoEntity");V=[V,Q,Y];k.uw.W("html5_offline_playback_position_sync")&&(Q=$w(C,H,"videoPlaybackPositionEntity"),
V.push(Q));u&&(Q=$w(C,u,"mainDownloadsLibraryEntity"),V.push(Q));a&&(Q=$w(C,a,"mainDownloadsListEntity"),V.push(Q));r&&(C=$w(C,r,"downloadStatusEntity"),V.push(C));return g.Gv.all(V)}),4);
case 4:return P.return({mainVideoEntity:c,channelEntity:T})}})},djx=function(k,y,q){this.Z=k;
this.uw=y;this.C=q},o7q=function(k,y){var q,N,D,n,T,I,H,K,A,c,u,a,x,r,f,P,C,V,Q,Y,l,h,qD,Ku,Z,d,J;
return g.B(function(X){switch(X.Z){case 1:return q=FD(y),N=[],g.b(X,ci.getInstance(),2);case 2:D=X.N;if(!D){X.Hl(3);break}return g.b(X,D.get("sdois"),4);case 4:return n=X.N,g.b(X,(I=D)==null?void 0:I.get("lmqf"),5);case 5:T=X.N;case 3:g.zM(X,6);if(n===void 0)throw Error("prefStorage or opt-in state is undefined");H=[];if(n){X.Hl(8);break}return g.b(X,feF(k.Z),9);case 9:H=X.N,H.reverse();case 8:if(!H.length){X.Hl(10);break}K=g.p(H);A=K.next();case 11:if(A.done){X.Hl(10);break}c=A.value;if(!c){X.Hl(12);
break}u=g.fs(c).entityId;return g.b(X,JN(k.Z,u),14);case 14:return a=X.N,a.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.b(X,lH(u,k.Z,{entityKey:c,actionType:y.actionType},k.C,a),12);case 12:A=K.next();X.Hl(11);break;case 10:return g.b(X,gLg(n,(x=T)!=null?x:"SD"),16);case 16:return r=X.N,g.b(X,r3g(r),17);case 17:f=ieG(r);if(!k.uw.W("woffle_enable_main_downloads_library")){X.Hl(18);break}if(n){X.Hl(19);break}return g.b(X,vLw(k.Z,g.xR),19);case 19:return g.b(X,PyL(k.Z,[g.xR]),18);
case 18:if((P=f)==null?0:P.length)for(C=g.p(f),V=C.next();!V.done;V=C.next())if(Y=Q=V.value,l=Y.actionType,h=Y.entityKey,qD=Y.actionMetadata,l&&h&&qD&&!g.L(qD,g7O)){l==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(qD.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(Ku=g.L(Q.actionMetadata,mS))Ku.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",Q.actionMetadata=Object.assign({},Q.actionMetadata,{mainVideoEntityActionMetadata:Ku});N.push(Q)}g.pu(X,7);break;
case 6:return Z=g.rT(X),d="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",J="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Z instanceof g.BN&&Z.type==="QUOTA_EXCEEDED"&&(d="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",J="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),X.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,d,J));case 7:return X.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q,N))}})},hHw=function(){zX.apply(this,arguments);
this.U="mainVideoEntity"},RHe=function(k,y,q){y=y===void 0?43200:y;
q=q===void 0?!0:q;var N=N===void 0?!1:N;var D,n,T;return g.B(function(I){switch(I.Z){case 1:if(!k.Y.tL())return I.return([]);D=[];g.zM(I,2);return g.b(I,LHx(y,q,N),4);case 4:D=I.N;g.pu(I,3);break;case 2:n=g.rT(I),n instanceof Error&&n.message==="No data"||n instanceof Error&&n.message==="Empty response body"&&bH(n.message);case 3:return T=rF1(k,D,q,"mainPlaylistEntity"),I.return(T)}})},eHq=function(k,y,q,N){N=N===void 0?!1:N;
var D,n,T,I,H,K,A,c,u,a,x,r,f,P,C;return g.B(function(V){switch(V.Z){case 1:return D=[],g.b(V,dtT(),2);case 2:return(n=V.N)||N?g.b(V,oLL(y,q),3):V.return([]);case 3:T=V.N;if((I=T)==null||!I.length)return V.return([]);H={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};K=g.p(T);A=K.next();case 4:if(A.done){V.Hl(6);break}u=c=A.value;a=u.actionType;x=u.entityKey;r=u.actionMetadata;if(!(a&&x&&r)||g.L(r,g7O)){V.Hl(5);break}a==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(r.offlineLoggingData=
H);f=g.fs(x);P=f.entityId;return g.b(V,p7(k,[P],"mainVideoEntity",a,r),8);case 8:C=V.N,D=D.concat(C);case 5:A=K.next();V.Hl(4);break;case 6:return V.return(D)}})},WRO=function(k,y){this.Z=k;
this.C=y},lyN=function(k,y){var q,N,D,n,T,I,H,K,A,c,u,a,x,r,f,P;
return g.B(function(C){switch(C.Z){case 1:return q=FD(y),N=g.fs(y.entityKey),D=N.entityId,n=[],g.zM(C,2),g.b(C,Zjq(k,D),4);case 4:n=C.N;if((T=n)==null||!T.length){C.Hl(5);break}return g.b(C,B5w(k.Z,y.entityKey),5);case 5:g.pu(C,3);break;case 2:return I=g.rT(C),H="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",K="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",I instanceof g.BN&&I.type==="QUOTA_EXCEEDED"&&(H="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",K="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
C.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,H,K));case 3:return A=[],g.b(C,A3E(k.Z,"musicTrack",n),7);case 7:n=C.N;if(n.length)for(c=g.p(n),u=c.next();!u.done;u=c.next())if(a=u.value,x=a.offlineVideoData,r=void 0,(r=x)==null?0:r.videoId)f=void 0,P=Number(((f=y.actionMetadata)==null?void 0:f.priority)||0)+1,A.push(TX("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",x.videoId,"musicTrack",P,i9,q4(y,x,D)));return C.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q,A))}})},
s0x=function(k,y){var q,N,D,n,T,I,H,K,A,c,u,a,x,r,f,P,C,V,Q,Y,l,h,qD,Ku,Z,d,J,X,W,s0,zF,Ae,Cu,qG,xN,JG,O,v,E,U,F,kU,TM,D7,M,AG,$U,wT,MD,wx,GF,cY,e6,MK,c9,Lw,d8,Rd,fk;
return g.B(function(gY){switch(gY.Z){case 1:return q=FD(y),N=y.entityKey,D=g.fs(N).entityId,n=[],T=!1,D==="!*$_ALL_ENTITIES_!*$"?(T=!0,g.b(gY,Oy(k.Z,"musicAlbumRelease"),5)):g.b(gY,fL(k.Z,N,"musicAlbumRelease"),4);case 4:(I=gY.N)&&n.push(I);gY.Hl(3);break;case 5:n=gY.N;case 3:if((H=n)==null||!H.length)return gY.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q));if(T){K=[];A=g.p(n);for(c=A.next();!c.done;c=A.next())u=c.value,a=g.fs(u.id).entityId,K.push(TX("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
a,"musicAlbumRelease",0,i9));return gY.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q,K))}x=[];r=n[0];f=void 0;if(!r.downloadMetadata){gY.Hl(6);break}return g.b(gY,fL(k.Z,r.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:P=gY.N,f=Number((V=(C=P)==null?void 0:C.addedTimestampMillis)!=null?V:"0")/1E3;case 6:return g.zM(gY,8),g.b(gY,Zjq(k,D,(Q=f)==null?void 0:Q.toString()),10);case 10:x=gY.N;g.pu(gY,9);break;case 8:Y=g.rT(gY);if(!(Y instanceof Error&&Y.message===
"No data")){if(Y instanceof Error&&Y.message==="Empty response body")bH(Y.message);else return l="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",h="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Y instanceof g.BN&&Y.type==="QUOTA_EXCEEDED"&&(l="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",h="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),gY.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,l,h));gY.Hl(9);break}return g.b(gY,k8(D,"musicAlbumRelease",k.Z,
y,k.C),9);case 9:qD=[];Ku=new Map;if((Z=x)==null?0:Z.length)for(d=g.p(x),J=d.next();!J.done;J=d.next())X=J.value,W=X.offlineVideoData,s0=void 0,((s0=W)==null?0:s0.videoId)&&Ku.set(W.videoId,W);zF=new Map;Ae=[];if((Cu=r)==null?0:(qG=Cu.tracks)==null?0:qG.length)for(xN=g.p(r.tracks),JG=xN.next();!JG.done;JG=xN.next())if(O=JG.value,v=g.fs(O).entityId)Ku.has(v)?(zF.set(v,Ku.get(v)),Ku.delete(v)):Ae.push(v);U=Number(((E=y.actionMetadata)==null?void 0:E.priority)||0)+1;F=g.p(Ku.entries());for(kU=F.next();!kU.done;kU=
F.next())TM=kU.value,D7=g.p(TM),M=D7.next().value,AG=D7.next().value,$U=M,wT=AG,qD.push(TX("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",$U,"musicTrack",U,i9,q4(y,wT)));MD=g.p(zF.entries());for(wx=MD.next();!wx.done;wx=MD.next())GF=wx.value,cY=g.p(GF),e6=cY.next().value,MK=cY.next().value,c9=e6,Lw=MK,qD.push(TX("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",c9,"musicTrack",U,i9,q4(y,Lw)));d8=g.p(Ae);for(Rd=d8.next();!Rd.done;Rd=d8.next())fk=Rd.value,qD.push(TX("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",fk,
"musicTrack",0,i9));return gY.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q,qD))}})},JFg=function(k,y){var q,N;
return g.B(function(D){switch(D.Z){case 1:return q=FD(y),g.zM(D,2),N=g.fs(y.entityKey).entityId,N==="!*$_ALL_ENTITIES_!*$"?g.b(D,yg(k.Z,y,k.C),5):g.b(D,k8(N,"musicAlbumRelease",k.Z,y,k.C),6);case 6:return g.b(D,Ut$(k.Z,y.entityKey),5);case 5:g.pu(D,3);break;case 2:return g.rT(D),D.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return D.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
q))}})},Zjq=function(k,y,q){var N,D,n;
return g.B(function(T){switch(T.Z){case 1:return g.b(T,Siq([y]),2);case 2:return N=T.N,g.b(T,tlT(k,N[0],q),3);case 3:return D=T.N,n=oC(D.thumbnailDetails),g.b(T,ZE(n),4);case 4:return T.return(N[0].videos)}})},tlT=function(k,y,q){var N,D,n,T,I,H,K,A,c,u,a,x,r,f;
return g.B(function(P){if(P.Z==1){N=y.additionalMetadadatas;D=void 0;if(N&&N.length>0)for(n=g.p(N),T=n.next();!T.done;T=n.next())if(I=T.value,I.offlineMusicPlaylistData){D=I.offlineMusicPlaylistData;break}H=y.playlistId;K=QFb(y);A=K.lE;c=K.Zw;u=q?(Number(q)*1E3).toString():Date.now().toString();a=y.lastModifiedTimestamp?(Number(y.lastModifiedTimestamp)*1E3).toString():"0";x={id:g.OV(H,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:c,lastModifiedTimestampMillis:a,addedTimestampMillis:u,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};r={id:g.OV(H,"musicAlbumRelease"),title:y.title,audioPlaylistId:H,trackCount:y.totalVideoCount,tracks:A,downloadMetadata:x.id};D&&(r.thumbnailDetails=(f=D.albumHqThumbnail)!=null?f:D.albumArtistThumbnail,r.artistDisplayName=D.albumArtistDisplayName,r.releaseDate=D.albumReleaseDate,r.contentRating={explicitType:D.albumReleaseExplicitType},r.releaseType=D.albumReleaseType);return g.b(P,mo(k.Z,{mode:"readwrite",Qi:!0},function(C){var V=$w(C,r,"musicAlbumRelease");
C=$w(C,x,"musicAlbumReleaseDownloadMetadataEntity");return g.Gv.all([V,C])}),2)}return P.return(r)})},kv$=function(k,y){this.Z=k;
this.C=y},qHT=function(k,y){var q,N,D,n,T,I,H,K,A,c,u,a,x,r,f,P;
return g.B(function(C){switch(C.Z){case 1:return q=FD(y),N=g.fs(y.entityKey),D=N.entityId,n=[],g.zM(C,2),g.b(C,y1q(k,D),4);case 4:n=C.N;if((T=n)==null||!T.length){C.Hl(5);break}return g.b(C,B5w(k.Z,y.entityKey),5);case 5:g.pu(C,3);break;case 2:return I=g.rT(C),H="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",K="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",I instanceof g.BN&&I.type==="QUOTA_EXCEEDED"&&(H="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",K="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
C.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,H,K));case 3:return A=[],g.b(C,A3E(k.Z,"musicTrack",n),7);case 7:n=C.N;if(n.length)for(c=g.p(n),u=c.next();!u.done;u=c.next())if(a=u.value,x=a.offlineVideoData,r=void 0,(r=x)==null?0:r.videoId)f=void 0,P=Number(((f=y.actionMetadata)==null?void 0:f.priority)||0)+1,A.push(TX("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",x.videoId,"musicTrack",P,f7,q4(y,x,D)));return C.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q,A))}})},
NbF=function(k,y){var q,N,D,n,T,I,H,K,A,c,u,a,x,r,f,P,C,V,Q,Y,l,h,qD,Ku,Z,d,J,X,W,s0,zF,Ae,Cu,qG,xN,JG,O,v,E,U,F,kU,TM,D7,M,AG,$U,wT,MD,wx,GF,cY,e6,MK,c9,Lw,d8,Rd,fk,gY,sL,eQ,jQ,Yx,FK,uX,SN,gy,Yo,n0,OL;
return g.B(function(DR){switch(DR.Z){case 1:return q=FD(y),N=y.entityKey,D=g.fs(N).entityId,n=[],T=!1,D==="!*$_ALL_ENTITIES_!*$"?(T=!0,g.b(DR,Oy(k.Z,"musicPlaylist"),5)):g.b(DR,fL(k.Z,N,"musicPlaylist"),4);case 4:(I=DR.N)&&n.push(I);DR.Hl(3);break;case 5:n=DR.N;case 3:if((H=n)==null||!H.length)return DR.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q));K=g.L(y.actionMetadata,Mk$);c=(A=K)==null?void 0:A.autoSync;u=[];x=a=!0;r=!1;f=void 0;if(!T&&c===!1){DR.Hl(6);break}g.zM(DR,7);return g.b(DR,
hIO(0,!!c,!0,n),9);case 9:u=DR.N;g.pu(DR,8);break;case 7:P=g.rT(DR);if(!(P instanceof Error&&P.message==="No data")){P instanceof Error&&P.message==="Empty response body"&&bH(P.message);DR.Hl(8);break}return D==="!*$_ALL_ENTITIES_!*$"?g.b(DR,yg(k.Z,y,k.C),8):g.b(DR,k8(D,"musicPlaylist",k.Z,y,k.C),8);case 8:if(!u.length||!T&&u[0].playlistId!==D)return DR.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q));case 6:if(T){C=[];V=g.p(u);for(Q=V.next();!Q.done;Q=V.next())Y=Q.value,Y.upToDate||
c&&!Y.shouldAutoSyncMetadata||!Y.playlistId||(l={autoSync:c},C.push(TX("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Y.playlistId,"musicPlaylist",0,f7,{musicPlaylistEntityActionMetadata:l})));return DR.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q,C))}u.length&&(h=u[0],r=!!h.upToDate,c&&(a=(qD=h.shouldAutoSyncMetadata)!=null?qD:!0,x=(Ku=h.shouldAutoSyncVideos)!=null?Ku:!0,h.checkInSeconds&&(f=h.checkInSeconds)));if(r||!a)return DR.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
q));Z=[];d=n[0];J=void 0;if(!d.downloadMetadata){DR.Hl(15);break}return g.b(DR,fL(k.Z,d.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:X=DR.N,J=Number((s0=(W=X)==null?void 0:W.addedTimestampMillis)!=null?s0:"0")/1E3;case 15:return g.zM(DR,17),g.b(DR,y1q(k,D,(zF=J)==null?void 0:zF.toString(),f),19);case 19:Z=DR.N;g.pu(DR,18);break;case 17:Ae=g.rT(DR);if(!(Ae instanceof Error&&Ae.message==="No data")){if(Ae instanceof Error&&Ae.message==="Empty response body")bH(Ae.message);else return Cu=
"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",qG="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Ae instanceof g.BN&&Ae.type==="QUOTA_EXCEEDED"&&(Cu="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",qG="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),DR.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,Cu,qG));DR.Hl(18);break}return g.b(DR,k8(D,"musicPlaylist",k.Z,y,k.C),18);case 18:if(!x)return DR.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
q));xN=[];JG=new Map;if((O=Z)==null?0:O.length)for(v=g.p(Z),E=v.next();!E.done;E=v.next())U=E.value,F=U.offlineVideoData,kU=void 0,((kU=F)==null?0:kU.videoId)&&JG.set(F.videoId,F);TM=new Map;D7=[];if((M=d)==null?0:(AG=M.tracks)==null?0:AG.length)for($U=g.p(d.tracks),wT=$U.next();!wT.done;wT=$U.next())if(MD=wT.value,wx=g.fs(MD).entityId)JG.has(wx)?(TM.set(wx,JG.get(wx)),JG.delete(wx)):D7.push(wx);cY=Number(((GF=y.actionMetadata)==null?void 0:GF.priority)||0)+1;e6=g.p(JG.entries());for(MK=e6.next();!MK.done;MK=
e6.next())c9=MK.value,Lw=g.p(c9),d8=Lw.next().value,Rd=Lw.next().value,fk=d8,gY=Rd,xN.push(TX("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",fk,"musicTrack",cY,f7,q4(y,gY)));sL=g.p(TM.entries());for(eQ=sL.next();!eQ.done;eQ=sL.next())jQ=eQ.value,Yx=g.p(jQ),FK=Yx.next().value,uX=Yx.next().value,SN=FK,gy=uX,xN.push(TX("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",SN,"musicTrack",cY,f7,q4(y,gy)));Yo=g.p(D7);for(n0=Yo.next();!n0.done;n0=Yo.next())OL=n0.value,xN.push(TX("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
OL,"musicTrack",0,f7));return DR.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q,xN))}})},DSG=function(k,y){var q,N;
return g.B(function(D){switch(D.Z){case 1:return q=FD(y),g.zM(D,2),N=g.fs(y.entityKey).entityId,N==="!*$_ALL_ENTITIES_!*$"?g.b(D,yg(k.Z,y,k.C),5):g.b(D,k8(N,"musicPlaylist",k.Z,y,k.C),6);case 6:return g.b(D,Ut$(k.Z,y.entityKey),5);case 5:g.pu(D,3);break;case 2:return g.rT(D),D.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return D.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
q))}})},y1q=function(k,y,q,N){var D,n,T;
return g.B(function(I){switch(I.Z){case 1:return g.b(I,Siq([y]),2);case 2:return D=I.N,g.b(I,nSx(k,D[0],q,N),3);case 3:return n=I.N,T=oC(n.thumbnailDetails),g.b(I,ZE(T),4);case 4:return I.return(D[0].videos)}})},nSx=function(k,y,q,N){var D,n,T,I,H,K,A,c,u;
return g.B(function(a){return a.Z==1?(D=y.playlistId,n=QFb(y),T=n.lE,I=n.Zw,H=q?(Number(q)*1E3).toString():Date.now().toString(),K=y.lastModifiedTimestamp?(Number(y.lastModifiedTimestamp)*1E3).toString():"0",A={id:g.OV(D,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:I,lastModifiedTimestampMillis:K,addedTimestampMillis:H,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},c={id:g.OV(D,"musicPlaylist"),title:y.title,playlistId:D,thumbnailDetails:y.thumbnail,visibility:TbG(y),trackCount:y.totalVideoCount,
tracks:T,downloadMetadata:A.id},N&&(((u=c)==null?0:u.entityMetadata)?c.entityMetadata.nextAutoRefreshIntervalSeconds=String(N):c&&(c.entityMetadata={nextAutoRefreshIntervalSeconds:String(N)})),g.b(a,mo(k.Z,{mode:"readwrite",Qi:!0},function(x){var r=$w(x,c,"musicPlaylist");x=$w(x,A,"musicPlaylistDownloadMetadataEntity");return g.Gv.all([r,x])}),2)):a.return(c)})},TbG=function(k){switch(k.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},wNN=function(k,y){this.Z=k;
this.C=y},A1T=function(k,y){var q,N,D,n,T,I,H,K,A,c,u,a,x;
return g.B(function(r){switch(r.Z){case 1:return q=FD(y),N=g.fs(y.entityKey),D=N.entityId,n=g.L(y.actionMetadata,Ice),g.zM(r,2),g.b(r,HSL(k,D,void 0,(T=n)==null?void 0:T.track,(I=n)==null?void 0:I.albumRelease),4);case 4:if((H=n)==null?0:H.playlistId){r.Hl(5);break}return g.b(r,B5w(k.Z,y.entityKey),5);case 5:g.pu(r,3);break;case 2:return K=g.rT(r),A="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",c="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",K instanceof g.BN&&K.type==="QUOTA_EXCEEDED"&&
(A="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",c="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),r.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,A,c));case 3:a=Number(((u=y.actionMetadata)==null?void 0:u.priority)||0)+1;var f=(f=g.L(y.actionMetadata,Ice))?{playbackDataActionMetadata:{maximumDownloadQuality:f.maximumDownloadQuality}}:void 0;x=TX("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",D,"playbackData",a,Kcq,f);return r.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
q,[x]))}})},c1L=function(k,y){var q,N,D,n,T,I,H,K,A,c,u,a,x,r,f;
return g.B(function(P){switch(P.Z){case 1:return q=FD(y),N=g.fs(y.entityKey),D=N.entityId,g.b(P,fL(k.Z,y.entityKey,"musicTrack"),2);case 2:n=P.N;if(!n){T=void 0;P.Hl(3);break}return g.b(P,fL(k.Z,n.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:T=P.N;case 3:I=T;if(!n||!I)return P.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q));K=g.L(y.actionMetadata,Ice);g.zM(P,5);return g.b(P,HSL(k,D,I.addedTimestampMillis,(A=K)==null?void 0:A.track,(c=K)==null?void 0:c.albumRelease),
7);case 7:a=Number(((u=y.actionMetadata)==null?void 0:u.priority)||0)+1;H=TX("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",D,"playbackData",a,Kcq);g.pu(P,6);break;case 5:x=g.rT(P);if(!(x instanceof Error&&x.message==="No data")){if(x instanceof Error&&x.message==="Empty response body")bH(x.message);else return r="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",f="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",x instanceof g.BN&&x.type==="QUOTA_EXCEEDED"&&(r="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
f="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),P.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,r,f));P.Hl(6);break}return g.b(P,tN(D,k.Z,y,k.C),6);case 6:return P.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q,H?[H]:void 0))}})},uv$=function(k,y){var q,N;
return g.B(function(D){switch(D.Z){case 1:return q=FD(y),g.zM(D,2),N=g.fs(y.entityKey).entityId,N==="!*$_ALL_ENTITIES_!*$"?g.b(D,yg(k.Z,y,k.C),5):g.b(D,tN(N,k.Z,y,k.C),6);case 6:return g.b(D,Ut$(k.Z,y.entityKey),5);case 5:g.pu(D,3);break;case 2:return g.rT(D),D.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return D.return(new ww("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
q))}})},HSL=function(k,y,q,N,D){var n,T,I,H,K,A;
return g.B(function(c){switch(c.Z){case 1:if(n=N){c.Hl(2);break}return g.b(c,YiE([y]),3);case 3:T=c.N,I=T[0],n=Vkb(I);case 2:return g.b(c,acL(k,n,y,D,q),4);case 4:H=c.N;K=H.musicTrackEntity;A=H.mf;var u=oC(K.thumbnailDetails),a=[];A&&(a=oC(A.thumbnailDetails));return g.b(c,ZE(u.concat(a)),0)}})},acL=function(k,y,q,N,D){var n;
return g.B(function(T){return T.Z==1?(D||(D=Date.now().toString()),n={id:g.OV(q,"musicTrackDownloadMetadataEntity"),playbackData:g.OV(q,"playbackData"),addedTimestampMillis:D,videoDownloadContextEntity:g.OV(q,"videoDownloadContextEntity")},N&&(y.albumRelease=N.id),g.b(T,mo(k.Z,{mode:"readwrite",Qi:!0},function(I){var H=[],K=$w(I,n,"musicTrackDownloadMetadataEntity");H.push(K);K=$w(I,y,"musicTrack");H.push(K);N&&(I=$w(I,N,"musicAlbumRelease"),H.push(I));return g.Gv.all(H)}),2)):T.Z!=3?g.b(T,LL(q,"musicTrackDownloadMetadataEntity",
k.Z,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):T.return({musicTrackEntity:y,
mf:N})})},Om=function(){zX.apply(this,arguments);
this.U="musicTrack"},xSB=function(k,y,q){y=y===void 0?43200:y;
q=q===void 0?!0:q;var N=N===void 0?!1:N;var D,n;return g.B(function(T){switch(T.Z){case 1:if(!k.Y.tL())return T.return([]);D=[];g.zM(T,2);return g.b(T,hIO(y,q,N),4);case 4:D=T.N;g.pu(T,3);break;case 2:g.rT(T);case 3:return n=rF1(k,D,q,"musicPlaylist"),T.return(n)}})},jmq=function(){g.pi.apply(this,arguments);
var k=this;this.events=new g.to(this);this.uw=this.player.S();this.je={Rqj:function(){return k.Z},
qj:function(){return k.qj()},
Os:function(y){return k.Os(y)}}},XNe=function(k){var y;
k=g.L((y=k.getWatchNextResponse())==null?void 0:y.currentVideoEndpoint,g.a_);if(k==null?0:k.playlistId)var q=k.playlistId;return q},$SL=function(k,y){var q,N,D,n;
return g.B(function(T){if(T.Z==1){q=y.clientPlaybackNonce;N={cpn:q,offlineSourceVisualElement:g.GW(y.eb||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};y.N&&(N.videoFmt=Number(y.N.itag));y.V&&(N.audioFmt=Number(y.V.itag));if((D=XNe(y))&&y.videoId){var I=y.videoId;I=D!=="PPSV"?Promise.resolve(!1):k.Z.UY(I);T=g.b(T,I,3)}else T=T.Hl(2);return T}T.Z!=2&&(n=T.N)&&(N.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");k.N=q;g.OH("offlinePlaybackStarted",N);g.XZ(T)})};
g.z(KL,Hi);g.nu.Object.defineProperties(KL.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.Z.entityMetadata},
set:function(k){this.Z.entityMetadata=k}}});
g.z(j7E,KL);j7E.prototype.N=function(){return[]};
g.z(XwB,KL);XwB.prototype.N=function(){return[]};
g.z($WT,KL);$WT.prototype.N=function(){return[]};
g.z(zYe,KL);zYe.prototype.N=function(){var k=[];this.Z.alternateChannel&&k.push(this.Z.alternateChannel);this.Z.alternateChannelList&&k.push.apply(k,g.m(this.Z.alternateChannelList));this.Z.oneofChannelEntity&&k.push(this.Z.oneofChannelEntity);return[].concat(g.m(new Set(k)))};
g.z(pwL,KL);pwL.prototype.N=function(){var k=[];this.Z.entryCollection&&k.push(this.Z.entryCollection);return[].concat(g.m(new Set(k)))};
g.z(rcN,Hi);rcN.prototype.N=function(){var k=[];this.Z.video&&k.push(this.Z.video);return[].concat(g.m(new Set(k)))};
g.z(mWE,KL);mWE.prototype.N=function(){var k=[];this.Z.parentPlaylist&&k.push(this.Z.parentPlaylist);if(this.Z.entries)for(var y=g.p(this.Z.entries),q=y.next();!q.done;q=y.next())k.push.apply(k,g.m((new rcN(q.value)).N()));return[].concat(g.m(new Set(k)))};
g.z(i6q,KL);i6q.prototype.N=function(){var k=[];this.Z.descriptionEntity&&k.push(this.Z.descriptionEntity);this.Z.creators&&k.push.apply(k,g.m(this.Z.creators));this.Z.theBiggestFan&&k.push(this.Z.theBiggestFan);return[].concat(g.m(new Set(k)))};
g.z(fW$,KL);fW$.prototype.N=function(){return[]};
g.z(O6O,KL);O6O.prototype.N=function(){return[]};
g.z(PME,KL);PME.prototype.N=function(){return[]};
g.z(vCw,KL);vCw.prototype.N=function(){return[]};
g.z(CMO,KL);CMO.prototype.N=function(){return[]};
g.z(ECO,KL);ECO.prototype.N=function(){return[]};
g.z(b6g,KL);b6g.prototype.N=function(){return[]};
g.z(VPB,KL);VPB.prototype.N=function(){return[]};
g.z(BuE,KL);BuE.prototype.N=function(){return[]};
g.z(UWq,KL);UWq.prototype.N=function(){var k=[];this.Z.downloadsList&&k.push(this.Z.downloadsList);this.Z.smartDownloadsList&&k.push(this.Z.smartDownloadsList);this.Z.recommendedDownloadsList&&k.push(this.Z.recommendedDownloadsList);this.Z.refresh&&k.push(this.Z.refresh);return[].concat(g.m(new Set(k)))};
g.z(Q7N,Hi);Q7N.prototype.N=function(){var k=[];this.Z.video&&k.push(this.Z.video);this.Z.playlist&&k.push(this.Z.playlist);this.Z.videoItem&&k.push(this.Z.videoItem);this.Z.playlistItem&&k.push(this.Z.playlistItem);return[].concat(g.m(new Set(k)))};
g.z(MPb,KL);MPb.prototype.N=function(){var k=[];this.Z.refresh&&k.push(this.Z.refresh);if(this.Z.downloads)for(var y=g.p(this.Z.downloads),q=y.next();!q.done;q=y.next())k.push.apply(k,g.m((new Q7N(q.value)).N()));return[].concat(g.m(new Set(k)))};
g.z(Fdg,KL);Fdg.prototype.N=function(){var k=[];this.Z.localImageEntities&&k.push.apply(k,g.m(this.Z.localImageEntities));return[].concat(g.m(new Set(k)))};
g.z(Ytx,KL);Ytx.prototype.N=function(){var k=[];this.Z.playbackData&&k.push(this.Z.playbackData);this.Z.localImageEntities&&k.push.apply(k,g.m(this.Z.localImageEntities));this.Z.videoDownloadContextEntity&&k.push(this.Z.videoDownloadContextEntity);return[].concat(g.m(new Set(k)))};
g.z(St$,KL);St$.prototype.N=function(){return[]};
g.z(Gug,KL);Gug.prototype.N=function(){var k=[];this.Z.fakeChildren&&k.push.apply(k,g.m(this.Z.fakeChildren));return[].concat(g.m(new Set(k)))};
g.z(LdO,KL);LdO.prototype.N=function(){var k=[];this.Z.video&&k.push(this.Z.video);this.Z.playbackData&&k.push(this.Z.playbackData);this.Z.offlineVideoPolicy&&k.push(this.Z.offlineVideoPolicy);return[].concat(g.m(new Set(k)))};
g.z(dW$,KL);dW$.prototype.N=function(){return[]};
g.z(gCe,KL);gCe.prototype.N=function(){var k=[];this.Z.channelOwner&&k.push(this.Z.channelOwner);this.Z.videos&&k.push.apply(k,g.m(this.Z.videos));this.Z.collaboratorChannels&&k.push.apply(k,g.m(this.Z.collaboratorChannels));this.Z.downloadState&&k.push(this.Z.downloadState);this.Z.refresh&&k.push(this.Z.refresh);return[].concat(g.m(new Set(k)))};
g.z(oCN,KL);oCN.prototype.N=function(){var k=[];this.Z.video&&k.push(this.Z.video);this.Z.channelContributor&&k.push(this.Z.channelContributor);return[].concat(g.m(new Set(k)))};
g.z(hYg,Hi);hYg.prototype.N=function(){var k=[];this.Z.localImageEntities&&k.push.apply(k,g.m(this.Z.localImageEntities));this.Z.videoDownloadContextEntity&&k.push(this.Z.videoDownloadContextEntity);return[].concat(g.m(new Set(k)))};
g.z(RYb,Hi);RYb.prototype.N=function(){var k=[];this.Z.recommendedVideoMetadata&&k.push.apply(k,g.m((new hYg(this.Z.recommendedVideoMetadata)).N()));return[].concat(g.m(new Set(k)))};
g.z(eYG,Hi);eYG.prototype.N=function(){var k=[];this.Z.playbackPosition&&k.push(this.Z.playbackPosition);return[].concat(g.m(new Set(k)))};
g.z(Wde,KL);Wde.prototype.N=function(){var k=[];this.Z.owner&&k.push(this.Z.owner);this.Z.downloadState&&k.push(this.Z.downloadState);this.Z.userState&&k.push.apply(k,g.m((new eYG(this.Z.userState)).N()));this.Z.additionalMetadata&&k.push.apply(k,g.m((new RYb(this.Z.additionalMetadata)).N()));return[].concat(g.m(new Set(k)))};
g.z(Z6E,KL);Z6E.prototype.N=function(){var k=[];this.Z.userChannelDetails&&k.push(this.Z.userChannelDetails);return[].concat(g.m(new Set(k)))};
g.z(lW1,KL);lW1.prototype.N=function(){var k=[];this.Z.channelOwner&&k.push(this.Z.channelOwner);this.Z.playbackPosition&&k.push(this.Z.playbackPosition);this.Z.localImageEntities&&k.push.apply(k,g.m(this.Z.localImageEntities));this.Z.downloadStatus&&k.push(this.Z.downloadStatus);return[].concat(g.m(new Set(k)))};
g.z(s7x,KL);s7x.prototype.N=function(){return[]};
g.z(JcF,KL);JcF.prototype.N=function(){return[]};
g.z(tPB,KL);tPB.prototype.N=function(){return[]};
g.z(ksG,KL);ksG.prototype.N=function(){return[]};
g.z(yUF,KL);yUF.prototype.N=function(){return[]};
g.z(qJN,KL);qJN.prototype.N=function(){return[]};
g.z(NEx,KL);NEx.prototype.N=function(){return[]};
g.z(DQ$,KL);DQ$.prototype.N=function(){return[]};
g.z(ngq,KL);ngq.prototype.N=function(){return[]};
g.z(TEN,KL);TEN.prototype.N=function(){return[]};
g.z(wIT,KL);wIT.prototype.N=function(){var k=[];this.Z.trackDownloadMetadatas&&k.push.apply(k,g.m(this.Z.trackDownloadMetadatas));return[].concat(g.m(new Set(k)))};
g.z(IdN,KL);
IdN.prototype.N=function(){var k=[];this.Z.downloadedTracks&&k.push.apply(k,g.m(this.Z.downloadedTracks));this.Z.smartDownloadedTracks&&k.push.apply(k,g.m(this.Z.smartDownloadedTracks));this.Z.downloadedEpisodes&&k.push.apply(k,g.m(this.Z.downloadedEpisodes));this.Z.downloadedAlbumReleases&&k.push.apply(k,g.m(this.Z.downloadedAlbumReleases));this.Z.smartDownloadedAlbumReleases&&k.push.apply(k,g.m(this.Z.smartDownloadedAlbumReleases));this.Z.downloadedPlaylists&&k.push.apply(k,g.m(this.Z.downloadedPlaylists));this.Z.smartDownloadedPlaylists&&
k.push.apply(k,g.m(this.Z.smartDownloadedPlaylists));this.Z.metadataOnlyTracks&&k.push.apply(k,g.m(this.Z.metadataOnlyTracks));return[].concat(g.m(new Set(k)))};
g.z(HtB,KL);HtB.prototype.N=function(){var k=[];this.Z.trackDownloadMetadatas&&k.push.apply(k,g.m(this.Z.trackDownloadMetadatas));return[].concat(g.m(new Set(k)))};
g.z(KxB,KL);KxB.prototype.N=function(){var k=[];this.Z.playbackData&&k.push(this.Z.playbackData);this.Z.localImageEntities&&k.push.apply(k,g.m(this.Z.localImageEntities));this.Z.videoDownloadContextEntity&&k.push(this.Z.videoDownloadContextEntity);return[].concat(g.m(new Set(k)))};
g.z(AUN,KL);AUN.prototype.N=function(){var k=[];this.Z.musicLibraryStatusEntity&&k.push(this.Z.musicLibraryStatusEntity);this.Z.primaryArtists&&k.push.apply(k,g.m(this.Z.primaryArtists));this.Z.details&&k.push(this.Z.details);this.Z.userDetails&&k.push(this.Z.userDetails);this.Z.tracks&&k.push.apply(k,g.m(this.Z.tracks));this.Z.share&&k.push(this.Z.share);this.Z.downloadMetadata&&k.push(this.Z.downloadMetadata);this.Z.refresh&&k.push(this.Z.refresh);return[].concat(g.m(new Set(k)))};
g.z(cUF,KL);cUF.prototype.N=function(){var k=[];this.Z.albumRelease&&k.push(this.Z.albumRelease);this.Z.tracks&&k.push.apply(k,g.m(this.Z.tracks));return[].concat(g.m(new Set(k)))};
g.z(uEb,KL);uEb.prototype.N=function(){var k=[];this.Z.albumRelease&&k.push(this.Z.albumRelease);return[].concat(g.m(new Set(k)))};
g.z(adT,KL);adT.prototype.N=function(){var k=[];this.Z.details&&k.push(this.Z.details);this.Z.userDetails&&k.push(this.Z.userDetails);return[].concat(g.m(new Set(k)))};
g.z(xQb,KL);xQb.prototype.N=function(){var k=[];this.Z.parentArtist&&k.push(this.Z.parentArtist);return[].concat(g.m(new Set(k)))};
g.z(jzg,KL);jzg.prototype.N=function(){var k=[];this.Z.parentArtist&&k.push(this.Z.parentArtist);return[].concat(g.m(new Set(k)))};
g.z(XIg,KL);XIg.prototype.N=function(){return[]};
g.z($QO,KL);$QO.prototype.N=function(){return[]};
g.z(zGg,Hi);zGg.prototype.N=function(){var k=[];this.Z.creatorEntity&&k.push(this.Z.creatorEntity);return[].concat(g.m(new Set(k)))};
g.z(pIN,KL);
pIN.prototype.N=function(){var k=[];this.Z.tracks&&k.push.apply(k,g.m(this.Z.tracks));this.Z.refresh&&k.push(this.Z.refresh);this.Z.musicLibraryStatusEntity&&k.push(this.Z.musicLibraryStatusEntity);this.Z.details&&k.push(this.Z.details);this.Z.downloadMetadata&&k.push(this.Z.downloadMetadata);this.Z.sideloadMetadata&&k.push(this.Z.sideloadMetadata);this.Z.userDetails&&k.push(this.Z.userDetails);this.Z.entryCollection&&k.push(this.Z.entryCollection);this.Z.share&&k.push(this.Z.share);this.Z.podcastShowAdditionalMetadata&&k.push.apply(k,
g.m((new zGg(this.Z.podcastShowAdditionalMetadata)).N()));return[].concat(g.m(new Set(k)))};
g.z(rUO,KL);rUO.prototype.N=function(){return[]};
g.z(mQw,KL);
mQw.prototype.N=function(){var k=[];this.Z.musicLibraryStatusEntity&&k.push(this.Z.musicLibraryStatusEntity);this.Z.artists&&k.push.apply(k,g.m(this.Z.artists));this.Z.audioModeVersion&&k.push(this.Z.audioModeVersion);this.Z.videoModeVersion&&k.push(this.Z.videoModeVersion);this.Z.userDetails&&k.push(this.Z.userDetails);this.Z.details&&k.push(this.Z.details);this.Z.albumRelease&&k.push(this.Z.albumRelease);this.Z.share&&k.push(this.Z.share);this.Z.libraryEdit&&k.push(this.Z.libraryEdit);this.Z.downloadMetadata&&
k.push(this.Z.downloadMetadata);this.Z.playbackPosition&&k.push(this.Z.playbackPosition);this.Z.lyrics&&k.push(this.Z.lyrics);return[].concat(g.m(new Set(k)))};
g.z(itO,KL);itO.prototype.N=function(){var k=[];this.Z.parentTrack&&k.push(this.Z.parentTrack);return[].concat(g.m(new Set(k)))};
g.z(fdF,KL);fdF.prototype.N=function(){var k=[];this.Z.parentTrack&&k.push(this.Z.parentTrack);return[].concat(g.m(new Set(k)))};
g.z(OtG,KL);OtG.prototype.N=function(){return[]};
g.z(PTO,KL);PTO.prototype.N=function(){return[]};
g.z(vgb,KL);vgb.prototype.N=function(){return[]};
g.z(CTb,KL);CTb.prototype.N=function(){return[]};
g.z(EgF,KL);EgF.prototype.N=function(){var k=[];this.Z.transfer&&k.push(this.Z.transfer);this.Z.adsPlaybackData&&k.push.apply(k,g.m(this.Z.adsPlaybackData));this.Z.drmLicense&&k.push(this.Z.drmLicense);this.Z.offlineVideoPolicy&&k.push(this.Z.offlineVideoPolicy);this.Z.videoDownloadContextEntity&&k.push(this.Z.videoDownloadContextEntity);return[].concat(g.m(new Set(k)))};
g.z(btw,KL);btw.prototype.N=function(){return[]};
g.z(VTL,KL);VTL.prototype.N=function(){var k=[];this.Z.offlineVideoStreams&&k.push.apply(k,g.m(this.Z.offlineVideoStreams));this.Z.captionTrack&&k.push.apply(k,g.m(this.Z.captionTrack));return[].concat(g.m(new Set(k)))};
g.z(BEF,KL);BEF.prototype.N=function(){return[]};
g.z(UQG,KL);UQG.prototype.N=function(){return[]};
g.z(QzT,KL);QzT.prototype.N=function(){return[]};
g.z(MTO,KL);MTO.prototype.N=function(){return[]};
g.z(FxT,KL);FxT.prototype.N=function(){return[]};
g.z(YJF,KL);YJF.prototype.N=function(){return[]};
g.z(SJg,KL);SJg.prototype.N=function(){return[]};
g.z(GsB,KL);GsB.prototype.N=function(){return[]};
g.z(LxG,KL);LxG.prototype.N=function(){return[]};
g.z(dQg,KL);dQg.prototype.N=function(){return[]};
g.z(ggT,KL);ggT.prototype.N=function(){return[]};
g.z(ogN,KL);ogN.prototype.N=function(){return[]};
g.z(hGb,KL);hGb.prototype.N=function(){return[]};
g.z(RGB,KL);RGB.prototype.N=function(){return[]};
g.z(eGO,KL);eGO.prototype.N=function(){return[]};
g.z(Wxq,KL);Wxq.prototype.N=function(){return[]};
g.z(Ztg,KL);Ztg.prototype.N=function(){return[]};
var RI$=["browse","music/browse","unplugged/browse"],sF$=["offline/playlist_sync_check"],FHb=["offline"],eI1=["offline/offline_video_playback_position_sync"],Zeb=["offline/get_playback_data_entity"],AN;ci.getInstance=function(){return g.B(function(k){return k.return(new Promise(function(y){g.aw().then(function(q){q?(ci.instance||(ci.instance=new ci(q)),y(ci.instance)):y(void 0)})}))})};
ci.prototype.get=function(k){var y=this,q,N,D;return g.B(function(n){if(n.Z==1)return g.b(n,tTb(y.token),2);if(n.Z!=3)return q=n.N,g.b(n,q.get("prefs",k),3);N=n.N;if(!N)return n.return();D=(0,g.om)();return N.expirationTimestampMs<=D?n.return():n.return(N.value)})};
ci.prototype.set=function(k,y,q){q=q===void 0?31536E3:q;var N=this,D,n,T;return g.B(function(I){if(I.Z==1)return D=(0,g.om)(),n={key:k,value:y,expirationTimestampMs:D+q*1E3},g.b(I,tTb(N.token),2);T=I.N;return g.b(I,g.la(T,"prefs",n),0)})};
ci.prototype.remove=function(k){var y=this,q;return g.B(function(N){if(N.Z==1)return g.b(N,tTb(y.token),2);q=N.N;return g.b(N,q.delete("prefs",k),0)})};
g.z(uH,g.HN);g.z(aC,DgL);aC.prototype.C=function(k,y){y=TjL(y);k=(new TextEncoder).encode(JSON.stringify(k));return this.Z.encrypt(k,y)};
aC.prototype.N=function(k,y){if(!(k instanceof Uint8Array))throw khw(1);var q=new TextDecoder;y=TjL(y);k=this.Z.decrypt(k,y);return JSON.parse(q.decode(k))};
var w3G={accountLinkStatusEntity:PME,booleanEntity:$WT,buttonEntity:dQg,captionTrack:OtG,channelHandle:j7E,commerceAcquisitionClientPayloadEntity:ogN,commerceCartListEntity:hGb,contextNoteFeedEntityPayload:XwB,continuationTokenEntity:dW$,downloadQualityPickerEntity:b6g,downloadsPageRefreshTokenEntity:BuE,downloadsPageViewConfigurationEntity:s7x,downloadStatusEntity:VPB,sfvAudioItemCurrentlyPlayingEntity:UQG,emojiFountainDataEntity:GsB,emojiCustomizationSetEntity:SJg,fakeChannel:zYe,fakePlaylist:pwL,
fakePlaylistEntryCollection:mWE,fakeVideo:i6q,fakeVideoDescription:fW$,featuredProductsEntity:DQ$,flowStateEntity:O6O,iconBadgeEntity:RGB,interstitialInteractionStateEntity:CMO,liveChatPollStateEntity:ECO,liveReactionsDataEntity:LxG,logoEntity:vCw,macroMarkerEntity:JcF,mainDownloadsLibraryEntity:UWq,mainDownloadsListEntity:MPb,mainPlaylistDownloadStateEntity:Fdg,mainPlaylistEntity:gCe,mainPlaylistVideoEntity:oCN,mainVideoDownloadStateEntity:Ytx,mainVideoEntity:Wde,markersEngagementPanelSyncEntity:tPB,
markersVisibilityOverrideEntity:ksG,musicAlbumReleaseDetail:cUF,musicAlbumReleaseDownloadMetadataEntity:wIT,musicAlbumRelease:AUN,musicAlbumReleaseUserDetail:uEb,musicArtistDetail:xQb,musicArtist:adT,musicArtistUserDetail:jzg,musicDownloadsLibraryEntity:IdN,musicLibraryEdit:XIg,musicLibraryStatusEntity:$QO,musicPlaylist:pIN,musicPlaylistDownloadMetadataEntity:HtB,musicShare:rUO,musicTrackDetail:itO,musicTrackDownloadMetadataEntity:KxB,musicTrack:mQw,musicTrackUserDetail:fdF,offlineOrchestrationActionWrapperEntity:PTO,
offlineVideoPolicy:vgb,offlineVideoStreams:CTb,offlineabilityEntity:St$,orchestrationWebSamplingEntity:Gug,pageHeaderEntity:FxT,pdpStateEntity:eGO,pinnedProductEntity:ngq,playbackData:EgF,playerStateEntity:yUF,quantityIncrementerEntity:Wxq,refresh:btw,saveToPlaylistListEntity:QzT,settingEntity:MTO,suggestedFeedbackChipStateEntity:qJN,transfer:VTL,trendingOfferEntity:TEN,videoDownloadContextEntity:BEF,videoOverviewAsyncDataEntity:Ztg,videoPlaybackPositionEntity:ggT,votingEntity:YJF,ytMainChannelEntity:Z6E,
youchatPendingResponseEntity:NEx,ytMainDownloadedVideoEntity:LdO,ytMainVideoEntity:lW1};g.z(pL,DgL);pL.prototype.C=function(k){return k};
pL.prototype.N=function(k){if(k instanceof Uint8Array)throw khw(0);return k};
g.z(rv,g.S);rv.prototype.observe=function(k){var y=this;this.observers.push(k);return function(){var q=y.observers.indexOf(k);q>=0&&y.observers.splice(q,1)}};
rv.prototype.N=function(k){r9w(this,k.data)};
rv.prototype.gF=function(){this.channel.close()};
var Pe$,mtO=new g.d5("elementsCommand");var sy=new g.d5("entityBatchUpdate");var KHw=new g.d5("downloadStatusEntity");var v7B=new g.d5("mainPlaylistEntityActionMetadata");var mS=new g.d5("mainVideoEntityActionMetadata");var Mk$=new g.d5("musicPlaylistEntityActionMetadata");var Ice=new g.d5("musicTrackEntityActionMetadata");var g7O=new g.d5("localImageEntityActionMetadata");var I1=new g.d5("playbackDataActionMetadata");var iVN=new g.d5("transferEntityActionMetadata");var IIF=new g.d5("videoPlaybackPositionEntityActionMetadata");var dgb;new g.mI;new g.mI;eRg.prototype.request=function(k,y,q){y=y===void 0?{}:y;return this.locks.request(k,y,function(N){return q(N)})};var Ey=g.FZ.caches,CL,J9F;vi.prototype.open=function(k){return Ey.open(luT(k))};
vi.prototype.has=function(k){return Ey.has(luT(k))};
vi.prototype.delete=function(k){return Ey.delete(luT(k))};
vi.prototype.match=function(k,y){var q=this,N,D,n,T,I,H;return g.B(function(K){switch(K.Z){case 1:return g.b(K,q.keys(),2);case 2:N=K.N,D=g.p(N),n=D.next();case 3:if(n.done){K.Hl(5);break}T=n.value;return g.b(K,q.open(T),6);case 6:return I=K.N,g.b(K,I.match(k,y),7);case 7:if(H=K.N)return K.return(H);n=D.next();K.Hl(3);break;case 5:return K.return()}})};
g.z(ZD$,vi);ZD$.prototype.keys=function(){var k,y,q,N,D,n,T,I,H;return g.B(function(K){if(K.Z==1)return k=[],y=g.KS("CacheStorage keys"),g.b(K,Ey.keys(),2);q=K.N;N=g.p(q);for(D=N.next();!D.done;D=N.next()){n=D.value;var A=n.indexOf(":");T=A===-1?{IS:n}:{IS:n.substring(0,A),datasyncId:n.substring(A+1)};I=T.IS;H=T.datasyncId;H===y&&k.push(I)}return K.return(k)})};g.z(VU,g.S);VU.prototype.C=function(k){this.api.Sb("onOfflineOperationFailure",k.data)};
VU.prototype.V=function(k){this.api.publish("offlinetransferpause",k.data)};
VU.prototype.gF=function(){var k;(k=this.Z)==null||k.close();var y;(y=this.N)==null||y.close()};y3x.prototype.sG=function(){this.Z&&Uy(this)};
y3x.prototype.xp=function(){this.N&&this.N.resolve();this.C=this.Z=!1;this.U()};var GfB=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var zIG="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var bex="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.z(tkT,n7);tkT.prototype.N=function(k){return Yw(k)?qPG(this,k):SH(k)?nTb(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};g.z(TeF,n7);TeF.prototype.N=function(k){return SH(k)?w1w(this,k):HeB(k)?HVO(this,k):Gn(k)?K$E(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};g.w=AwB.prototype;g.w.qXS=function(k){var y=this,q,N,D,n;return g.B(function(T){if(!g.e(k.state,128))return T.Hl(0);q=k.state.xg;var I=(N=q)==null?void 0:N.errorCode,H=(D=q)==null?void 0:D.sU;n=I==="net.connect"&&H===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(I==null?0:I.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.b(T,y.cC(y.player.getVideoData().videoId,n),0)})};
g.w.cC=function(k,y){var q=this;return g.B(function(N){if(N.Z==1){if(q.N)return N.return();q.N=!0;return y==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(A_(q,k,!1,!0),N.Hl(0)):g.b(N,K7(q,k),3)}g.GR(k,4);return g.b(N,q.Z.cC(y),0)})};
g.w.EH=function(k){k.status===2?(k.status!==this.C&&(Iyb(this.Z),g.GR(k.videoId,2)),k.Sa&&u_1(this.Z,k.videoId,k.Sa)):k.status===4?(K7(this,k.videoId),this.cC(k.videoId,k.P7?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):k.status===1&&cFg(this.Z);this.C=k.status;this.api.Sb("localmediachange",{videoId:k.videoId,status:k.status})};
g.w.YK=function(){var k=this,y;return g.B(function(q){if(q.Z==1){if(k.N)return q.return();k.N=!0;y=k.player.getVideoData().videoId;return g.b(q,K7(k,y),2)}return g.b(q,k.Z.YK(),0)})};
g.w.LV=function(k){switch(k){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.w.W=function(k){return this.api.S().W(k)};g.z($5x,n7);$5x.prototype.N=function(k){return Yw(k)?p1G(this,k):SH(k)?rwL(this,k):HeB(k)?m5E(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};CWe.prototype.Z=function(k,y){var q=k.action.actionMetadata.priority-y.action.actionMetadata.priority;q===0&&(k.Z<y.Z?q=-1:k.Z>y.Z&&(q=1));return q};g.z(c0,g.S);c0.prototype.gF=function(){this.U&&this.U();g.S.prototype.gF.call(this)};
c0.prototype.createAction=function(k,y){var q=g.fs(k.entityKey).entityType,N=g.Si(16);return new hN(q,N,k,y.actionId,y.rootActionId)};
c0.prototype.ND=function(k){var y=this,q,N,D,n,T,I,H,K,A;return g.B(function(c){if(c.Z==1){if(y.VM())return c.return();N=(q=k.offlineOrchestrationActionWrapperEntity)!=null?q:new Set;D=[];n=g.p(N);for(T=n.next();!T.done;T=n.next())I=T.value,H=g.fs(I),K=H.entityId,VZe(y.Z,K)||D.push(I);return g.b(c,gTL(y,D),2)}A=c.N;return g.b(c,d5b(y,A),0)})};
c0.prototype.retry=function(){var k=this;return g.B(function(y){return g.b(y,oTE(k),0)})};g.z(u9,g.S);u9.prototype.gF=function(){this.N&&this.N();g.S.prototype.gF.call(this)};
u9.prototype.C=function(k){var y=this,q,N,D,n,T,I,H,K;return g.B(function(A){N=(q=k.transfer)!=null?q:new Set;D=[];n=g.p(N);for(T=n.next();!T.done;T=n.next())I=T.value,H=g.fs(I),K=H.entityId,D.push(K);return D.length===0?A.return():g.b(A,lIF(y,D),0)})};g.z(yFg,g.S);g.w=yFg.prototype;g.w.gF=function(){this.AV&&this.AV();this.pS.dispose();this.V.dispose();this.wF&&g.WG(this.Y.Un,this.wF);this.QM&&g.WG(this.Y.Un,this.QM);g.S.prototype.gF.call(this)};
g.w.R_v=function(k){var y=this,q,N,D;return g.B(function(n){switch(n.Z){case 1:q=g.OV(k,"transfer");if(y.Z&&q===y.Z.key){A_(y.B,y.j,!0);y.V.stop();n.Hl(0);break}return g.b(n,mo(y.N,{mode:"readwrite",Qi:!0},function(T){return xw(T,q,"transfer").then(function(I){if(I&&I.transferState!=="TRANSFER_STATE_COMPLETE"&&I.transferState!=="TRANSFER_STATE_FAILED")return I.transferState="TRANSFER_STATE_PAUSED_BY_USER",$w(T,I,"transfer").then(function(){return I})})}),3);
case 3:N=n.N;if(!N){n.Hl(0);break}if(!k||!y.C){n.Hl(5);break}return g.b(n,LL(k,y.C,y.N,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.b(n,j_(y,k),7);case 7:D=n.N,wvq({videoId:k,G3:N,offlineModeType:D}),g.XZ(n)}})};
g.w.m5M=function(){var k=this;if(this.Z&&this.j){A_(this.B,this.j,!1);var y=this.Z,q=(y==null?0:y.key)?g.fs(y.key).entityId:"";q&&this.C&&(new Promise(function(N,D){LL(q,k.C,k.N,"DOWNLOAD_STATE_PAUSED").catch(function(n){D(n)})})).catch(function(N){bH("Download state setting error",N)})}this.V.stop()};
g.w.pE=function(){this.Z?DjN(this,this.Z):x8(this)};
g.w.EF=function(k){var y=this;return g.B(function(q){switch(q.Z){case 1:if(!y.Z){q.Hl(2);break}if(y.Z.transferState==="TRANSFER_STATE_COMPLETE"||y.Z.transferState==="TRANSFER_STATE_FAILED"||!k.transfer||!k.transfer.has(y.Z.key)){q.Hl(3);break}return g.b(q,fL(y.N,y.Z.key,"transfer"),4);case 4:y.Z=q.N;if(y.Z){q.Hl(3);break}return g.b(q,n7w(y),3);case 3:if(y.Z)return q.return();case 2:return g.b(q,x8(y),0)}})};
g.w.cC=function(k,y){var q=this,N,D,n,T,I;return g.B(function(H){switch(H.Z){case 1:if(!q.Z){Xo(q,"onTransferFailure: "+k);H.Hl(2);break}N=q.Z;n=((D=N)==null?0:D.key)?g.fs(N.key).entityId:"";a:switch(k){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var K=!1;break a;default:K=!0}return K&&ayg(q)?g.b(H,$8(q,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.b(H,
xjE(q,k),5);case 5:if(!n||!q.C){H.Hl(2);break}return g.b(H,LL(n,q.C,q.N,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.b(H,j_(q,n),9);case 9:T=H.N;MV({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:n,G3:N,offlineModeType:T});if(!n||!q.C){H.Hl(2);break}return g.b(H,LL(n,q.C,q.N,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:a1(q),I=x8(q,!0),y&&y(I),g.XZ(H)}})};
g.w.YK=function(k){var y=this,q,N,D,n,T,I,H,K,A,c,u,a;return g.B(function(x){switch(x.Z){case 1:if(!y.Z){Xo(y,"onMaybeTransferStreamsExpired");x.Hl(2);break}return ayg(y)?g.b(x,$8(y,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.b(x,xjE(y,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!y.C){x.Hl(2);break}q=y.Z;D=((N=q)==null?0:N.key)?g.fs(q.key).entityId:"";if(!D){x.Hl(2);break}return g.b(x,LL(D,y.C,y.N,"DOWNLOAD_STATE_FAILED"),2);case 9:return y.Z||Xo(y,"onMaybeTransferStreamsExpiredRetryAttempting"),
n=y.Z,I=((T=n)==null?0:T.key)?g.fs(n.key).entityId:"",g.b(x,j_(y,I),10);case 10:return H=x.N,MV({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:I,G3:n,offlineModeType:H}),K=uFN(),g.NM(K,I1,{isEnqueuedForExpiredStreamUrlRefetch:!0}),A=g.OV(I,"playbackData"),c={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:A,actionMetadata:K},u=eH(new hN("playbackData",I,c)),g.b(x,iH(y.N,u,"offlineOrchestrationActionWrapperEntity"),2);case 2:a1(y),a=x8(y,!0),
k&&k(a),g.XZ(x)}})};
var z31={},j0O=(z31.TRANSFER_STATE_TRANSFERRING=1,z31.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,z31);g.w=zX.prototype;g.w.gy=function(){return this.j.promise};
g.w.Bh=function(){if(this.N&&this.B)return this.j.promise;zHe(this).then(this.j.resolve).catch(this.j.reject);return this.j.promise};
g.w.JH=function(k){var y={};return y.playbackData=new tkT(k,this.uw,this.Z),y.transfer=new $5x(k,this.uw),y.videoPlaybackPositionEntity=new TeF(k,this.uw),y};
g.w.Ll=function(){var k=this;return g.B(function(y){return k.N?g.b(y,qqg(k.N),0):y.Hl(0)})};
g.w.RJ=function(){var k=this,y,q;return g.B(function(N){if(N.Z==1)return k.N||k.B?g.b(N,k.gy(),2):N.return();k.J!==void 0&&(g.UP(k.J),k.J=void 0);k.V!==void 0&&(g.UP(k.V),k.V=void 0);(y=k.N)==null||y.dispose();k.N=void 0;(q=k.B)==null||q.dispose();k.B=void 0;k.api.Sb("onOrchestrationLostLeader");k.j=new g.mI;g.XZ(N)})};
g.w.isOrchestrationLeader=function(){return this.C.Z};
g.w.UY=function(){return g.B(function(k){return k.return(!1)})};
g.w.E$=function(k){var y=this.Z;y.api.publish("offlinetransferpause",k);var q;(q=y.N)==null||q.postMessage(k)};
g.w.pE=function(k){var y,q;return g.B(function(N){if(N.Z==1)return g.b(N,Pi(),2);y=N.N;if(!y)return N.return();q=g.OV(k,"transfer");return g.b(N,mo(y,{mode:"readwrite",Qi:!0},function(D){var n=xw(D,q,"transfer"),T=xw(D,g.OV(k,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Gv.all([n,T]).then(function(I){I=g.p(I);var H=I.next().value;var K=I.next().value;return H&&H.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(H.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",$w(D,H,"transfer").then(function(){MV({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:k,G3:H,offlineModeType:K==null?void 0:K.offlineModeType});return g.Gv.resolve(null)})):g.Gv.resolve(null)})}),0)})};
g.w.vW=function(k){k=k===void 0?43200:k;var y=this,q,N,D,n,T,I,H,K;return g.B(function(A){if(A.Z==1)return y.Y.tL()?g.b(A,Pi(),2):A.return(p2E());if(A.Z!=3){q=A.N;if(!q)return A.return([]);N=Date.now()/1E3;return g.b(A,Oy(q,"offlineVideoPolicy"),3)}D=A.N;n=[];T=g.p(D);for(I=T.next();!I.done;I=T.next())H=I.value,Number(H.lastUpdatedTimestampSeconds)+k<=N&&(K=g.fs(H.key).entityId,n.push(K));return n.length?A.return(p7(y,n,y.U,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):A.return([])})};
g.w.deleteAll=function(){return p7(this,["!*$_ALL_ENTITIES_!*$"],this.U,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.w.refreshAllStaleEntities=function(k){var y=this;return g.B(function(q){return q.Z==1?g.b(q,y.vW(k),2):q.return(q.N)})};
g.w.setUpPositionSyncInterval=function(k){var y=this;this.V!==void 0&&(g.UP(this.V),this.V=void 0);var q=k!=null?k:864E5;this.V=g.Vu(function(){y.Wv(q)},q)};
g.w.Wv=function(k){var y=this,q,N,D,n,T,I;return g.B(function(H){switch(H.Z){case 1:return g.zM(H,2),g.b(H,ci.getInstance(),4);case 4:q=H.N;if(!q)throw Error("prefStorage is undefined");return g.b(H,q.get("psi"),5);case 5:N=H.N;n=((D=N)==null?0:D.XJ)?Number(N.XJ)/1E3:0;T=Date.now();if(!(n+k<=T)){H.Hl(6);break}return g.b(H,p7(y,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.pu(H,0);break;case 2:I=g.rT(H),bH("Offline manager error",I),
g.XZ(H)}})};
g.w.SV=function(){var k=this,y,q,N,D,n,T,I;return g.B(function(H){if(H.Z==1)return g.b(H,Pi(),2);if(H.Z!=3)return(y=H.N)?g.b(H,Oy(y,"transfer"),3):H.return([]);q=H.N;N=[];D=g.p(q);for(n=D.next();!n.done;n=D.next())T=n.value,T.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&T.key&&(I=g.fs(T.key).entityId,N.push(I));return H.return(mj1(k,N))})};
g.w.m$=function(){return g.B(function(k){return k.return([])})};
g.w.Ea=function(){return g.B(function(k){g.XZ(k)})};
g.w.CT=function(){return g.B(function(k){g.XZ(k)})};g.z(ijL,n7);ijL.prototype.N=function(k){return Yw(k)?P01(this,k):SH(k)?C0O(this,k):Gn(k)?E7L(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};
var rw=[10];g.z(Q0w,n7);Q0w.prototype.N=function(k){return Yw(k)?YqE(this,k):SH(k)?Sq$(this,k):Gn(k)?GIL(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};
var FRG=[10];g.z(djx,n7);djx.prototype.N=function(k){return SH(k)?o7q(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};g.z(hHw,zX);g.w=hHw.prototype;g.w.JH=function(k){var y=zX.prototype.JH.call(this,k);y.mainVideoEntity=new Q0w(k,this.uw,this.Z);y.mainPlaylistEntity=new ijL(k,this.uw,this.Z);y.mainDownloadsListEntity=new djx(k,this.uw,this.Z);return y};
g.w.refreshAllStaleEntities=function(k,y){var q=this,N,D,n,T,I,H,K,A,c,u,a;return g.B(function(x){switch(x.Z){case 1:N=[];if(!q.uw.W("web_player_offline_playlist_auto_refresh")){x.Hl(2);break}return g.b(x,RHe(q,k,y),3);case 3:N=x.N;case 2:return g.b(x,ci.getInstance(),4);case 4:return D=x.N,g.b(x,(n=D)==null?void 0:n.get("sdois"),5);case 5:return T=x.N,g.b(x,(I=D)==null?void 0:I.get("lmqf"),6);case 6:H=x.N;if(!T){x.Hl(7);break}A=N;c=A.concat;return g.b(x,eHq(q,T,(K=H)!=null?K:"SD",k===0),8);case 8:N=
c.call(A,x.N);case 7:return u=N,a=u.concat,g.b(x,zX.prototype.refreshAllStaleEntities.call(q,k,y),9);case 9:return N=a.call(u,x.N),x.return(N)}})};
g.w.UY=function(k){var y,q,N,D,n,T,I,H;return g.B(function(K){if(K.Z==1)return g.b(K,Pi(),2);if(K.Z!=3)return(y=K.N)?g.b(K,fL(y,g.xR,"mainDownloadsListEntity"),3):K.return(!1);q=K.N;if((N=q)==null?0:(D=N.downloads)==null?0:D.length)for(n=g.OV(k,"mainVideoEntity"),T=g.p(q.downloads),I=T.next();!I.done;I=T.next())if(H=I.value,H.videoItem===n)return K.return(!0);return K.return(!1)})};
g.w.m$=function(){var k=this,y,q,N,D,n,T,I,H;return g.B(function(K){if(K.Z==1)return g.b(K,Pi(),2);if(K.Z!=3)return(y=K.N)?g.b(K,Oy(y,"downloadStatusEntity"),3):K.return([]);q=K.N;N=[];D=g.p(q);for(n=D.next();!n.done;n=D.next())T=n.value,T.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&T.key&&(I=g.fs(T.key).entityId,N.push(I));return N.length?(H={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},K.return(p7(k,N,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
H))):K.return([])})};
g.w.CT=function(){var k;return g.B(function(y){return y.Z==1?g.b(y,Pi(),2):(k=y.N)?g.b(y,mo(k,{mode:"readwrite",Qi:!0},function(q){return jH(q,"mainVideoEntity").then(function(N){var D=[];N=g.p(N);for(var n=N.next();!n.done;n=N.next()){n=n.value;var T=void 0;(T=n.userState)!=null&&T.playbackPosition||(T=g.fs(n.key).entityId,T={key:g.OV(T,"videoPlaybackPositionEntity"),videoId:T,lastPlaybackPositionSeconds:"0"},D.push($w(q,T,"videoPlaybackPositionEntity")),n.userState={playbackPosition:T.key},D.push($w(q,
n,"mainVideoEntity")))}return g.Gv.all(D)})}),0):y.return()})};
g.w.Ea=function(){var k,y,q,N,D,n,T,I,H,K,A,c,u,a,x,r,f,P,C,V,Q,Y,l,h,qD,Ku,Z,d,J,X,W,s0,zF,Ae,Cu,qG,xN,JG;return g.B(function(O){if(O.Z==1)return g.b(O,Pi(),2);if(O.Z!=3){k=O.N;if(!k)return O.return();y=g.OV("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.b(O,mo(k,{mode:"readonly",Qi:!0},function(v){return g.Gv.all([xw(v,y,"mainDownloadsListEntity"),xw(v,g.xR,"mainDownloadsListEntity"),jH(v,"mainVideoEntity"),jH(v,"mainPlaylistEntity")])}),3)}q=O.N;
N=g.p(q);D=N.next().value;n=N.next().value;T=N.next().value;I=N.next().value;H=D;K=n;A=T;c=I;u=new Set;if((a=H)==null?0:(x=a.downloads)==null?0:x.length)for(r=g.p(H.downloads),f=r.next();!f.done;f=r.next())P=f.value,C=void 0,(V=(C=P.videoItem)!=null?C:P.playlistItem)&&u.add(V);if((Q=K)==null?0:(Y=Q.downloads)==null?0:Y.length)for(l=g.p(K.downloads),h=l.next();!h.done;h=l.next())qD=h.value,qD.videoItem&&u.add(qD.videoItem);Ku=new Set;Z=[];d=g.p(c);for(J=d.next();!J.done;J=d.next()){X=J.value;if(X.videos)for(W=
g.p(X.videos),s0=W.next();!s0.done;s0=W.next())zF=s0.value,(Ae=JSON.parse(g.fs(zF).entityId).videoId)&&Ku.add(Ae);X.key&&!u.has(X.key)&&Z.push(X.key)}Cu=g.p(A);for(qG=Cu.next();!qG.done;qG=Cu.next())xN=qG.value,xN.key&&!u.has(xN.key)&&(JG=g.fs(xN.key).entityId,Ku.has(JG)||Z.push(xN.key));return Z.length?g.b(O,PyL(k,Z),0):O.Hl(0)})};g.z(WRO,n7);WRO.prototype.N=function(k){return Yw(k)?lyN(this,k):SH(k)?s0x(this,k):Gn(k)?JFg(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};
var i9=[10];g.z(kv$,n7);kv$.prototype.N=function(k){return Yw(k)?qHT(this,k):SH(k)?NbF(this,k):Gn(k)?DSG(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};
var f7=[10];g.z(wNN,n7);wNN.prototype.N=function(k){return Yw(k)?A1T(this,k):SH(k)?c1L(this,k):Gn(k)?uv$(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};
var Kcq=[10];g.z(Om,zX);Om.prototype.JH=function(k){var y=zX.prototype.JH.call(this,k);y.musicTrack=new wNN(k,this.Z);y.musicPlaylist=new kv$(k,this.Z);y.musicAlbumRelease=new WRO(k,this.Z);return y};
Om.prototype.refreshAllStaleEntities=function(k,y){var q=this,N,D,n;return g.B(function(T){if(T.Z==1)return g.b(T,xSB(q,k,y),2);if(T.Z!=3)return D=N=T.N,n=D.concat,g.b(T,zX.prototype.refreshAllStaleEntities.call(q,k,y),3);N=n.call(D,T.N);return T.return(N)})};g.z(jmq,g.pi);g.w=jmq.prototype;g.w.create=function(){var k=this;g.G(this,this.events);g.ng(this.uw)?this.Z=new hHw(this.uw,this.player):g.NF(this.uw)&&(this.Z=new Om(this.uw,this.player));this.events.T(this.player,"onPlaybackStartExternal",function(){k.qj()});
this.events.T(this.player,"videodatachange",function(){k.qj()});
this.uw.W("html5_offline_playback_position_sync")&&this.events.T(this.player,"presentingplayerstatechange",this.Os)};
g.w.vQ=function(){return!1};
g.w.D$=function(k,y,q,N){var D=this;return g.B(function(n){return D.Z?n.return(p7(D.Z,k,y,q,N)):n.return(Promise.reject())})};
g.w.deleteAll=function(){return this.Z.deleteAll()};
g.w.vW=function(k){return this.Z.vW(k)};
g.w.refreshAllStaleEntities=function(k){return this.Z.refreshAllStaleEntities(k)};
g.w.setUpPositionSyncInterval=function(k){this.Z.setUpPositionSyncInterval(k)};
g.w.E$=function(k){this.Z.E$(k)};
g.w.pE=function(k){return this.Z.pE(k)};
g.w.qj=function(){var k=this,y;return g.B(function(q){y=k.player.getVideoData();return g.R_(y)?XNe(y)&&k.N!==y.clientPlaybackNonce?g.b(q,$SL(k,y),0):q.Hl(0):q.return()})};
g.w.Os=function(k){var y=this,q,N,D,n,T,I,H;return g.B(function(K){if(K.Z==1)return q=y.player.getVideoData(),N=q.f0,g.Uu(k,2)||g.Uu(k,512)?g.b(K,Pi(),2):K.return();if(K.Z!=3){D=K.N;if(!D)return bH("PES is undefined"),K.return();n=q.videoId;return g.b(K,fL(D,g.OV(n,"mainVideoEntity"),"mainVideoEntity"),3)}T=K.N;if(!T)return K.return();I=Math.floor(N).toString();H={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:I}};return g.b(K,y.D$([n],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
H),0)})};
g.w.isOrchestrationLeader=function(){return this.Z.isOrchestrationLeader()};
g.w.updateDownloadState=function(k,y){var q,N,D,n;return g.B(function(T){if(T.Z==1)return g.b(T,Pi(),2);q=T.N;if(!q)return bH("PES is undefined"),T.return();N=g.fs(k);D=N.entityType;n=N.entityId;return g.b(T,LL(n,D,q,y,!0),0)})};g.zg("offline",jmq);})(_yt_player);
